<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":200,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/config.min.js"></script><meta property="og:type" content="website"><meta property="og:title" content="vanishke随笔"><meta property="og:url" content="https://github.com/vanishke/hexo/page/12/index.html"><meta property="og:site_name" content="vanishke随笔"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="vanishke"><meta property="article:tag" content="Java,Elasticsearch,MySQL,Linux"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://github.com/vanishke/hexo/page/12/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/12/index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>vanishke随笔</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">vanishke随笔</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">善始者实繁，克终者盖寡</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">99</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">58</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">233</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="vanishke" src="/images/avatar.png"><p class="site-author-name" itemprop="name">vanishke</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">233</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/vanishke" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vanishke"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:18685129726@163.com" title="E-Mail → mailto:18685129726@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div><div class="links-of-recent-posts motion-element"><div class="links-of-recent-posts-title"><i class="fa fa-history fa-fw"></i> 最近文章</div><ul class="links-of-recent-posts-list"><li class="links-of-recent-posts-item"><a href="/Wildfly/blogs/Wildfly%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%BC%E8%88%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9B%AE%E5%BD%95/" title="Wildfly&#x2F;blogs&#x2F;Wildfly自定义导航应用程序文件上传目录&#x2F;">Wildfly自定义导航应用程序文件上传目录</a></li><li class="links-of-recent-posts-item"><a href="/Wildfly/blogs/Wildfly%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BC%82%E5%B8%B8%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" title="Wildfly&#x2F;blogs&#x2F;Wildfly部署应用程序加载配置文件异常解决办法&#x2F;">Wildfly部署应用程序加载配置文件异常解决办法</a></li><li class="links-of-recent-posts-item"><a href="/Knife4j/blogs/knife4j%E5%90%8C%E6%97%B6%E6%8E%A5%E6%94%B6%E6%96%87%E4%BB%B6%E5%92%8Cjson%E5%AF%B9%E8%B1%A1%E5%B1%95%E7%A4%BA%E5%BC%82%E5%B8%B8%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" title="Knife4j&#x2F;blogs&#x2F;knife4j同时接收文件和json对象展示异常的解决办法&#x2F;">knife4j同时接收文件和json对象展示异常的解决办法</a></li><li class="links-of-recent-posts-item"><a href="/Elasticsearch/blogs/Elasticsearch%E5%9F%BA%E4%BA%8E%E7%AD%96%E7%95%A5%E5%AE%9E%E7%8E%B0%E7%B4%A2%E5%BC%95%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4/" title="Elasticsearch&#x2F;blogs&#x2F;Elasticsearch基于策略实现索引自动删除&#x2F;">Elasticsearch基于策略实现索引自动删除</a></li><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker%E5%9F%BA%E4%BA%8Ezipkin+sleuth%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5%E6%97%A0%E6%95%88%E7%9A%84%E6%8E%92%E6%9F%A5%E8%BF%87%E7%A8%8B/" title="Docker&#x2F;blogs&#x2F;Docker基于zipkin+sleuth实现链路追踪数据上报无效的排查过程&#x2F;">Docker基于zipkin+sleuth实现链路追踪数据上报无效的排查过程</a></li></ul></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/vanishke" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Java/blogs/Maven%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%B0%86%E4%BE%9D%E8%B5%96%E7%A7%BB%E5%8A%A8%E8%87%B3%E5%A4%96%E9%83%A8lib%E7%9B%AE%E5%BD%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Java/blogs/Maven%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%B0%86%E4%BE%9D%E8%B5%96%E7%A7%BB%E5%8A%A8%E8%87%B3%E5%A4%96%E9%83%A8lib%E7%9B%AE%E5%BD%95/" class="post-title-link" itemprop="url">maven项目打包将依赖移动至外部lib目录</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-11 14:56:20" itemprop="dateCreated datePublished" datetime="2023-08-11T14:56:20+08:00">2023-08-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E8%83%8C%E6%99%AFspan"><span id="inline-blue">背景</span></a></li><li><a href="#span-idinline-blue%E5%AE%9E%E7%8E%B0span"><span id="inline-blue">实现</span></a></li></ul><h1><span id="背景"><span id="inline-blue">背景</span></span></h1><p>项目编译打成jar包后，依赖的lib被以源代码形式添加进了源码包目录，导致项目真实的源码目录和依赖混淆，希望能够将项目源码和依赖jar包区分开来，剔除多余的配置文件信息</p><h1><span id="实现"><span id="inline-blue">实现</span></span></h1><p>maven项目打包只保存项目的classpath信息，jar包内部MANNIFEST.MF文件信息如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Archiver-Version: Plexus Archiver</span><br><span class="line">Built-By: 909754</span><br><span class="line">Class-Path: lib/aopalliance-1.0.jar lib/asm-5.2.jar lib/asm-tree-5.2.j</span><br><span class="line"> ar lib/aspectjrt-1.6.9.jar lib/aspectjweaver-1.6.9.jar lib/c3p0-0.9.1</span><br><span class="line"> .2.jar lib/cas-client-core-3.5.0.jar lib/slf4j-api-1.7.1.jar lib/cgli</span><br><span class="line"> b-3.2.5.jar lib/ant-1.9.6.jar lib/ant-launcher-1.9.6.jar lib/commons-</span><br><span class="line"> beanutils-1.8.3.jar lib/commons-codec-1.10.jar lib/commons-collection</span><br><span class="line"> s-3.2.2.jar lib/commons-logging-1.2.jar lib/commons-net-3.5.jar lib/c</span><br><span class="line"> ommons-pool2-2.4.3.jar lib/druid-1.0.8.jar lib/ehcache-2.10.1.jar lib</span><br><span class="line"> /elastic-job-core-1.0.6.jar lib/lombok-1.16.4.jar lib/curator-framewo</span><br><span class="line"> rk-2.10.0.jar lib/curator-client-2.10.0.jar lib/zookeeper-3.4.6.jar l</span><br><span class="line"> ib/jline-0.9.94.jar lib/netty-3.7.0.Final.jar lib/curator-recipes-2.1</span><br><span class="line"> 0.0.jar lib/curator-test-2.10.0.jar lib/javassist-3.18.1-GA.jar lib/c</span><br><span class="line"> ommons-math-2.2.jar lib/ezmorph-1.0.3.jar lib/ganymed-ssh2-build210.j</span><br><span class="line"> ar lib/groovy-2.4.5.jar lib/gson-2.8.5.jar lib/guava-19.0.jar lib/hib</span><br><span class="line"> ernate-jpa-2.1-api-1.0.0.Final.jar lib/javax.inject-1.jar lib/jcl-ove</span><br><span class="line"> r-slf4j-1.7.7.jar lib/jdom-1.0.jar lib/jedis-2.9.1.jar lib/joda-time-</span><br><span class="line"> 2.9.9.jar lib/json-lib-2.1.jar lib/jsoup-1.11.1.jar lib/jstl-1.2.jar </span><br><span class="line"> lib/jta-1.1.jar lib/jzlib-1.0.7.jar lib/metrics-core-3.1.0.jar lib/mo</span><br><span class="line"> ngo-java-driver-3.3.0.jar lib/mybatis-3.1.1.jar lib/mybatis-spring-1.</span><br><span class="line"> 1.1.jar lib/spring-core-3.1.1.RELEASE.jar lib/spring-tx-3.1.1.RELEASE</span><br><span class="line"> .jar lib/mysql-connector-java-5.1.39.jar lib/ognl-3.0.1.jar lib/javas</span><br><span class="line"> sist-3.11.0.GA.jar lib/ojdbc6-11.2.0.4.jar lib/ucp-11.2.0.4.jar lib/o</span><br><span class="line"> raclepki-11.2.0.4.jar lib/osdt_cert-11.2.0.4.jar lib/osdt_core-11.2.0</span><br><span class="line"> .4.jar lib/simplefan-11.2.0.4.jar lib/ons-11.2.0.4.jar lib/oro-2.0.8.</span><br><span class="line"> jar lib/quartz-2.2.1.jar lib/rome-1.7.1.jar lib/rome-utils-1.7.1.jar </span><br><span class="line"> lib/jdom2-2.0.6.jar lib/xmemcached-1.4.2.jar lib/velocity-1.7.jar lib</span><br><span class="line"> /pinyin4j-2.5.0.jar lib/spring-context-5.3.20.jar lib/spring-aop-5.3.</span><br><span class="line"> 20.jar lib/spring-beans-5.3.20.jar lib/spring-expression-5.3.20.jar l</span><br><span class="line"> ib/spring-webmvc-5.3.20.jar lib/spring-web-5.3.20.jar lib/spring-jdbc</span><br><span class="line"> -5.3.20.jar lib/spring-data-mongodb-1.9.10.RELEASE.jar lib/spring-dat</span><br><span class="line"> a-mongodb-cross-store-1.9.10.RELEASE.jar lib/spring-aspects-4.2.9.REL</span><br><span class="line"> EASE.jar lib/spring-orm-4.2.9.RELEASE.jar lib/spring-data-commons-1.1</span><br><span class="line"> 2.10.RELEASE.jar lib/commons-io-2.5.jar lib/commons-lang3-3.4.jar lib</span><br><span class="line"> /jackson-annotations-2.8.8.jar lib/jackson-core-2.8.8.jar lib/jackson</span><br><span class="line"> -databind-2.8.8.1.jar lib/Java-WebSocket-1.3.0.jar lib/slf4j-log4j12-</span><br><span class="line"> 1.7.2.jar lib/log4j-1.2.17.jar lib/poi-3.9.jar lib/poi-ooxml-3.9.jar </span><br><span class="line"> lib/poi-ooxml-schemas-3.9.jar lib/xmlbeans-2.5.0.jar lib/stax-api-1.0</span><br><span class="line"> .1.jar lib/dom4j-1.6.1.jar lib/xml-apis-1.0.b2.jar lib/commons-fileup</span><br><span class="line"> load-1.2.2.jar lib/commons-configuration-1.8.jar lib/commons-lang-2.5</span><br><span class="line"> .jar lib/commons-collections4-4.1.jar lib/sdp-cbb-license-V300R002B01</span><br><span class="line"> .jar lib/hutool-core-5.6.5.jar</span><br><span class="line">Created-By: Apache Maven 3.5.4</span><br><span class="line">Build-Jdk: 1.8.0_333</span><br><span class="line">Main-Class: com.coship.estool.EsToolMain</span><br></pre></td></tr></table></figure><p>只记录了应用的启动类com.coship.estool.EsToolMain及jar包依赖所在位置信息<br>maven打包插件配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">			  <span class="comment">&lt;!-- 添加依赖信息 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">			  <span class="comment">&lt;!-- 设置依赖所在目录 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">			  <span class="comment">&lt;!-- 启动类所在位置 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.coship.estool.EsToolMain<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">			  <span class="comment">&lt;!-- 打包后将依赖的jar包拷贝至target/lib目录 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">overWriteReleases</span>&gt;</span>false<span class="tag">&lt;/<span class="name">overWriteReleases</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">overWriteSnapshots</span>&gt;</span>false<span class="tag">&lt;/<span class="name">overWriteSnapshots</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">overWriteIfNewer</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overWriteIfNewer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Java/blogs/jar%E5%90%AF%E5%8A%A8%E8%AF%BB%E5%8F%96%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Java/blogs/jar%E5%90%AF%E5%8A%A8%E8%AF%BB%E5%8F%96%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">jar启动读取外部配置文件实现</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-11 14:35:20" itemprop="dateCreated datePublished" datetime="2023-08-11T14:35:20+08:00">2023-08-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E8%83%8C%E6%99%AFspan"><span id="inline-blue">背景</span></a></li><li><a href="#span-idinline-blue%E5%AE%9E%E7%8E%B0span"><span id="inline-blue">实现</span></a></li><li><a href="#span-idinline-blue%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4span"><span id="inline-blue">启动命令</span></a></li></ul><h1><span id="背景"><span id="inline-blue">背景</span></span></h1><p>项目编译打成jar包后，配置文件包含在jar包内部不方便修改，希望实现本地启动读取classpath路径下的配置信息，在生产环境部署的情况下读取同级目录下的配置信息</p><h1><span id="实现"><span id="inline-blue">实现</span></span></h1><p>通过静态工具类读取配置信息<br>1、本地开发时读取资源目录下的配置文件信息<br>2、打成jar包部署时，资源文件放置在jar包同级conf目录下</p><p>maven打包时将配置文件拷贝至target目录下，依赖以下插件实现：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!-- 拷贝至target目录 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;build.directory&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">								<span class="comment">&lt;!-- 资源文件原始路径 --&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>PropertiesUtil工具类实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.coship.base.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(PropertiesUtil.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; configMap = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        loadProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化propertiies</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Properties <span class="title">loadProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//优先从jar包同级conf目录获取配置文件</span></span><br><span class="line">        String confPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        confPath = confPath + File.separator +<span class="string">&quot;conf&quot;</span>+ File.separator+ <span class="string">&quot;application.properties&quot;</span>;</span><br><span class="line">        File file = <span class="keyword">new</span> File(confPath);</span><br><span class="line">        <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;配置文件路径----&gt;&gt;&quot;</span> + confPath);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                in = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(confPath));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//未传入路径时，读取项目classpath路径下配置文件信息</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;项目路径[&quot;</span> + confPath + <span class="string">&quot;]下无连接信息，从classpath路径下加载&quot;</span>);</span><br><span class="line">            in = PropertiesUtil.class.getClassLoader().getResourceAsStream(<span class="string">&quot;conf/application.properties&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(in);</span><br><span class="line">            configMap = <span class="keyword">new</span> HashMap&lt;&gt;(properties.keySet().size());</span><br><span class="line">            logger.info(<span class="string">&quot;init properties&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Object keyObj : properties.keySet()) &#123;</span><br><span class="line">                String key = keyObj.toString();</span><br><span class="line">                Object objs = properties.get(key);</span><br><span class="line">                logger.info(key + <span class="string">&quot;:&quot;</span> + objs);</span><br><span class="line">                configMap.put(key.trim(), objs.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getSimpleValue</span><span class="params">(String key, String defaultValue)</span> </span>&#123;</span><br><span class="line">        String value = configMap.get(key);</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span> || value.trim().length() == <span class="number">0</span>) &#123;</span><br><span class="line">            value = defaultValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">assert</span> StringUtils.isNotBlank(value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getSimpleValue</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configMap.get(key).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getHttpPort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(getSimpleValue(<span class="string">&quot;server.http.port&quot;</span>, <span class="string">&quot;8056&quot;</span>)).intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getEsSQLPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSimpleValue(<span class="string">&quot;es.sql.path&quot;</span>,<span class="string">&quot;/_sql&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getEsSQLExplainPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSimpleValue(<span class="string">&quot;es.sql.explain.path&quot;</span>,<span class="string">&quot;/_sql/_explain&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>jar包启动命令，启动时指定log4j.properties配置文件<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//file:标识必须存在，表示从本地路径加载  &amp;代表后台启动，否则xshell窗口关闭的情况下，进程停止</span><br><span class="line"> java -jar -Dlog4j.configuration=file:./conf/log4j.properties XXX.jar &amp;</span><br></pre></td></tr></table></figure><p></p><h1><span id="启动命令"><span id="inline-blue">启动命令</span></span></h1><p>start.sh<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash">!/bin/sh</span></span><br><span class="line">BINDIR=`dirname $0`</span><br><span class="line">if [ -n &quot;$BINDIR&quot; ] ; then</span><br><span class="line">    BINDIR=`cd $BINDIR &gt; /dev/null 2&gt;&amp;1 &amp;&amp; pwd`</span><br><span class="line">fi</span><br><span class="line">cd $BINDIR</span><br><span class="line">(java -jar -Dlog4j.configuration=file:./conf/log4j.properties EsTool_V1.0.0.jar &amp;)</span><br></pre></td></tr></table></figure><br>stop.sh<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash">!/bin/sh</span></span><br><span class="line">ps -ef|grep &#x27;EsTool_V1.0.0.jar&#x27; | grep -v &quot;grep&quot; | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Elasticsearch/blogs/Elasticsearch-SQL%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Elasticsearch/blogs/Elasticsearch-SQL%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Elasticsearch-SQL插件安装.</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-02 14:35:20" itemprop="dateCreated datePublished" datetime="2023-08-02T14:35:20+08:00">2023-08-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E7%8E%AF%E5%A2%83span"><span id="inline-blue">环境</span></a></li><li><a href="#span-idinline-blue%E6%8F%92%E4%BB%B6span"><span id="inline-blue">插件</span></a></li><li><a href="#span-idinline-blueelasticsearch-sql%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85span"><span id="inline-blue">Elasticsearch-SQL在线安装</span></a></li><li><a href="#span-idinline-blueelasticsearch-sql%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85span"><span id="inline-blue">Elasticsearch-SQL离线安装</span></a></li><li><a href="#span-idinline-bluees-sql-site-standalone%E5%AE%89%E8%A3%85span"><span id="inline-blue">es-sql-site-standalone安装</span></a></li><li><a href="#span-idinline-bluees-sql-site-standalone%E5%90%AF%E5%8A%A8span"><span id="inline-blue">es-sql-site-standalone启动</span></a></li><li><a href="#span-idinline-blueelasticsearch-sql%E5%92%8Cx-pack-sql%E5%B7%AE%E5%BC%82span"><span id="inline-blue">Elasticsearch-SQL和x-pack-sql差异</span></a></li></ul><h1><span id="环境"><span id="inline-blue">环境</span></span></h1><p>Elasticsearch-7.15.1</p><h1><span id="插件"><span id="inline-blue">插件</span></span></h1><p>Elasticsearch-SQL-7.15.1.0 : es SQL查询插件<br>es-sql-site-standalone ： es SQL查询前端<br>下载地址：链接：<a href="https://pan.baidu.com/s/1wyUFPOU6uywOOAhw2f9QEA">https://pan.baidu.com/s/1wyUFPOU6uywOOAhw2f9QEA</a><br>提取码：z2od</p><h1><span id="elasticsearch-sql在线安装"><span id="inline-blue">Elasticsearch-SQL在线安装</span></span></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Elasticsearch主目录下执行</span></span><br><span class="line">./bin/elasticsearch-plugin install https://github.com/NLPchina/elasticsearch-sql/releases/download/7.15.1.0/elasticsearch-sql-7.15.1.0.zip</span><br></pre></td></tr></table></figure><h1><span id="elasticsearch-sql离线安装"><span id="inline-blue">Elasticsearch-SQL离线安装</span></span></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">自行下载对应压缩包https://github.com/NLPchina/elasticsearch-sql/releases/download/7.15.1.0/elasticsearch-sql-7.15.1.0.zip,并将其上传至服务器/home目录，执行以下命令</span></span><br><span class="line">cd /usr/local/ELK/elasticsearch-7.15.1/</span><br><span class="line">./bin/elasticsearch-plugin install file:/home/elasticsearch-sql-7.15.1.0.zip</span><br></pre></td></tr></table></figure><h1><span id="es-sql-site-standalone安装"><span id="inline-blue">es-sql-site-standalone安装</span></span></h1><p>在Elasticsearch主目录下创建文件夹global_plugins,将es-sql-site-standalone.zip上传到该目录下，执行以下命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip es-sql-site-standalone.zip -d es-sql-site</span><br></pre></td></tr></table></figure><p>修改访问的配置端口：<br>/usr/local/ELK/elasticsearch-7.15.1/global_plugins/es-sql-site/site-server/site_configuration.json</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;port&quot;:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Elasticsearch-SQL api访问路径变更：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Since 7.5.0.0, the path /_sql is changed to /_nlpcn/sql, and the path /_sql/_explain is changed to /_nlpcn/sql/explain.</span><br></pre></td></tr></table></figure><p>修改/usr/local/ELK/elasticsearch-7.15.1/global_plugins/es-sql-site/_site/controllers.js<br>184行和250行分别将_sql路径变更为_nlpcn/sql、_sql/_explain变更为_nlpcn/sql/explain</p><p>修改es配置：<br>ES的elasticsearch.yml，增加跨域的配置(需要重启es才能生效) </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true  </span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure><p>编辑controllers.js文件,修改es访问地址：/usr/local/ELK/elasticsearch-7.15.1/global_plugins/es-sql-site/_site/controllers.js</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (location.protocol == &quot;file&quot;) &#123;</span><br><span class="line">                              url = &quot;http://localhost:9200&quot;</span><br><span class="line">                      &#125;</span><br><span class="line">                      else &#123;</span><br><span class="line">                              url = location.protocol+&#x27;//&#x27; + location.hostname + (location.port ? &#x27;:&#x27;+location.port : &#x27;&#x27;);</span><br><span class="line">                      &#125;</span><br><span class="line">              &#125;</span><br></pre></td></tr></table></figure><p>修改url地址为ES服务器的地址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (location.protocol == &quot;file&quot;) &#123;</span><br><span class="line">                               url = &quot;http://10.9.216.12:9200&quot;</span><br><span class="line">                       &#125;</span><br><span class="line">                       else &#123;</span><br><span class="line">                               url = &quot;http://10.9.216.12:19200&quot;;</span><br><span class="line">                       &#125;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="es-sql-site-standalone启动"><span id="inline-blue">es-sql-site-standalone启动</span></span></h1><p>es-sql-site-standalone插件需要node环境支持，除此之外需要连接外网<br>有外网的情况下启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/ELK/elasticsearch-7.15.1/global_plugins/es-sql-site/site-server</span><br><span class="line">npm install express --save</span><br><span class="line">node node-server.js</span><br></pre></td></tr></table></figure><p>访问验证：<br><img src="/images/elasticsearch/es_20230802_001.png" alt="Elasticsearch-SQL"><br>无外网的情况下，将es-sql-site-standalone.zip上传到tomcat的webapps目录下解压,将es-sql-site-standalone作为一个web服务对外提供访问</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tomcat8/webapps/</span><br><span class="line">unzip es-sql-site-standalone.zip -d sql</span><br></pre></td></tr></table></figure><p>端口和es访问地址及api接口路径修改方式和上述相同，自行修改。</p><p>访问验证：<br>启动tomcat，访问 ip:端口/sql/_site/<br><img src="/images/elasticsearch/es_20230802_002.png" alt="Elasticsearch-SQL"></p><h1><span id="elasticsearch-sql和x-pack-sql差异"><span id="inline-blue">Elasticsearch-SQL和x-pack-sql差异</span></span></h1><p>Elasticsearch-SQL接口访问<br>访问地址<br><a href="http://10.26.0.22:9200/_nlpcn/sql">http://10.26.0.22:9200/_nlpcn/sql</a><br>参数信息,直接写查询SQL<br>{<br>SELECT * FROM nginx-error-2023.08.01<br>}</p><p><img src="/images/elasticsearch/es_20230802_003.png" alt="Elasticsearch-SQL"><br>x-pack-sql接口访问<br>访问地址<br><a href="http://10.26.0.22:9200/_sql">http://10.26.0.22:9200/_sql</a><br>参数信息,索引需要用\转义双引号包起来，否则查询失败<br>{<br>“query”: “SELECT * FROM &quot;nginx-error-2023.08.01&quot; “<br>}</p><p><img src="/images/elasticsearch/es_20230802_004.png" alt="Elasticsearch-SQL"></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Linux/blogs/Linux%20tar.xz%E6%A0%BC%E5%BC%8F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E5%91%BD%E4%BB%A4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Linux/blogs/Linux%20tar.xz%E6%A0%BC%E5%BC%8F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux tar.xz格式压缩文件解压命令</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-01 11:35:20" itemprop="dateCreated datePublished" datetime="2023-08-01T11:35:20+08:00">2023-08-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>133</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E7%9B%AE%E7%9A%84span"><span id="inline-blue">目的</span></a></li><li><a href="#span-idinline-blue%E8%A7%A3%E5%8E%8Bspan"><span id="inline-blue">解压</span></a></li></ul><h1><span id="目的"><span id="inline-blue">目的</span></span></h1><pre><code>tar.xz格式的压缩包和tar.gz格式解压命令不一样，记录一下</code></pre><h1><span id="解压"><span id="inline-blue">解压</span></span></h1><p>压缩文件名：glibc-2.27.tar.xz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进行两次解压</span></span><br><span class="line"><span class="meta">#</span><span class="bash">先解压xz</span></span><br><span class="line">xz -d glibc-2.27.tar.xz</span><br><span class="line"><span class="meta">#</span><span class="bash">在解压tar格式</span></span><br><span class="line">tar -xvf glibc-2.27.tar</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Linux/blogs/Linux%20curl%E5%91%BD%E4%BB%A4GET&POST%E8%AF%B7%E6%B1%82%E7%A4%BA%E4%BE%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Linux/blogs/Linux%20curl%E5%91%BD%E4%BB%A4GET&POST%E8%AF%B7%E6%B1%82%E7%A4%BA%E4%BE%8B/" class="post-title-link" itemprop="url">Linux curl命令GET&POST请求示例</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-01 11:29:20" itemprop="dateCreated datePublished" datetime="2023-08-01T11:29:20+08:00">2023-08-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>620</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E7%9B%AE%E7%9A%84span"><span id="inline-blue">目的</span></a></li><li><a href="#span-idinline-bluecurl%E5%91%BD%E4%BB%A4span"><span id="inline-blue">curl命令</span></a></li><li><a href="#span-idinline-blueget%E8%AF%B7%E6%B1%82%E7%A4%BA%E4%BE%8Bspan"><span id="inline-blue">GET请求示例</span></a></li><li><a href="#span-idinline-bluepost%E8%AF%B7%E6%B1%82%E7%A4%BA%E4%BE%8Bspan"><span id="inline-blue">POST请求示例</span></a></li></ul><h1><span id="目的"><span id="inline-blue">目的</span></span></h1><pre><code>因为VPN的原因导致不能直接通过第三方工具请求接口数据，需要直接在服务器上请求对应服务接口</code></pre><h1><span id="curl命令"><span id="inline-blue">curl命令</span></span></h1><p>选项<br>-X 指定请求的方式 GET/POST<br>-H 指定请求的头部信息<br>-d 指定请求的参数内容</p><h1><span id="get请求示例"><span id="inline-blue">GET请求示例</span></span></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl htttp://10.9.216.12:8080/iepg/getMarquee?terminalType=1&amp;version=20000</span><br></pre></td></tr></table></figure><h1><span id="post请求示例"><span id="inline-blue">POST请求示例</span></span></h1><p>向指定接口发送xml报文并指定头部请求信息<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://10.9.219.31:8080/GetItemData \</span><br><span class="line">  -H &quot;Content-Type: application/xml&quot; \</span><br><span class="line">  -H &quot;Host: 10.9.212.55:8080&quot; \</span><br><span class="line">  -H &quot;Connection: Keep-Alive&quot; \</span><br><span class="line">  -d &quot;&lt;GetItemData titleAssetId=&#x27;OTHE0000000001237979&#x27; portalId=&#x27;1&#x27; client=&#x27;8591102716069168&#x27; account=&#x27;8591102716069168&#x27; languageCode=&#x27;Zh-CN&#x27; profile=&#x27;1&#x27; /&gt;&quot;</span><br></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/WildFly/blogs/WildFly%E8%AF%B7%E6%B1%82%E8%BF%87%E6%BB%A4%E9%87%8D%E5%86%99%E5%AE%9E%E7%8E%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/WildFly/blogs/WildFly%E8%AF%B7%E6%B1%82%E8%BF%87%E6%BB%A4%E9%87%8D%E5%86%99%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">WildFly请求过滤重写实现</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-28 17:49:20" itemprop="dateCreated datePublished" datetime="2023-07-28T17:49:20+08:00">2023-07-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/WildFly/" itemprop="url" rel="index"><span itemprop="name">WildFly</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E8%83%8C%E6%99%AFspan"><span id="inline-blue">背景</span></a></li><li><a href="#span-idinline-bluewildfly%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0span"><span id="inline-blue">WildFly过滤器实现</span></a></li><li><a href="#span-idinline-blue%E9%85%8D%E7%BD%AEundertow%E5%AD%90%E7%B3%BB%E7%BB%9Fspan"><span id="inline-blue">配置undertow子系统</span></a></li></ul><h1><span id="背景"><span id="inline-blue">背景</span></span></h1><p>WildFly容器部署项目偶现400 Bad request请求，在排查环境没有结果的情况下希望通过记录wildFly的请求，分析请求内容处理这一异常请求。</p><h1><span id="wildfly过滤器实现"><span id="inline-blue">WildFly过滤器实现</span></span></h1><p>初始化maven项目custom-filter<br>pom.xml文件定义如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;custom-undertow-filter&lt;/name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.coship.wildfly.undertow.custom.filter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;custom-undertow-filter&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;slf4j-version&gt;1.7.12&lt;/slf4j-version&gt;</span><br><span class="line">        &lt;undertow-core-version&gt;2.2.16.Final&lt;/undertow-core-version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            We want to exclude module.xml from the artifact, it does not belong there.</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">                &lt;excludes&gt;</span><br><span class="line">                    &lt;exclude&gt;module.xml&lt;/exclude&gt;</span><br><span class="line">                &lt;/excludes&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">        &lt;pluginManagement&gt;</span><br><span class="line">            &lt;plugins&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;configuration&gt;</span><br><span class="line">                        &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                        &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;/configuration&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">                &lt;plugin&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;</span><br><span class="line">                    &lt;executions&gt;</span><br><span class="line">                        &lt;execution&gt;</span><br><span class="line">                            &lt;id&gt;attach-sources&lt;/id&gt;</span><br><span class="line">                            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                            &lt;goals&gt;</span><br><span class="line">                                &lt;goal&gt;jar&lt;/goal&gt;</span><br><span class="line">                            &lt;/goals&gt;</span><br><span class="line">                        &lt;/execution&gt;</span><br><span class="line">                    &lt;/executions&gt;</span><br><span class="line">                &lt;/plugin&gt;</span><br><span class="line">            &lt;/plugins&gt;</span><br><span class="line">        &lt;/pluginManagement&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;slf4j-version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;slf4j-version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.undertow&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;undertow-core&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;undertow-core-version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.undertow&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;undertow-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><p>项目只包含一个java类RewriteRequestURLHandler,实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.coship.wildfly.undertow.custom.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.undertow.server.HttpHandler;</span><br><span class="line"><span class="keyword">import</span> io.undertow.server.HttpServerExchange;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringEscapeUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RewriteRequestURLHandler</span> <span class="keyword">implements</span> <span class="title">HttpHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(RewriteRequestURLHandler.class);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> HttpHandler next;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Illegal whitespace encoding at the beginning and end of the URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span>  String escapedCharactersInUrl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">getEscapedCharactersInUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> escapedCharactersInUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">setEscapedCharactersInUrl</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.escapedCharactersInUrl = param;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RewriteRequestURLHandler</span><span class="params">(HttpHandler next)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(HttpServerExchange exchange)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String requestURI = exchange.getRequestURI();</span><br><span class="line">        String requestPath = exchange.getRequestPath();</span><br><span class="line">        String relativePath = exchange.getRelativePath();</span><br><span class="line">        log.info(<span class="string">&quot;rewrite before: requestURI&quot;</span>+requestURI+<span class="string">&quot;,length:&quot;</span>+requestURI.length());</span><br><span class="line">        log.info(<span class="string">&quot;rewrite before: requestPath&quot;</span>+requestPath+<span class="string">&quot;,length:&quot;</span>+requestPath.length());</span><br><span class="line">        log.info(<span class="string">&quot;rewrite before: relativePath&quot;</span>+relativePath+<span class="string">&quot;,length:&quot;</span>+relativePath.length());</span><br><span class="line">        <span class="keyword">if</span>(!isEmpty(escapedCharactersInUrl))&#123;</span><br><span class="line">            String [] escapedCharacters   = escapedCharactersInUrl.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(String escapedCharacter : escapedCharacters)&#123;</span><br><span class="line">                <span class="keyword">if</span>(requestURI.indexOf(escapedCharacter) == <span class="number">0</span> || requestURI.lastIndexOf(escapedCharacter) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    requestURI = trim(requestURI,escapedCharacter);</span><br><span class="line">                    exchange.setRequestURI(requestURI);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(requestPath.indexOf(escapedCharacter) == <span class="number">0</span> || requestPath.lastIndexOf(escapedCharacter) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    requestPath = trim(requestPath,escapedCharacter);</span><br><span class="line">                    exchange.setRequestPath(requestPath);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(relativePath.indexOf(escapedCharacter) == <span class="number">0</span> || relativePath.lastIndexOf(escapedCharacter) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    relativePath = trim(relativePath,escapedCharacter);</span><br><span class="line">                    exchange.setRelativePath(relativePath);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;rewrite after: requestURI&quot;</span>+requestURI+<span class="string">&quot;,length:&quot;</span>+requestURI.length());</span><br><span class="line">        log.info(<span class="string">&quot;rewrite after: requestPath&quot;</span>+requestPath+<span class="string">&quot;,length:&quot;</span>+requestPath.length());</span><br><span class="line">        log.info(<span class="string">&quot;rewrite after: relativePath&quot;</span>+relativePath+<span class="string">&quot;,length:&quot;</span>+relativePath.length());</span><br><span class="line">        next.handleRequest(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove illegal characters that appear at the beginning and end of the request URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> substr</span></span><br><span class="line"><span class="comment">     * example http://10.9.212.55:28080/GettItemData%20 -&gt;  http://10.9.212.55:28080/GettItemData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">trim</span><span class="params">(String str, String substr)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> beginIndexFlag;</span><br><span class="line">        <span class="keyword">boolean</span> endIndexFlag;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> beginIndex = str.indexOf(substr) == <span class="number">0</span> ? substr.length() : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> endIndex = str.lastIndexOf(substr) + substr.length() == str.length() ? str.lastIndexOf(substr) : str.length();</span><br><span class="line">            str = str.substring(beginIndex, endIndex);</span><br><span class="line">            beginIndexFlag = (str.indexOf(substr) == <span class="number">0</span>);</span><br><span class="line">            endIndexFlag = (str.lastIndexOf(substr) + substr.length() == str.length());</span><br><span class="line">        &#125; <span class="keyword">while</span> (beginIndexFlag || endIndexFlag);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * determine if the string is empty</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">isEmpty</span><span class="params">(String str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (str == <span class="keyword">null</span> || str.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目配置文件module.xml如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:jboss:module:1.6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;com.coship.wildfly.undertow.custom.filter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource-root</span> <span class="attr">path</span>=<span class="string">&quot;custom-undertow-filter-1.0.jar&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">&quot;io.undertow.core&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">&quot;org.slf4j&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以上就是自定义过滤器的实现，但是想要让WildFly加载自定义过滤器还需要做一下准备工作。<br>1、将custom-filter项目通过maven install打包后生成custom-filter-1.0.jar和module.xml文件上传服务器，在WildFly的主目录下module子目录下创建custom-filter项目的包目录,并创建子目录main,上传刚才打包的jar包和module.xml到main目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/fujian_sdp/wildfly26-portal/modules</span><br><span class="line">mkdir com/coship/wildfly/undertow/custom/filter/main</span><br></pre></td></tr></table></figure><p>custom-filter项目的包目录：com.coship.wildfly.undertow.custom.filter<br>WIldFly的module目录：/usr/local/fujian_sdp/wildfly26-portal/modules<br>如下图所示：<br><img src="/images/WildFly/WildFly_20230728_001.png" alt="WildFly过滤器重写"></p><h1><span id="配置undertow子系统"><span id="inline-blue">配置undertow子系统</span></span></h1><p>在undertow子系统声明filter,文件所在路径参考：/usr/local/fujian_sdp/wildfly26-portal/standalone/configuration/standalone.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">subsystem</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">name</span>=<span class="string">&quot;response-time&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">module</span>=<span class="string">&quot;com.novaordis.playground.wildfly.undertow.customfilter:1&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">class-name</span>=<span class="string">&quot;com.novaordis.playground.wildfly.undertow.customfilter.ResponseTimeHandler&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">subsystem</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>配置filter额外参数</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;param1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br></pre></td></tr></table></figure><p>为明确主机请求声明过滤器引用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">subsystem</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:jboss:domain:undertow:3.0&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">server</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="tag">&lt;<span class="name">host</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">location</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">           ...</span><br><span class="line">           <span class="tag">&lt;<span class="name">filter-ref</span> <span class="attr">name</span>=<span class="string">&quot;response-time&quot;</span>/&gt;</span></span><br><span class="line">           ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">subsystem</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Docker/blogs/Docker%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89IP/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Docker/blogs/Docker%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89IP/" class="post-title-link" itemprop="url">Docker容器实现自定义IP</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-28 14:49:20" itemprop="dateCreated datePublished" datetime="2023-07-28T14:49:20+08:00">2023-07-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E8%83%8C%E6%99%AFspan"><span id="inline-blue">背景</span></a></li><li><a href="#span-idinline-blue%E5%B7%A5%E5%85%B7span"><span id="inline-blue">工具</span></a></li><li><a href="#span-idinline-bluebridge-util%E5%AE%89%E8%A3%85span"><span id="inline-blue">bridge-util安装</span></a></li><li><a href="#span-idinline-bluepipework%E5%AE%89%E8%A3%85span"><span id="inline-blue">pipework安装</span></a></li><li><a href="#span-idinline-blue%E5%AE%B9%E5%99%A8%E8%87%AA%E5%AE%9A%E4%B9%89ipspan"><span id="inline-blue">容器自定义IP</span></a></li><li><a href="#span-idinline-blue%E9%AA%8C%E8%AF%81span"><span id="inline-blue">验证</span></a></li></ul><h2><span id="背景"><span id="inline-blue">背景</span></span></h2><p>应用使用docker容器化后，需要跨宿主机访问，实现要求是宿主机和内部容器可以互通，且外部主机可以直接访问容器服务</p><h2><span id="工具"><span id="inline-blue">工具</span></span></h2><p>bridge-util : linux系统网桥管理工具<br>pipework : Docker 网络增强插件</p><h2><span id="bridge-util安装"><span id="inline-blue">bridge-util安装</span></span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yum搜索bridge-util所在源</span><br><span class="line">[root@S21614 ~]# yum search bridge</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">==================================================================== N/S matched: bridge ====================================================================</span><br><span class="line">bridge-utils.x86_64 : Utilities for configuring the linux ethernet bridge</span><br><span class="line">cockpit-bridge.x86_64 : Cockpit bridge server-side component</span><br><span class="line">at-spi2-atk.x86_64 : A GTK+ module that bridges ATK to D-Bus at-spi</span><br><span class="line">at-spi2-atk-devel.x86_64 : A GTK+ module that bridges ATK to D-Bus at-spi</span><br><span class="line">ebtables.x86_64 : Ethernet Bridge frame table administration tool</span><br><span class="line">kaccessible.x86_64 : An accessibility bridge plugin</span><br><span class="line"></span><br><span class="line">  Name and summary matches only, use &quot;search all&quot; for everything.</span><br><span class="line"><span class="meta">  #</span><span class="bash">独立安装bridge-utils.x86_64</span></span><br><span class="line">[root@S21614 ~]# yum -y install bridge-utils.x86_64</span><br></pre></td></tr></table></figure><p>如果没有yum环境可以使用离线安装方式，离线安装包地址：<br><a href="https://www.linuxfromscratch.org/blfs/view/svn/basicnet/bridge-utils.html">https://www.linuxfromscratch.org/blfs/view/svn/basicnet/bridge-utils.html</a></p><h2><span id="pipework安装"><span id="inline-blue">pipework安装</span></span></h2><p><a id="download" href="/images/docker/pipwork/pipework"><i class="fa fa-download"></i><span>pipework下载</span></a><br>上传至服务器/usr/bin/目录下，并执行一下命令赋予可执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x /usr/bin/pipework</span><br></pre></td></tr></table></figure><h2><span id="容器自定义ip"><span id="inline-blue">容器自定义IP</span></span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">拉取nginx镜像</span></span><br><span class="line">docker pull centos</span><br><span class="line"><span class="meta">#</span><span class="bash">生成容器centos7_1、centos7_2</span></span><br><span class="line">docker run -itd --name centos7_1 --net=none eeb6ee3f44bd /bin/bash</span><br><span class="line">docker run -itd --name centos7_2 --net=none eeb6ee3f44bd /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash">生成网桥，并将容器ip与网桥添加关联，为容器设置自定义IP 10.9.216.101对应设置IP地址,10.9.216.254是网关</span></span><br><span class="line">pipework br0 centos7_1 10.9.216.101/24@10.9.216.254</span><br><span class="line">pipework br0 centos7_2 10.9.216.102/24@10.9.216.254</span><br><span class="line">[root@S21614 ~]# ifconfig</span><br><span class="line">br0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.9.216.14  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        inet6 fe80::cd2:b8ff:fe65:6480  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        inet6 10:9:216:0:10a5:faff:fe02:85b9  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        ether 12:a5:fa:02:85:b9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 66482  bytes 3751391 (3.5 MiB)</span><br><span class="line">        RX errors 0  dropped 490  overruns 0  frame 0</span><br><span class="line">        TX packets 64499  bytes 87368127 (83.3 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:66:bb:45:a6  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eno1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet6 10:9:216:0:42f2:e9ff:fe0d:cfb4  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::42f2:e9ff:fe0d:cfb4  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 40:f2:e9:0d:cf:b4  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 72999  bytes 5265597 (5.0 MiB)</span><br><span class="line">        RX errors 0  dropped 8  overruns 0  frame 0</span><br><span class="line">        TX packets 92671  bytes 93048588 (88.7 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        device memory 0xa9a60000-a9a7ffff  </span><br><span class="line"><span class="meta">#</span><span class="bash">将eno1网卡的ip地址移植到bro网桥,添加bro和eno1网关关联，为bro网桥和网关添加路由，以下命令必须在一行执行，否则会出现ssh断掉不能连接的情况</span></span><br><span class="line">ip addr add 10.9.216.14/24 dev br0; \</span><br><span class="line">ip addr del 10.9.216.14/24 dev eno1; \</span><br><span class="line">brctl addif br0 eno1; \</span><br><span class="line">route del default; \</span><br><span class="line">route add default gw 10.9.216.254 dev br0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除网桥和网卡eno1关联(如果ssh断掉的情况下需要执行以下命令删除网卡和网桥关联，这一步需要机房登陆服务器操作)</span></span><br><span class="line">brctl delif br0 eno1;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">brctl 相关命令</span></span><br><span class="line"></span><br><span class="line">参数	说明	示例</span><br><span class="line">addbr &lt;bridge&gt;	创建网桥	brctl addbr br10</span><br><span class="line">delbr &lt;bridge&gt;	删除网桥	brctl delbr br10</span><br><span class="line">addif &lt;bridge&gt; &lt;device&gt;	将网卡接口接入网桥	brctl addif br10 eth0</span><br><span class="line">delif &lt;bridge&gt; &lt;device&gt;	删除网桥接入的网卡接口	brctl delif br10 eth0</span><br><span class="line">show &lt;bridge&gt;	查询网桥信息	brctl show br10</span><br><span class="line">stp &lt;bridge&gt; &#123;on|off&#125;	启用禁用 STP	brctl stp br10 off/on</span><br><span class="line">showstp &lt;bridge&gt;	查看网桥 STP 信息	brctl showstp br10</span><br><span class="line">setfd &lt;bridge&gt; &lt;time&gt;	设置网桥延迟	brctl setfd br10 10</span><br><span class="line">showmacs &lt;bridge&gt;	查看 mac 信息	brctl showmacs br10</span><br></pre></td></tr></table></figure><h2><span id="验证"><span id="inline-blue">验证</span></span></h2><p>宿主机访问容器centos7_1: 10.9.216.101</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@S21614 ~]# ping 10.9.216.101</span><br><span class="line">PING 10.9.216.101 (10.9.216.101) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=1 ttl=64 time=0.162 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=2 ttl=64 time=0.047 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=3 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=4 ttl=64 time=0.048 ms</span><br><span class="line">^X64 bytes from 10.9.216.101: icmp_seq=5 ttl=64 time=0.067 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=6 ttl=64 time=0.048 ms</span><br></pre></td></tr></table></figure><p>宿主机访问容器centos7_2: 10.9.216.102</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@S21614 ~]# ping 10.9.216.102</span><br><span class="line">PING 10.9.216.102 (10.9.216.102) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=1 ttl=64 time=0.160 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=2 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=3 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=4 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=5 ttl=64 time=0.048 ms</span><br></pre></td></tr></table></figure><p>容器centos7_1访问宿主机10.9.216.14</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入容器centos7_1内部</span></span><br><span class="line">[root@S21614 ~]# docker exec -it centos7_1 /bin/bash</span><br><span class="line">[root@f843b5d71fdb /]# ping 10.9.216.14</span><br><span class="line">PING 10.9.216.14 (10.9.216.14) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=1 ttl=64 time=0.109 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=2 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=3 ttl=64 time=0.056 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=4 ttl=64 time=0.058 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=5 ttl=64 time=0.056 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=6 ttl=64 time=0.056 ms</span><br></pre></td></tr></table></figure><p>容器centos7_1(10.9.216.101)访问容器centos7_2(10.9.216.102)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@f843b5d71fdb /]# ping 10.9.216.102</span><br><span class="line">PING 10.9.216.102 (10.9.216.102) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=1 ttl=64 time=0.197 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=2 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=3 ttl=64 time=0.070 ms</span><br><span class="line">64 bytes from 10.9.216.102: icmp_seq=4 ttl=64 time=0.069 ms</span><br></pre></td></tr></table></figure><p>容器centos7_2访问宿主机10.9.216.14</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@9210f0ab69fe /]# ping 10.9.216.14 </span><br><span class="line">PING 10.9.216.14 (10.9.216.14) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=1 ttl=64 time=0.088 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=2 ttl=64 time=0.060 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=3 ttl=64 time=0.057 ms</span><br><span class="line">64 bytes from 10.9.216.14: icmp_seq=4 ttl=64 time=0.070 ms</span><br></pre></td></tr></table></figure><p>容器centos7_2(10.9.216.101)访问容器centos7_1(10.9.216.102)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入容器centos7_2内部</span></span><br><span class="line">[root@S21614 ~]# docker exec -it centos7_2 /bin/bash</span><br><span class="line">[root@9210f0ab69fe /]# ping 10.9.216.101</span><br><span class="line">PING 10.9.216.101 (10.9.216.101) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=1 ttl=64 time=0.114 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=2 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=3 ttl=64 time=0.072 ms</span><br><span class="line">64 bytes from 10.9.216.101: icmp_seq=4 ttl=64 time=0.070 ms</span><br></pre></td></tr></table></figure><p>服务器重启之后网桥信息会丢失，需要重新配置</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Linux/blogs/Tcpdump%E6%8A%93%E5%8C%85/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Linux/blogs/Tcpdump%E6%8A%93%E5%8C%85/" class="post-title-link" itemprop="url">Tcpdump抓包</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-28 14:49:20" itemprop="dateCreated datePublished" datetime="2023-07-28T14:49:20+08:00">2023-07-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>504</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E7%9B%AE%E7%9A%84span"><span id="inline-blue">目的</span></a></li><li><a href="#span-idinline-bluetcpdump%E5%91%BD%E4%BB%A4span"><span id="inline-blue">tcpdump命令</span></a></li><li><a href="#span-idinline-blue%E7%A4%BA%E4%BE%8Bspan"><span id="inline-blue">示例</span></a></li><li><a href="#span-idinline-blue%E5%85%B3%E9%94%AE%E5%AD%97%E6%90%9C%E7%B4%A2span"><span id="inline-blue">关键字搜索</span></a></li></ul><h1><span id="目的"><span id="inline-blue">目的</span></span></h1><pre><code>抓取Linux服务器上来自某一特定IP地址和端口的请求信息</code></pre><h1><span id="tcpdump命令"><span id="inline-blue">tcpdump命令</span></span></h1><p>选项<br>-i # 指定监听网络接口<br>-w # 将捕获到的信息保存到文件中，且不分析和打印在屏幕<br>-r # 从文件中读取数据<br>-n # 不把 ip 转化成域名<br>-t # 在每行的输出中不显示时间<br>-v # 产生详细的输出<br>-vv # 产生比-v选项更为详细的输出<br>-c # 指定收取数据包的次数<br>-C # 与 -w FILE 选项配合使用<br>-Q # 选择是入方向还是出方向的数据包<br>-q # 简洁地打印输出<br>-s # 指定每个包捕获的长度<br>-A # 以 ASCII 格式打印出所有的分组并且读取此文件<br>-e # 在输出行打印出数据链路层的头部信息<br>-F # 指定使用哪个文件的过滤表达式抓包<br>-l # 对标准输出进行行缓冲</p><h1><span id="示例"><span id="inline-blue">示例</span></span></h1><p>抓取源地址10.9212.55请求目的地址10.9.219.31对应8080端口请求信息<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth1 port 8080 and src host 10.9.212.55 and dst host 10.9.219.31 -s 0 -vv -w /tmp/1.cap</span><br></pre></td></tr></table></figure><p></p><h1><span id="关键字搜索"><span id="inline-blue">关键字搜索</span></span></h1><p>报文通过wireshark打开后点击下图中的搜索图标，将搜索类型修改为字符串，在搜索框填写关键字，点击查找即开始查找。<br><img src="/images/linux/Linux_20230728_001.png" alt="wireshark分析"></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Minio/blogs/Docker%E9%83%A8%E7%BD%B2minio%EF%BC%8C%E5%88%86%E4%BA%AB%E5%9C%B0%E5%9D%80%E4%B8%BADocker%E5%86%85ip%E5%9C%B0%E5%9D%80%E9%97%AE%E9%A2%98/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Minio/blogs/Docker%E9%83%A8%E7%BD%B2minio%EF%BC%8C%E5%88%86%E4%BA%AB%E5%9C%B0%E5%9D%80%E4%B8%BADocker%E5%86%85ip%E5%9C%B0%E5%9D%80%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">Docker部署Minio，分享地址为Docker内ip地址问题</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-18 17:45:20" itemprop="dateCreated datePublished" datetime="2023-07-18T17:45:20+08:00">2023-07-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Minio/" itemprop="url" rel="index"><span itemprop="name">Minio</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E8%83%8C%E6%99%AFspan"><span id="inline-blue">背景</span></a></li><li><a href="#span-idinline-blue%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95span"><span id="inline-blue">解决办法</span></a></li><li><a href="#span-idinline-blue%E9%AA%8C%E8%AF%81span"><span id="inline-blue">验证</span></a></li></ul><h2><span id="背景"><span id="inline-blue">背景</span></span></h2><p>通过Docker拉取minio镜像，生成容器访问后发现分享的地址是docker容器内部的ip地址，导致无法访问</p><h2><span id="解决办法"><span id="inline-blue">解决办法</span></span></h2><p>拉取minio镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull minio/minio</span><br></pre></td></tr></table></figure><p>生成容器并后台启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 -p 9091:9091 --name=minio --restart=always -e &quot;MINIO_SERVER_URL=http://192.168.99.100:9000&quot; -e &quot;MINIO_ACCESS_KEY=admin&quot; -e &quot;MINIO_SECRET_KEY=admin123&quot; -v /d/minio/upload/data:/data -v /d/minio/upload/data:/root/.minio  minio/minio server /data --console-address &quot;:9091&quot; --address &quot;:9000&quot;</span><br></pre></td></tr></table></figure><p>-e “MINIO_SERVER_URL=<a href="http://192.168.99.100:9000&quot;">http://192.168.99.100:9000&quot;</a> 参数指定生成minio应用程序分享地址环境变量</p><h2><span id="验证"><span id="inline-blue">验证</span></span></h2><p>再次上传文件并分享后分享图片链接地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.99.100:9000/test/logo.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=YLMFB2ERQR4GQDRZ0IRA%2F20230718%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20230718T081006Z&amp;X-Amz-Expires=604800&amp;X-Amz-Security-Token=eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJZTE1GQjJFUlFSNEdRRFJaMElSQSIsImV4cCI6MTY4OTY3MTI1MSwicGFyZW50IjoiYWRtaW4ifQ.hiSBI9bahX8crhponMuIglPWArfm5Y4-PcW5MTdPsKdXnWJeyiIDumvCTh9Pg1eNsnHkKxNQnx-yOeWfUgIU1g&amp;X-Amz-SignedHeaders=host&amp;versionId=null&amp;X-Amz-Signature=139e32da7c2541b2cc16d01d2157256196711f24afb8034046eebbccf6e728ef</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Nginx/blogs/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/Nginx/blogs/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AF%BC%E8%87%B4%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6/" class="post-title-link" itemprop="url">Nginx反向代理导致接口响应超时</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-18 16:45:20" itemprop="dateCreated datePublished" datetime="2023-07-18T16:45:20+08:00">2023-07-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.7k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-blue%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84span"><span id="inline-blue">代理访问路径</span></a></li><li><a href="#span-idinline-blue%E9%85%8D%E7%BD%AE%E8%AF%A6%E6%83%85span"><span id="inline-blue">配置详情</span></a></li><li><a href="#span-idinline-blue%E5%8E%9F%E5%9B%A0span"><span id="inline-blue">原因</span></a></li><li><a href="#span-idinline-blue%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95span"><span id="inline-blue">解决办法</span></a></li></ul><h2><span id="代理访问路径"><span id="inline-blue">代理访问路径</span></span></h2><p>接口真实访问地址：<a href="http://10.26.0.19:9001/prodtest/admin/user/getCaptcha?width=140&amp;height=50">http://10.26.0.19:9001/prodtest/admin/user/getCaptcha?width=140&amp;height=50</a></p><p>接口代理访问地址：<a href="http://10.26.0.19:8080/prodtest/admin/user/getCaptcha?width=140&amp;height=50">http://10.26.0.19:8080/prodtest/admin/user/getCaptcha?width=140&amp;height=50</a></p><h2><span id="配置详情"><span id="inline-blue">配置详情</span></span></h2><p>前端访问接口耗时接近10秒，nginx代理超时配置配置多少都是等待超时然后请求报错</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">		client_max_body_size 1024m; </span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  10.26.0.19;</span><br><span class="line">		try_files $uri $uri/ /index.html;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line"><span class="meta">			#</span><span class="bash">gzip_static on; <span class="comment"># 开启后查找.gz结尾的文件直接返回，不进行压缩</span></span></span><br><span class="line">			gzip_min_length 1k; # 文件大于1K才进行压缩</span><br><span class="line">			gzip_http_version 1.1; # 设置gzip针对的http协议版本</span><br><span class="line">			gzip_comp_level 9; # 压缩级别，1-9，数字越大压缩越好，越占用cpu</span><br><span class="line">			gzip_types  text/css application/javascript; # 进行压缩的文件类型</span><br><span class="line">			autoindex on;</span><br><span class="line">            root   /home/prodtest/dist-protest;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">			try_files $uri $uri/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line"><span class="meta">		#</span><span class="bash"> 反向代理</span></span><br><span class="line">        location /prodtest &#123;</span><br><span class="line">			 #gzip_static on; # 开启后查找.gz结尾的文件直接返回，不进行压缩</span><br><span class="line">			 gzip_min_length 1k; # 文件大于1K才进行压缩</span><br><span class="line">			 gzip_http_version 1.1; # 设置gzip针对的http协议版本</span><br><span class="line">			 gzip_comp_level 9; # 压缩级别，1-9，数字越大压缩越好，越占用cpu</span><br><span class="line">			 gzip_types  text/css application/javascript; # 进行压缩的文件类型</span><br><span class="line">             proxy_pass http://10.26.0.19:9001/prodtest;</span><br><span class="line">             proxy_set_header Host 10.26.0.19;</span><br><span class="line">             proxy_connect_timeout 10;</span><br><span class="line">             proxy_send_timeout 10;</span><br><span class="line">             proxy_read_timeout 10;</span><br><span class="line">             send_timeout 10;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure><h2><span id="原因"><span id="inline-blue">原因</span></span></h2><p>域名解析导致<br>文件/etc/resolv.conf配置内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">; generated by /usr/sbin/dhclient-script</span></span><br><span class="line">search openstacklocal novalocal</span><br><span class="line"><span class="meta">#</span><span class="bash">nameserver 114.114.114.114</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nameserver 8.8.8.8</span></span><br><span class="line">nameserver 10.26.0.2</span><br><span class="line">nameserver 10.26.0.1</span><br><span class="line">nameserver 10.26.0.3</span><br></pre></td></tr></table></figure><p>search openstacklocal novalocal<br>search 的作用：<br>当访问的域名不能被DNS解析时，resolver会将该域名加上search后面指定的参数，重新请求DNS，直到被正确解析或试完search指定的列表为止。<br>示例：主机名为app1.novalocal，请求主机名对应的服务nacos，端口连接变成app1.novalocal.novalocal</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@app1.novalocal etc]# lsof -i:9848</span><br><span class="line">COMMAND   PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java     5579 root   73u  IPv6 37126139      0t0  TCP app1.novalocal.novalocal:51446-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java     5579 root   76u  IPv6 37130258      0t0  TCP app1.novalocal.novalocal:51452-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java     9071 root    9u  IPv6 32331770      0t0  TCP app1.novalocal:58587-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java     9071 root   72u  IPv6 32329519      0t0  TCP app1.novalocal:58598-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    28503 root   25u  IPv6 37128402      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:51446 (ESTABLISHED)</span><br><span class="line">java    28503 root  200u  IPv6 31969988      0t0  TCP *:9848 (LISTEN)</span><br><span class="line">java    28503 root  284u  IPv6 32242521      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:57686 (ESTABLISHED)</span><br><span class="line">java    28503 root  287u  IPv6 37128424      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:51452 (ESTABLISHED)</span><br><span class="line">java    28503 root  289u  IPv6 32126224      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56532 (ESTABLISHED)</span><br><span class="line">java    28503 root  290u  IPv6 32329520      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:58598 (ESTABLISHED)</span><br><span class="line">java    28503 root  292u  IPv6 32242558      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:57700 (ESTABLISHED)</span><br><span class="line">java    28503 root  295u  IPv6 32128146      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56550 (ESTABLISHED)</span><br><span class="line">java    28503 root  296u  IPv6 32331775      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:58587 (ESTABLISHED)</span><br><span class="line">java    28503 root  299u  IPv6 32125133      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56558 (ESTABLISHED)</span><br><span class="line">java    28503 root  303u  IPv6 32125156      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56582 (ESTABLISHED)</span><br><span class="line">java    28503 root  304u  IPv6 32121662      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56572 (ESTABLISHED)</span><br><span class="line">java    28503 root  306u  IPv6 32127363      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56598 (ESTABLISHED)</span><br><span class="line">java    28503 root  307u  IPv6 32125183      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56587 (ESTABLISHED)</span><br><span class="line">java    28503 root  317u  IPv6 32123270      0t0  TCP app1.novalocal:9848-&gt;app1.novalocal:56614 (ESTABLISHED)</span><br><span class="line">java    28551 root   10u  IPv6 32242520      0t0  TCP app1.novalocal:57686-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    28551 root   24u  IPv6 32238089      0t0  TCP app1.novalocal:57700-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32458 root    6u  IPv6 32124384      0t0  TCP app1.novalocal:56532-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32458 root   77u  IPv6 32121614      0t0  TCP app1.novalocal:56550-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32542 root    7u  IPv6 32125129      0t0  TCP app1.novalocal:56558-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32542 root   76u  IPv6 32125155      0t0  TCP app1.novalocal:56582-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32580 root    7u  IPv6 32125151      0t0  TCP app1.novalocal:56572-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32580 root   76u  IPv6 32123269      0t0  TCP app1.novalocal:56614-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32627 root   77u  IPv6 32122582      0t0  TCP app1.novalocal:56598-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br><span class="line">java    32627 root   78u  IPv6 32124395      0t0  TCP app1.novalocal:56587-&gt;app1.novalocal:9848 (ESTABLISHED)</span><br></pre></td></tr></table></figure><h2><span id="解决办法"><span id="inline-blue">解决办法</span></span></h2><p>修改/etc/resolv.conf配置内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">; generated by /usr/sbin/dhclient-script</span></span><br><span class="line"><span class="meta">#</span><span class="bash">search openstacklocal novalocal</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nameserver 114.114.114.114</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nameserver 8.8.8.8</span></span><br><span class="line">nameserver 10.26.0.2</span><br><span class="line">nameserver 10.26.0.1</span><br><span class="line">nameserver 10.26.0.3</span><br></pre></td></tr></table></figure><p>修改/etc/hosts配置内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">60.190.232.46 open.ys7.com</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.26.0.19 app1</span><br></pre></td></tr></table></figure><p>重新请求恢复正常。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">vanishke</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.2m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">17:58</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/bookmark.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/search/local-search.min.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/tags/pdf.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/pace.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.2.0/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://github.com/vanishke/hexo/page/12/"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/quicklink.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"vanishke","repo":"blog-comments","client_id":"95db1f51f05191be80c5","client_secret":"eccc0bbe52b90a08e97140cece84ee32577172b2","admin_user":"['vanishke']","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"3ba90f6292733f8d382b1536c774d213"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/comments/gitalk.min.js"></script></body></html>