!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(im){"use strict";try{(function(){var f,t,e=(t=im)&&"object"==typeof t&&"default"in t?t:{default:t},r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(ge=f=f||{})[ge.DEBUG=0]="DEBUG",ge[ge.VERBOSE=1]="VERBOSE",ge[ge.INFO=2]="INFO",ge[ge.WARN=3]="WARN",ge[ge.ERROR=4]="ERROR",ge[ge.SILENT=5]="SILENT";var o={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},a=f.INFO,u=((me={})[f.DEBUG]="log",me[f.VERBOSE]="log",me[f.INFO]="info",me[f.WARN]="warn",me[f.ERROR]="error",me),c=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in f))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),h.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],t)),this._logHandler.apply(this,s([this,f.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],t)),this._logHandler.apply(this,s([this,f.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],t)),this._logHandler.apply(this,s([this,f.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],t)),this._logHandler.apply(this,s([this,f.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],t)),this._logHandler.apply(this,s([this,f.ERROR],t))},h);function h(t){this.name=t,this._logLevel=a,this._logHandler=i,this._userLogHandler=null}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var p,d="FirebaseError",m=(n(v,p=Error),v);function v(t,e,n){return(e=p.call(this,e)||this).code=t,e.customData=n,e.name=d,Object.setPrototypeOf(e,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=(t=this.errors[t])?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=_||self;function D(){}function A(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function N(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var C="closure_uid_"+(1e9*Math.random()>>>0),k=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function L(t,e,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:R).apply(null,arguments)}function O(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function P(){return Date.now()}function M(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,C)&&this[C]||(this[C]=++k))},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},V=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function U(){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function j(t){return/^[\s\xa0]*$/.test(t)}var G=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function K(t,e){return-1!=t.indexOf(e)}function z(t,e){return t<e?-1:e<t?1:0}var Q=S.navigator;function H(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function W(t){var e,n={};for(e in t)n[e]=t[e];return n}st=(Q=Q&&Q.userAgent)?Q:"";var Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Y.length;i++)e=Y[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function J(t){return J[" "](t),t}J[" "]=D;var $,Z=K(st,"Opera"),tt=K(st,"Trident")||K(st,"MSIE"),et=K(st,"Edge"),nt=et||tt,rt=K(st,"Gecko")&&!(K(st.toLowerCase(),"webkit")&&!K(st,"Edge"))&&!(K(st,"Trident")||K(st,"MSIE"))&&!K(st,"Edge"),it=K(st.toLowerCase(),"webkit")&&!K(st,"Edge");function ot(){var t=S.document;return t?t.documentMode:void 0}var Q="",st=(st=st,rt?/rv:([^\);]+)(\)|;)/.exec(st):et?/Edge\/([\d\.]+)/.exec(st):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):it?/WebKit\/(\S+)/.exec(st):Z?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);st&&(Q=st?st[1]:""),$=tt&&null!=(st=ot())&&st>parseFloat(Q)?String(st):Q;var at={};function ut(a){return t=a,e=function(){for(var t=0,e=G(String($)).split("."),n=G(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||z(0==o[2].length,0==s[2].length)||z(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=at,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var ct=S.document&&tt&&(ot()||parseInt($,10))||void 0,ht=!tt||9<=Number(ct),lt=tt&&!ut("9"),ft=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(t){}return t}();function pt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function dt(t,e){if(pt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rt){t:{try{J(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:yt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}pt.prototype.b=function(){this.defaultPrevented=!0},M(dt,pt);var yt={2:"touch",3:"pen",4:"mouse"};dt.prototype.b=function(){dt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,lt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var gt="closure_listenable_"+(1e6*Math.random()|0),mt=0;function vt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++mt,this.Y=this.Z=!1}function bt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function wt(t){this.src=t,this.a={},this.b=0}function Et(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=q(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(bt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Tt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}wt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Tt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new vt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var It="closure_lm_"+(1e6*Math.random()|0),_t={};function St(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Lt(r),e&&e[gt]?e.wa(n,r,N(i)?!!i.capture:!!i,o):Dt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)St(t,e[o],n,r,i);return null}return n=Lt(n),t&&t[gt]?t.va(e,n,N(r)?!!r.capture:!!r,i):Dt(t,e,n,!1,r,i)}function Dt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=N(i)?!!i.capture:!!i;if(s&&!ht)return null;var a,u,c=xt(t);if(c||(t[It]=c=new wt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=kt,r=u=ht?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)void 0===(i=ft?i:s)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Nt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function At(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[gt]?Et(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Nt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=xt(e))?(Et(n,t),0==n.b&&(n.src=null,e[It]=null)):bt(t)))}function Nt(t){return t in _t?_t[t]:_t[t]="on"+t}function Ct(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&At(t),n.call(r,e)}function kt(t,e){if(t.Y)return!0;if(ht)return Ct(t,new dt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ct(t,e=new dt(e,this))}function xt(t){return(t=t[It])instanceof wt?t:null}var Rt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lt(e){return"function"==typeof e?e:(e[Rt]||(e[Rt]=function(t){return e.handleEvent(t)}),e[Rt])}function Ot(){F.call(this),this.c=new wt(this),(this.J=this).C=null}function Pt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new pt(e,t):e instanceof pt?e.target=e.target||t:(s=e,X(e=new pt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Mt(o,r,!0,e)&&s;if(s=Mt(o=e.a=t,r,!0,e)&&s,s=Mt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Mt(o=e.a=n[i],r,!1,e)&&s}function Mt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.ca||u.src,u.Z&&Et(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}M(Ot,F),Ot.prototype[gt]=!0,(st=Ot.prototype).addEventListener=function(t,e,n,r){St(this,t,e,n,r)},st.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=N(i)?!!i.capture:!!i,r=Lt(r),e&&e[gt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Tt(s=e.a[n],r,i,o))&&(bt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&xt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?Tt(n,r,i,o):e)?n[e]:null)&&At(r))}(this,t,e,n,r)},st.G=function(){if(Ot.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)bt(n[r]);delete e.a[t],e.b--}}this.C=null},st.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},st.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ft=S.JSON.stringify;function qt(){this.b=this.a=null}var Vt,Ut=(Bt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Bt(function(){return new jt},function(t){t.reset()}));function Bt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function jt(){this.next=this.b=this.a=null}function Gt(t,e){var n;Vt||(n=S.Promise.resolve(void 0),Vt=function(){n.then(Qt)}),Kt||(Vt(),Kt=!0),zt.add(t,e)}qt.prototype.add=function(t,e){var n=Ut.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},jt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Kt=!(jt.prototype.reset=function(){this.next=this.b=this.a=null}),zt=new qt;function Qt(){for(var t,e;n=e=void 0,n=null,(e=zt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){S.setTimeout(function(){throw t},0)}(t)}var n=Ut;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Kt=!1}function Ht(t,e){Ot.call(this),this.b=t||1,this.a=e||S,this.f=L(this.Za,this),this.g=P()}function Wt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Yt(t,e,n){if("function"==typeof t)n&&(t=L(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=L(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}M(Ht,Ot),(st=Ht.prototype).aa=!1,st.M=null,st.Za=function(){var t;this.aa&&(0<(t=P()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Pt(this,"tick"),this.aa&&(Wt(this),this.start())))},st.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=P())},st.G=function(){Ht.X.G.call(this),Wt(this),delete this.a};var Xt,Jt,$t=(T(Jt=te,Q=Xt=F),Jt.prototype=null===Q?Object.create(Q):(Zt.prototype=Q.prototype,new Zt),te.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Yt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},te.prototype.G=function(){Xt.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},te);function Zt(){this.constructor=Jt}function te(t,e){var n=Xt.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ee(t){F.call(this),this.b=t,this.a={}}M(ee,F);var ne=[];function re(t,e,n,r){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var o=St(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ie(t){H(t.a,function(t,e){this.a.hasOwnProperty(e)&&At(t)},t),t.a={}}function oe(){this.a=!0}function se(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)&&"noop"!=(r=i[0])&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}return Ft(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},oe.prototype.info=function(){};var ae={},ue=null;function ce(){return ue=ue||new Ot}function he(t){pt.call(this,ae.Fa,t)}function le(){var t=ce();Pt(t,new he(t))}function fe(t,e){pt.call(this,ae.STAT_EVENT,t),this.stat=e}function pe(t){var e=ce();Pt(e,new fe(e,t))}function de(t){pt.call(this,ae.Ga,t)}function ye(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}ae.Fa="serverreachability",M(he,pt),ae.STAT_EVENT="statevent",M(fe,pt),ae.Ga="timingevent",M(de,pt);var ge={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},me={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function ve(){}function be(t){var e;return(e=t.a)?e:t.a={}}function we(){}function Ee(){pt.call(this,"d")}function Te(){pt.call(this,"c")}function Ie(){}function _e(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ee(this),this.P=De,t=nt?125:void 0,this.R=new Ht(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}ve.prototype.a=null,_={OPEN:"a",eb:"b",Ea:"c",qb:"d"},M(Ee,pt),M(Te,pt),M(Ie,ve);var Se=new Ie,De=45e3,Ae={},Ne={};function Ce(t,e,n){t.H=1,t.i=Xe(Ke(e)),t.j=n,t.I=!0,ke(t,null)}function ke(t,e){t.u=P(),Re(t),t.l=Ke(t.i);var s,a,u,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),hn(n.b,"t",r),t.D=0,t.a=rr(t.g,t.g.C?e:null),0<t.O&&(t.F=new $t(L(t.Ca,t,t.a),t.O)),re(t.J,t.a,"readystatechange",t.Xa),e=t.B?W(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(),s=t.c,a=t.m,u=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function xe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Ne:(i=Number(a.substring(i,o)),isNaN(i)?Ae:(o+=1)+i>a.length?Ne:(a=a.substr(o,i),r.D=o+i,a)));if(a==Ne){4==e&&(t.h=4,pe(14),s=!1),se(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ae){t.h=4,pe(15),se(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}se(t.c,t.f,a,null),Fe(t,a)}4==e&&0==n.length&&(t.h=1,pe(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yn(e),e.F=!0,pe(11))):(se(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Pe(t))}function Re(t){t.T=P()+t.P,Le(t,t.P)}function Le(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ye(L(t.Va,t),e)}function Oe(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function Pe(t){0==t.g.v||t.A||$n(t.g,t)}function Me(t){Oe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Wt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Fe(t,e){try{var n,r,i,o,s,a=t.g;if(0!=a.v&&(a.a==t||mn(a.b,t)))if(a.I=t.N,!t.C&&mn(a.b,t)&&3==a.v){try{var u=a.ka.a.parse(e)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){t:if(!a.j){if(a.a){if(!(a.a.u+3e3<t.u))break t;Jn(a),Un(a)}Wn(a),pe(18)}}else a.oa=c[1],0<a.oa-a.P&&c[2]<37500&&a.H&&0==a.o&&!a.m&&(a.m=ye(L(a.Sa,a),6e3));if(gn(a.b)<=1&&a.ea){try{a.ea()}catch(t){}a.ea=void 0}}else tr(a,11)}else if(!t.C&&a.a!=t||Jn(a),!j(e))for(e=u=a.ka.a.parse(e),u=0;u<e.length;u++)c=e[u],a.P=c[0],c=c[1],2==a.v?"c"==c[0]?(a.J=c[1],a.ga=c[2],null!=(r=c[3])&&(a.ha=r,a.c.info("VER="+a.ha)),null!=(o=c[4])&&(a.pa=o,a.c.info("SVER="+a.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,a.D=n,a.c.info("backChannelRequestTimeoutMs_="+n)),n=a,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(K(r,"spdy")||K(r,"quic")||K(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(vn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,Ye(n.B,n.A,s))),a.v=3,a.f&&a.f.ta(),a.U&&(a.N=P()-t.u,a.c.info("Handshake RTT: "+a.N+"ms")),i=t,(n=a).la=nr(n,n.C?n.ga:null,n.fa),i.C?(bn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Oe(o),Re(o)),n.a=i):Hn(n),0<a.g.length&&Gn(a)):"stop"!=c[0]&&"close"!=c[0]||tr(a,7):3==a.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?tr(a,7):Vn(a):"noop"!=c[0]&&a.f&&a.f.sa(c),a.o=0);le()}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(A(t)||"string"==typeof t)V(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(A(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(A(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ve(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ve)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ue(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Be(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Be(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(st=_e.prototype).setTimeout=function(t){this.P=t},st.Xa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},st.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||le(),Oe(this);var i=this.a.W();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,a=this.m,u=this.l,c=this.f,h=this.S,l=e,f=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+a+"\n"+u+"\n"+l+" "+f}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,pe(12),Me(this),Pe(this);break t}se(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Fe(this,s)}this.I?(xe(this,e,n),nt&&this.b&&3==e&&(re(this.J,this.R,"tick",this.Wa),this.R.start())):(se(this.c,this.f,n,null),Fe(this,n)),4==e&&Me(this),this.b&&!this.A&&(4==e?$n(this.g,this):(this.b=!1,Re(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,pe(12)):(this.h=0,pe(13)),Me(this),Pe(this)}}}catch(t){}var a,u,c,h,l,f},st.Wa=function(){var t,e;this.a&&(t=Pn(this.a),e=this.a.$(),this.D<e.length&&(Oe(this),xe(this,t,e),this.b&&4!=t&&Re(this)))},st.cancel=function(){this.A=!0,Me(this)},st.Va=function(){this.o=null;var t,e,n=P();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(le(),pe(17)),Me(this),this.h=2,Pe(this)):Le(this,this.T-n)},(st=Ve.prototype).K=function(){Ue(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},st.L=function(){return Ue(this),this.a.concat()},st.get=function(t,e){return Be(this.b,t)?this.b[t]:e},st.set=function(t,e){Be(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},st.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge?(this.a=void 0!==e?e:t.a,ze(this,t.f),this.j=t.j,Qe(this,t.c),He(this,t.h),this.g=t.g,e=t.b,(n=new sn).c=e.c,e.a&&(n.a=new Ve(e.a),n.b=e.b),We(this,n),this.i=t.i):t&&(n=String(t).match(je))?(this.a=!!e,ze(this,n[1]||"",!0),this.j=Je(n[2]||""),Qe(this,n[3]||"",!0),He(this,n[4]),this.g=Je(n[5]||"",!0),We(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new sn(null,this.a))}function Ke(t){return new Ge(t)}function ze(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Qe(t,e,n){t.c=n?Je(e,!0):e}function He(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function We(t,e,n){var r,i;e instanceof sn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(an(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),hn(this,n,t))},r)),r.f=i):(n||(e=$e(e,rn)),t.b=new sn(e,t.a))}function Ye(t,e,n){t.b.set(e,n)}function Xe(t){return Ye(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^P()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $e(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ze),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function Ze(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push($e(e,tn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push($e(e,tn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push($e(n,"/"==n.charAt(0)?nn:en,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",$e(n,on)),t.join("")};var tn=/[#\/\?@]/g,en=/[#\?:]/g,nn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function sn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(o){o.a||(o.a=new Ve,o.b=0,o.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",o.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(o.c))}function un(t,e){an(t),e=ln(t,e),Be(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Be((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ue(t)))}function cn(t,e){return an(t),e=ln(t,e),Be(t.a.b,e)}function hn(t,e,n){un(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),B(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f?e.toLowerCase():e}(st=sn.prototype).add=function(t,e){an(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},st.forEach=function(n,r){an(this),this.a.forEach(function(t,e){V(t,function(t){n.call(r,t,e,this)},this)},this)},st.L=function(){an(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},st.K=function(t){an(this);var e=[];if("string"==typeof t)cn(this,t)&&(e=U(e,this.a.get(ln(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},st.set=function(t,e){return an(this),this.c=null,cn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},st.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},st.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};function fn(t,e){this.b=t,this.a=e}function pn(t){this.g=t||dn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var dn=10;function yn(t){return t.b||t.a&&t.a.size>=t.f}function gn(t){return t.b?1:t.a?t.a.size:0}function mn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function vn(t,e){t.a?t.a.add(e):t.b=e}function bn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function wn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return B(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function En(){}function Tn(){this.a=new En}function In(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}pn.prototype.cancel=function(){var t,e;if(this.c=wn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var _n=S.JSON.parse;function Sn(t){Ot.call(this),this.headers=new Ve,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Dn,this.D=this.F=!1}M(Sn,Ot);var Dn="",An=/^https?$/i,Nn=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,xn(t),Ln(t)}function xn(t){t.u||(t.u=!0,Pt(t,"complete"),Pt(t,"error"))}function Rn(t){if(t.b&&(!t.s[1]||4!=Pn(t)||2!=t.W()))if(t.l&&4==Pn(t))Yt(t.za,0,t);else if(Pt(t,"readystatechange"),4==Pn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(je)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!An.test(i?i.toLowerCase():"")),e=n),e)Pt(t,"complete"),Pt(t,"success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",xn(t)}}finally{Ln(t)}}}function Ln(t,e){if(t.a){On(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||Pt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function On(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",H(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ye(t,e,n))}function Fn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function qn(t){this.pa=0,this.g=[],this.c=new oe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Fn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Fn("baseRetryDelayMs",5e3,t),this.Ra=Fn("retryDelaySeedMs",1e4,t),this.Ma=Fn("forwardChannelMaxRetries",2,t),this.ma=Fn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new pn(t&&t.concurrentRequestLimit),this.ka=new Tn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Vn(t){var e,n;Bn(t),3==t.v&&(e=t.R++,Ye(n=Ke(t.B),"SID",t.J),Ye(n,"RID",e),Ye(n,"TYPE","terminate"),zn(t,n),(e=new _e(t,t.c,e,void 0)).H=2,e.i=Xe(Ke(n)),n=!1,!(n=S.navigator&&S.navigator.sendBeacon?S.navigator.sendBeacon(e.i.toString(),""):n)&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=rr(e.g,null),e.a.ba(e.i)),e.u=P(),Re(e)),er(t)}function Un(t){t.a&&(Yn(t),t.a.cancel(),t.a=null)}function Bn(t){Un(t),t.j&&(S.clearTimeout(t.j),t.j=null),Jn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function jn(t,e){t.g.push(new fn(t.Oa++,e)),3==t.v&&Gn(t)}function Gn(t){yn(t.b)||t.h||(t.h=!0,Gt(t.Ba,t),t.u=0)}function Kn(t,e){var n=e?e.f:t.R++,r=Ke(t.B);Ye(r,"SID",t.J),Ye(r,"RID",n),Ye(r,"AID",t.P),zn(t,r),t.i&&t.l&&Mn(r,t.i,t.l),n=new _e(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Qn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),vn(t.b,n),Ce(n,r,e)}function zn(t,n){t.f&&qe({},function(t,e){Ye(n,e,t)})}function Qn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?L(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,r){var i="req"+c+"_"||"";try{qe(t,function(t,e){var n=t;N(t)&&(n=Ft(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s)}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Hn(t){t.a||t.j||(t.T=1,Gt(t.Aa,t),t.o=0)}function Wn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ye(L(t.Aa,t),Zn(t,t.o)),t.o++,1)}function Yn(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function Xn(t){t.a=new _e(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ke(t.la);Ye(e,"RID","rpc"),Ye(e,"SID",t.J),Ye(e,"CI",t.H?"0":"1"),Ye(e,"AID",t.P),zn(t,e),Ye(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Xe(Ke(e)),n.j=null,n.I=!0,ke(n,t)}function Jn(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function $n(t,e){var n,r,i,o=null;if(t.a==e){Jn(t),Yn(t),t.a=null;var s=2}else{if(!mn(t.b,e))return;o=e.s,bn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=P()-e.u,n=t.u,Pt(s=ce(),new de(s)),Gn(t)):Hn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,gn((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=ye(L(r.Ba,r,i),Zn(r,r.u)),r.u++,0))))&&(2!=s||!Wn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:tr(t,5);break;case 4:tr(t,10);break;case 3:tr(t,6);break;default:tr(t,2)}}function Zn(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function tr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=L(t.Ya,t),r||(r=new Ge("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||ze(r,"https"),Xe(r)),n=r.toString(),r=o,o=new oe,S.Image?((i=new Image).onload=O(In,o,i,"TestLoadImage: loaded",!0,r),i.onerror=O(In,o,i,"TestLoadImage: error",!1,r),i.onabort=O(In,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=O(In,o,i,"TestLoadImage: timeout",!1,r),S.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):pe(2),t.v=0,t.f&&t.f.ra(e),er(t),Bn(t)}function er(t){t.v=0,t.I=-1,t.f&&(0==wn(t.b).length&&0==t.g.length||(t.b.c.length=0,B(t.g),t.g.length=0),t.f.qa())}function nr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Ge?Ke(s):new Ge(s,void 0);return""!=u.c?(e&&Qe(u,e+"."+u.c),He(u,u.h)):(r=(a=S.location).protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Ge(null,void 0),r&&ze(a,r),i&&Qe(a,i),o&&He(a,o),s&&(a.g=s),u=a),t.V&&H(t.V,function(t,e){Ye(u,e,t)}),e=t.A,n=t.na,e&&n&&Ye(u,e,n),Ye(u,"VER",t.ha),zn(t,u),u}function rr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Sn(t.Na)).F=t.C,e}function ir(){}function or(){if(tt&&!(10<=Number(ct)))throw Error("Environmental error: no available transport.")}function sr(t,e){Ot.call(this),this.a=new qn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!j(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!j(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new cr(this)}function ar(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ur(){Te.call(this),this.status=1}function cr(t){this.a=t}(st=Sn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?be(this.H):be(Se),this.a.onreadystatechange=L(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void kn(this,t)}t=n||"";var i,o=new Ve(this.headers);r&&qe(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=S.FormData&&t instanceof S.FormData,0<=q(Nn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{On(this),0<this.o&&((this.D=(i=this.a,tt&&ut(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=L(this.xa,this)):this.m=Yt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){kn(this,t)}},st.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Pt(this,"timeout"),this.abort(8))},st.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Pt(this,"complete"),Pt(this,"abort"),Ln(this))},st.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ln(this,!0)),Sn.X.G.call(this)},st.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ua())},st.Ua=function(){Rn(this)},st.W=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},st.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},st.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),_n(e)}},st.ua=function(){return this.h},st.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(st=qn.prototype).ha=8,st.v=1,st.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new _e(this,this.c,t,void 0),r=this.l;if(this.O&&(r?X(r=W(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Qn(this,n,e),Ye(i=Ke(this.B),"RID",t),Ye(i,"CVER",22),this.A&&Ye(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&r&&Mn(i,this.i,r),vn(this.b,n),this.Ia&&Ye(i,"TYPE","init"),this.da?(Ye(i,"$req",e),Ye(i,"SID","null"),n.U=!0,Ce(n,i,null)):Ce(n,i,e),this.v=2}}else 3==this.v&&(t?Kn(this,t):0==this.g.length||yn(this.b)||Kn(this))},st.Aa=function(){var t;this.j=null,Xn(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=ye(L(this.Ta,this),t))},st.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,pe(10),Un(this),Xn(this))},st.Sa=function(){null!=this.m&&(this.m=null,Un(this),Wn(this),pe(19))},st.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),pe(2)):(this.c.info("Failed to ping google.com"),pe(1))},(st=ir.prototype).ta=function(){},st.sa=function(){},st.ra=function(){},st.qa=function(){},st.Ja=function(){},or.prototype.a=function(t,e){return new sr(t,e)},M(sr,Ot),sr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;pe(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=nr(t,null,t.fa),Gn(t)},sr.prototype.close=function(){Vn(this.a)},sr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,jn(this.a,e)):this.l?((e={}).__data__=Ft(t),jn(this.a,e)):jn(this.a,t)},sr.prototype.G=function(){this.a.f=null,delete this.f,Vn(this.a),delete this.a,sr.X.G.call(this)},M(ar,Ee),M(ur,Te),M(cr,ir),cr.prototype.ta=function(){Pt(this.a,"a")},cr.prototype.sa=function(t){Pt(this.a,new ar(t))},cr.prototype.ra=function(t){Pt(this.a,new ur)},cr.prototype.qa=function(){Pt(this.a,"b")},or.prototype.createWebChannel=or.prototype.a,sr.prototype.send=sr.prototype.h,sr.prototype.open=sr.prototype.g,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",(we.EventType=_).OPEN="a",_.CLOSE="b",_.ERROR="c",_.MESSAGE="d",Ot.prototype.listen=Ot.prototype.va,Sn.prototype.listenOnce=Sn.prototype.wa,Sn.prototype.getLastError=Sn.prototype.Qa,Sn.prototype.getLastErrorCode=Sn.prototype.ua,Sn.prototype.getStatus=Sn.prototype.W,Sn.prototype.getResponseJson=Sn.prototype.Pa,Sn.prototype.getResponseText=Sn.prototype.$,Sn.prototype.send=Sn.prototype.ba;var hr=ce,lr=ge,fr=me,pr=ae,dr=we,yr=Sn,gr=(mr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},mr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},mr);function mr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}gr.o=-1;var vr=new c("@firebase/firestore");function br(){return vr.logLevel}function wr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vr.logLevel<=f.DEBUG&&(e=n.map(Ir),vr.debug.apply(vr,s(["Firestore (8.3.1): "+t],e)))}function Er(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vr.logLevel<=f.ERROR&&(e=n.map(Ir),vr.error.apply(vr,s(["Firestore (8.3.1): "+t],e)))}function Tr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vr.logLevel<=f.WARN&&(e=n.map(Ir),vr.warn.apply(vr,s(["Firestore (8.3.1): "+t],e)))}function Ir(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function _r(t){throw Er(t="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+(void 0===t?"Unexpected state":t)),new Error(t)}function Sr(t){t||_r()}var Dr=(Ar.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ar);function Ar(){}function Nr(t,e){return t<e?-1:e<t?1:0}function Cr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function kr(t){return t+"\0"}function xr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Rr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Lr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Or(t){return null==t}function Pr(t){return 0===t&&1/t==-1/0}function Mr(t){return"number"==typeof t&&Number.isInteger(t)&&!Pr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Fr,qr,Vr,Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Br=(n($r,Vr=Error),$r),me=(Object.defineProperty(Jr.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),Jr.prototype.isEqual=function(t){return 0===Jr.comparator(this,t)},Jr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Jr?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Jr.prototype.limit=function(){return this.offset+this.length},Jr.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},Jr.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},Jr.prototype.firstSegment=function(){return this.segments[this.offset]},Jr.prototype.lastSegment=function(){return this.get(this.length-1)},Jr.prototype.get=function(t){return this.segments[this.offset+t]},Jr.prototype.isEmpty=function(){return 0===this.length},Jr.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Jr.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Jr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Jr.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Jr.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Jr),jr=(n(Xr,qr=me),Xr.prototype.construct=function(t,e,n){return new Xr(t,e,n)},Xr.prototype.canonicalString=function(){return this.toArray().join("/")},Xr.prototype.toString=function(){return this.canonicalString()},Xr.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Br(Ur.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new Xr(n)},Xr.emptyPath=function(){return new Xr([])},Xr),Gr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kr=(n(Yr,Fr=me),Yr.prototype.construct=function(t,e,n){return new Yr(t,e,n)},Yr.isValidIdentifier=function(t){return Gr.test(t)},Yr.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yr.isValidIdentifier(t)?t:"`"+t+"`"}).join(".")},Yr.prototype.toString=function(){return this.canonicalString()},Yr.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},Yr.keyField=function(){return new Yr(["__name__"])},Yr.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Br(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Br(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Br(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Yr(e)},Yr.emptyPath=function(){return new Yr([])},Yr),zr=(Wr.fromPath=function(t){return new Wr(jr.fromString(t))},Wr.fromName=function(t){return new Wr(jr.fromString(t).popFirst(5))},Wr.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Wr.prototype.isEqual=function(t){return null!==t&&0===jr.comparator(this.path,t.path)},Wr.prototype.toString=function(){return this.path.toString()},Wr.comparator=function(t,e){return jr.comparator(t.path,e.path)},Wr.isDocumentKey=function(t){return t.length%2==0},Wr.fromSegments=function(t){return new Wr(new jr(t.slice()))},Wr),Qr=(Hr.fromBase64String=function(t){return new Hr(atob(t))},Hr.fromUint8Array=function(t){return new Hr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Hr.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},Hr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},Hr.prototype.approximateByteSize=function(){return 2*this.binaryString.length},Hr.prototype.compareTo=function(t){return Nr(this.binaryString,t.binaryString)},Hr.prototype.isEqual=function(t){return this.binaryString===t.binaryString},Hr);function Hr(t){this.binaryString=t}function Wr(t){this.path=t}function Yr(){return null!==Fr&&Fr.apply(this,arguments)||this}function Xr(){return null!==qr&&qr.apply(this,arguments)||this}function Jr(t,e,n){void 0===e?e=0:e>t.length&&_r(),void 0===n?n=t.length-e:n>t.length-e&&_r(),this.segments=t,this.offset=e,this.len=n}function $r(t,e){var n=this;return(n=Vr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Qr.EMPTY_BYTE_STRING=new Qr("");var Zr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ti(t){if(Sr(!!t),"string"!=typeof t)return{seconds:ei(t.seconds),nanos:ei(t.nanos)};var e=0,n=Zr.exec(t);return Sr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function ei(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ni(t){return"string"==typeof t?Qr.fromBase64String(t):Qr.fromUint8Array(t)}var ri=(ii.now=function(){return ii.fromMillis(Date.now())},ii.fromDate=function(t){return ii.fromMillis(t.getTime())},ii.fromMillis=function(t){var e=Math.floor(t/1e3);return new ii(e,1e6*(t-1e3*e))},ii.prototype.toDate=function(){return new Date(this.toMillis())},ii.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ii.prototype._compareTo=function(t){return this.seconds===t.seconds?Nr(this.nanoseconds,t.nanoseconds):Nr(this.seconds,t.seconds)},ii.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ii.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ii.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ii.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ii);function ii(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function oi(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function si(t){return t=ti(t.mapValue.fields.__local_write_time__.timestampValue),new ri(t.seconds,t.nanos)}function ai(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?oi(t)?4:10:_r()}function ui(r,i){var t,e,n=ai(r);if(n!==ai(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return si(r).isEqual(si(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=ti(r.timestampValue),t=ti(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,ni(r.bytesValue).isEqual(ni(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,ei((e=r).geoPointValue.latitude)===ei(t.geoPointValue.latitude)&&ei(e.geoPointValue.longitude)===ei(t.geoPointValue.longitude);case 2:return e=i,"integerValue"in(t=r)&&"integerValue"in e?ei(t.integerValue)===ei(e.integerValue):"doubleValue"in t&&"doubleValue"in e&&((t=ei(t.doubleValue))===(e=ei(e.doubleValue))?Pr(t)===Pr(e):isNaN(t)&&isNaN(e));case 9:return Cr(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(xr(e)!==xr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!ui(e[t],n[t])))return!1;return!0}();default:return _r()}}function ci(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o=ai(t),s=ai(e);if(o!==s)return Nr(o,s);switch(o){case 0:return 0;case 1:return Nr(t.booleanValue,e.booleanValue);case 2:return n=e,(r=ei(t.integerValue||t.doubleValue))<(n=ei(n.integerValue||n.doubleValue))?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return li(t.timestampValue,e.timestampValue);case 4:return li(si(t),si(e));case 5:return Nr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,i=e.bytesValue,o=ni(o),i=ni(i),o.compareTo(i);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Nr(n[i],r[i]);if(0!==o)return o}return Nr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=Nr(ei(i.latitude),ei(r.latitude)))?n:Nr(ei(i.longitude),ei(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Nr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Nr(r[s],o[s]);if(0!==a)return a;if(0!==(a=hi(n[r[s]],i[o[s]])))return a}return Nr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw _r()}}function li(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Nr(t,e);var n=ti(t),t=ti(e);return 0!==(e=Nr(n.seconds,t.seconds))?e:Nr(n.nanos,t.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=ti(t=i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?ni(i.bytesValue).toBase64():"referenceValue"in i?(e=i.referenceValue,zr.fromName(e).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):_r();var t,e}(t)}function pi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function di(t){return t&&"integerValue"in t}function yi(t){return!!t&&"arrayValue"in t}function gi(t){return t&&"nullValue"in t}function mi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function vi(t){return t&&"mapValue"in t}var bi,wi,Ei,Ti=(n(Ni,Ei=c=function(t,e){this.key=t,this.version=e}),Ni.prototype.field=function(t){return this.objectValue.field(t)},Ni.prototype.data=function(){return this.objectValue},Ni.prototype.toProto=function(){return this.objectValue.proto},Ni.prototype.isEqual=function(t){return t instanceof Ni&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},Ni.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Ni.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ni),Ii=(n(Ai,wi=c),Ai.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ai.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ai.prototype.isEqual=function(t){return t instanceof Ai&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ai),_i=(n(Di,bi=c),Di.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Di.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Di.prototype.isEqual=function(t){return t instanceof Di&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Di),Si=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Di(){return null!==bi&&bi.apply(this,arguments)||this}function Ai(t,e,n){var r=this;return(r=wi.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Ni(t,e,n,r){var i=this;return(i=Ei.call(this,t,e)||this).objectValue=n,i.hasLocalMutations=!!r.hasLocalMutations,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Ci(t,e,n,r,i,o,s){return new Si(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function ki(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return t.field.canonicalString()+t.op.toString()+fi(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return t.field.canonicalString()+t.dir}).join(","),Or(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=oo(e.startAt)),e.endAt&&(t+="|ub:",t+=oo(e.endAt)),e.h=t),e.h}function xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!ui(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!uo(t.startAt,e.startAt)&&uo(t.endAt,e.endAt)}function Ri(t){return zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Li,Oi=(n(Pi,Li=function(){}),Pi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Vi(t,e,n):"array-contains"===e?new Xi(t,n):"in"===e?new Ji(t,n):"not-in"===e?new $i(t,n):"array-contains-any"===e?new Zi(t,n):new Pi(t,e,n)},Pi.l=function(t,e,n){return new("in"===e?Ui:Bi)(t,n)},Pi.prototype.matches=function(t){return t=t.field(this.field),"!="===this.op?null!==t&&this.m(hi(t,this.value)):null!==t&&ai(this.value)===ai(t)&&this.m(hi(t,this.value))},Pi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return _r()}},Pi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Pi);function Pi(t,e,n){var r=this;return(r=Li.call(this)||this).field=t,r.op=e,r.value=n,r}var Mi,Fi,qi,Vi=(n(Ki,qi=Oi),Ki.prototype.matches=function(t){return t=zr.comparator(t.key,this.key),this.m(t)},Ki),Ui=(n(Gi,Fi=Oi),Gi.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Gi),Bi=(n(ji,Mi=Oi),ji.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},ji);function ji(t,e){var n=this;return(n=Mi.call(this,t,"not-in",e)||this).keys=zi(0,e),n}function Gi(t,e){var n=this;return(n=Fi.call(this,t,"in",e)||this).keys=zi(0,e),n}function Ki(t,e,n){var r=this;return(r=qi.call(this,t,e,n)||this).key=zr.fromName(n.referenceValue),r}function zi(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return zr.fromName(t.referenceValue)})}var Qi,Hi,Wi,Yi,Xi=(n(io,Yi=Oi),io.prototype.matches=function(t){return yi(t=t.field(this.field))&&ci(t.arrayValue,this.value)},io),Ji=(n(ro,Wi=Oi),ro.prototype.matches=function(t){return null!==(t=t.field(this.field))&&ci(this.value.arrayValue,t)},ro),$i=(n(no,Hi=Oi),no.prototype.matches=function(t){return!ci(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(t=t.field(this.field))&&!ci(this.value.arrayValue,t))},no),Zi=(n(eo,Qi=Oi),eo.prototype.matches=function(t){var e=this;return!(!yi(t=t.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return ci(e.value.arrayValue,t)})},eo),to=function(t,e){this.position=t,this.before=e};function eo(t,e){return Qi.call(this,t,"array-contains-any",e)||this}function no(t,e){return Hi.call(this,t,"not-in",e)||this}function ro(t,e){return Wi.call(this,t,"in",e)||this}function io(t,e){return Yi.call(this,t,"array-contains",e)||this}function oo(t){return(t.before?"b":"a")+":"+t.position.map(fi).join(",")}var so=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ao(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?zr.comparator(zr.fromName(s.referenceValue),n.key):hi(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function uo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ui(t.position[n],e.position[n]))return!1;return!0}var co=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function ho(t,e,n,r,i,o,s,a){return new co(t,e,n,r,i,o,s,a)}function lo(t){return new co(t)}function fo(t){return!Or(t.limit)&&"F"===t.limitType}function po(t){return!Or(t.limit)&&"L"===t.limitType}function yo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function go(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function mo(t){return null!==t.collectionGroup}function vo(t){var e=t;if(null===e.p){e.p=[];var n=go(e),t=yo(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new so(n)),e.p.push(new so(Kr.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new so(Kr.keyField(),n)))}}return e.p}function bo(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Ci(e.path,e.collectionGroup,vo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=vo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new so(o.field,s))}var a=e.endAt?new to(e.endAt.position,!e.endAt.before):null,t=e.startAt?new to(e.startAt.position,!e.startAt.before):null;e.T=Ci(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function wo(t,e,n){return new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Eo(t,e){return xi(bo(t),bo(e))&&t.limitType===e.limitType}function To(t){return ki(bo(t))+"|lt:"+t.limitType}function Io(t){return"Query(target="+(n=(e=bo(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return t.field.canonicalString()+" "+t.op+" "+fi(t.value)}).join(", ")+"]"),Or(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+oo(e.startAt)),e.endAt&&(n+=", endAt: "+oo(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function _o(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):zr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||ao(t.startAt,vo(t),n))&&(!t.endAt||!ao(t.endAt,vo(t),n)));var e,n}function So(a){return function(t,e){for(var n=!1,r=0,i=vo(a);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,r=t.field.isKeyField()?zr.comparator(e.key,n.key):(r=t.field,n=n,e=e.field(r),r=n.field(r),null!==e&&null!==r?hi(e,r):_r());switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _r()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}var Do=(Lo.fromTimestamp=function(t){return new Lo(t)},Lo.min=function(){return new Lo(new ri(0,0))},Lo.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Lo.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Lo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Lo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Lo.prototype.toTimestamp=function(){return this.timestamp},Lo),Ao=(Ro.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},Ro.prototype.isEqual=function(t){return Cr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Ro),No=(xo.empty=function(){return new xo({mapValue:{}})},xo.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!vi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},xo.prototype.isEqual=function(t){return ui(this.proto,t.proto)},xo),Co=(ko.prototype.set=function(t,e){return this.R(t,e),this},ko.prototype.delete=function(t){return this.R(t,null),this},ko.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===ai(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.lastSegment(),e)},ko.prototype.v=function(){var t=this.P(Kr.emptyPath(),this.A);return null!=t?new No(t):this.I},ko.prototype.P=function(r,t){var i=this,o=!1,e=this.I.field(r),s=vi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.P(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},ko);function ko(t){void 0===t&&(t=No.empty()),this.I=t,this.A=new Map}function xo(t){this.proto=t}function Ro(t){(this.fields=t).sort(Kr.comparator)}function Lo(t){this.timestamp=t}function Oo(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function Po(t){return{integerValue:""+t}}function Mo(t,e){return Mr(e)?Po(e):Oo(t,e)}function Fo(t,e){return t instanceof Xo?di(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var qo,Vo,Uo=(n(Go,Vo=me=function(){this._=void 0}),Go),Bo=(n(jo,qo=me),jo);function jo(t){var e=this;return(e=qo.call(this)||this).elements=t,e}function Go(){return null!==Vo&&Vo.apply(this,arguments)||this}function Ko(t,e){for(var n=Zo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return ui(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var zo,Qo=(n(Ho,zo=me),Ho);function Ho(t){var e=this;return(e=zo.call(this)||this).elements=t,e}function Wo(t,e){for(var n=Zo(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!ui(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Yo,Xo=(n(Jo,Yo=me),Jo);function Jo(t,e){var n=this;return(n=Yo.call(this)||this).D=t,n.S=e,n}function $o(t){return ei(t.integerValue||t.doubleValue)}function Zo(t){return yi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ts(t,e){this.version=t,this.transformResults=e}var es=function(t,e){this.field=t,this.transform=e},ns=(rs.none=function(){return new rs},rs.exists=function(t){return new rs(void 0,t)},rs.updateTime=function(t){return new rs(t)},Object.defineProperty(rs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),rs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},rs);function rs(t,e){this.updateTime=t,this.exists=e}function is(t,e){return void 0!==t.updateTime?e instanceof Ti&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Ti}function os(t,e,n){return t instanceof hs?function(t,e,n){if(!is(t.precondition,e))return e;var r=t.value,n=gs(t.fieldTransforms,n,e),r=ms(t.fieldTransforms,r,n),e=as(e);return new Ti(t.key,e,r,{hasLocalMutations:!0})}(t,e,n):t instanceof ls?function(t,e,n){if(!is(t.precondition,e))return e;var r=as(e),e=ds(t,e,gs(t.fieldTransforms,n,e));return new Ti(t.key,r,e,{hasLocalMutations:!0})}(t,e,n):is(t.precondition,e)?new Ii(t.key,Do.min()):e}function ss(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Cr(n,r,function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Bo&&e instanceof Bo||t instanceof Qo&&e instanceof Qo?Cr(t.elements,e.elements,ui):t instanceof Xo&&e instanceof Xo?ui(t.S,e.S):t instanceof Uo&&e instanceof Uo)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function as(t){return t instanceof Ti?t.version:Do.min()}var us,cs,hs=(n(ps,cs=c=function(){}),ps),ls=(n(fs,us=c),fs);function fs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=us.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function ps(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=cs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function ds(t,e,n){var r,i,o=t;return e=e instanceof Ti?e.data():No.empty(),i=new Co(e),o.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(null!==(e=o.data.field(t))?i.set(t,e):i.delete(t))}),r=i.v(),ms(t.fieldTransforms,r,n)}function ys(t,e,n){var r=[];Sr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof Ti&&(a=e.field(o.field)),r.push((o=s,s=a,a=n[i],o instanceof Bo?Ko(o,s):o instanceof Qo?Wo(o,s):a))}return r}function gs(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=null;n instanceof Ti&&(c=n.field(a.field)),i.push((r=c,a=e,c=void 0,u instanceof Uo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Bo?Ko(u,r):u instanceof Qo?Wo(u,r):(r=$o(u=Fo(c=u,r))+$o(c.S),di(u)&&di(c.S)?Po(r):Oo(c.D,r))))}return i}function ms(t,e,n){for(var r=new Co(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}function vs(t){this.count=t}var bs,ws,Es,Ts=(n(Ss,Es=c),Ss),Is=(n(_s,ws=c),_s);function _s(t,e){var n=this;return(n=ws.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Ss(t,e){var n=this;return(n=Es.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Ds(t){switch(t){case Ur.OK:return _r(),0;case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return 1;default:return _r(),0}}function As(t){if(void 0===t)return Er("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case bs.OK:return Ur.OK;case bs.CANCELLED:return Ur.CANCELLED;case bs.UNKNOWN:return Ur.UNKNOWN;case bs.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case bs.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case bs.INTERNAL:return Ur.INTERNAL;case bs.UNAVAILABLE:return Ur.UNAVAILABLE;case bs.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case bs.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case bs.NOT_FOUND:return Ur.NOT_FOUND;case bs.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case bs.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case bs.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case bs.ABORTED:return Ur.ABORTED;case bs.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case bs.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case bs.DATA_LOSS:return Ur.DATA_LOSS;default:return _r()}}(me=bs={})[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";var Ns=(Ls.prototype.insert=function(t,e){return new Ls(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ks.BLACK,null,null))},Ls.prototype.remove=function(t){return new Ls(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ks.BLACK,null,null))},Ls.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ls.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ls.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Ls.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Ls.prototype.minKey=function(){return this.root.minKey()},Ls.prototype.maxKey=function(){return this.root.maxKey()},Ls.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Ls.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Ls.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ls.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Ls.prototype.getIterator=function(){return new Cs(this.root,null,this.comparator,!1)},Ls.prototype.getIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!1)},Ls.prototype.getReverseIterator=function(){return new Cs(this.root,null,this.comparator,!0)},Ls.prototype.getReverseIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!0)},Ls),Cs=(Rs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Rs.prototype.hasNext=function(){return 0<this.nodeStack.length},Rs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Rs),ks=(xs.prototype.copy=function(t,e,n,r,i){return new xs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},xs.prototype.isEmpty=function(){return!1},xs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},xs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},xs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},xs.prototype.minKey=function(){return this.min().key},xs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},xs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},xs.prototype.removeMin=function(){if(this.left.isEmpty())return xs.EMPTY;var t=this;return(t=(t=t.left.isRed()||t.left.left.isRed()?t:t.moveRedLeft()).copy(null,null,null,t.left.removeMin(),null)).fixUp()},xs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return xs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},xs.prototype.isRed=function(){return this.color},xs.prototype.fixUp=function(){var t=this;return(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},xs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},xs.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},xs.prototype.rotateLeft=function(){var t=this.copy(null,null,xs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},xs.prototype.rotateRight=function(){var t=this.copy(null,null,xs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},xs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},xs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},xs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw _r();if(this.right.isRed())throw _r();var t=this.left.check();if(t!==this.right.check())throw _r();return t+(this.isRed()?0:1)},xs);function xs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:xs.RED,this.left=null!=r?r:xs.EMPTY,this.right=null!=i?i:xs.EMPTY,this.size=this.left.size+1+this.right.size}function Rs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Ls(t,e){this.comparator=t,this.root=e||ks.EMPTY}function Os(){this.size=0}ks.EMPTY=null,ks.RED=!0,ks.BLACK=!1,ks.EMPTY=(Object.defineProperty(Os.prototype,"key",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"value",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"color",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"left",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"right",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Os.prototype.copy=function(t,e,n,r,i){return this},Os.prototype.insert=function(t,e,n){return new ks(t,e)},Os.prototype.remove=function(t,e){return this},Os.prototype.isEmpty=function(){return!0},Os.prototype.inorderTraversal=function(t){return!1},Os.prototype.reverseTraversal=function(t){return!1},Os.prototype.minKey=function(){return null},Os.prototype.maxKey=function(){return null},Os.prototype.isRed=function(){return!1},Os.prototype.checkMaxDepth=function(){return!0},Os.prototype.check=function(){return 0},new Os);var Ps=(Vs.prototype.has=function(t){return null!==this.data.get(t)},Vs.prototype.first=function(){return this.data.minKey()},Vs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Vs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Vs.prototype.indexOf=function(t){return this.data.indexOf(t)},Vs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Vs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Vs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Vs.prototype.firstAfterOrEqual=function(t){return(t=this.data.getIteratorFrom(t)).hasNext()?t.getNext().key:null},Vs.prototype.getIterator=function(){return new Ms(this.data.getIterator())},Vs.prototype.getIteratorFrom=function(t){return new Ms(this.data.getIteratorFrom(t))},Vs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Vs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Vs.prototype.isEmpty=function(){return this.data.isEmpty()},Vs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Vs.prototype.isEqual=function(t){if(!(t instanceof Vs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Vs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Vs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Vs.prototype.copy=function(t){var e=new Vs(this.comparator);return e.data=t,e},Vs),Ms=(qs.prototype.getNext=function(){return this.iter.getNext().key},qs.prototype.hasNext=function(){return this.iter.hasNext()},qs),Fs=new Ns(zr.comparator);function qs(t){this.iter=t}function Vs(t){this.comparator=t,this.data=new Ns(this.comparator)}var Us=new Ns(zr.comparator),Bs=new Ns(zr.comparator),js=new Ps(zr.comparator);function Gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=js,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Ks=new Ps(Nr),zs=(ea.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Qs.createSynthesizedTargetChangeForCurrentChange(t,e)),new ea(Do.min(),n,Ks,Fs,Gs())},ea),Qs=(ta.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new ta(Qr.EMPTY_BYTE_STRING,e,Gs(),Gs(),Gs())},ta),Hs=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},Ws=function(t,e){this.targetId=t,this.$=e},Ys=function(t,e,n,r){void 0===n&&(n=Qr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Xs=(Object.defineProperty(Zs.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(Zs.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(Zs.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(Zs.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),Zs.prototype.U=function(t){0<t.approximateByteSize()&&(this.L=!0,this.k=t)},Zs.prototype.K=function(){var n=Gs(),r=Gs(),i=Gs();return this.O.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:_r()}}),new Qs(this.k,this.M,n,r,i)},Zs.prototype.W=function(){this.L=!1,this.O=ra()},Zs.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},Zs.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},Zs.prototype.H=function(){this.F+=1},Zs.prototype.J=function(){--this.F},Zs.prototype.Y=function(){this.L=!0,this.M=!0},Zs),Js=($s.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof Ti?this.it(r,t.N):t.N instanceof Ii&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},$s.prototype.ot=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ct(t);switch(n.state){case 0:r.at(t)&&e.U(n.resumeToken);break;case 1:e.J(),e.B||e.W(),e.U(n.resumeToken);break;case 2:e.J(),e.B||r.removeTarget(t);break;case 3:r.at(t)&&(e.Y(),e.U(n.resumeToken));break;case 4:r.at(t)&&(r.ut(t),e.U(n.resumeToken));break;default:_r()}})},$s.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Z.forEach(function(t,e){r.at(e)&&n(e)})},$s.prototype.ht=function(t){var e=t.targetId,n=t.$.count;(t=this.lt(e))&&(Ri(t=t.target)?0===n?(t=new zr(t.path),this.rt(e,t,new Ii(t,Do.min()))):Sr(1===n):this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e)))},$s.prototype.dt=function(r){var i=this,o=new Map;this.Z.forEach(function(t,e){var n=i.lt(e);n&&(t.current&&Ri(n.target)&&(n=new zr(n.target.path),null!==i.tt.get(n)||i.wt(e,n)||i.rt(e,n,new Ii(n,r))),t.q&&(o.set(e,t.K()),t.W()))});var s=Gs();this.et.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){return!(t=i.lt(t))||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new zs(r,o,this.nt,this.tt,s);return this.tt=Fs,this.et=na(),this.nt=new Ps(Nr),t},$s.prototype.it=function(t,e){var n;this.at(t)&&(n=this.wt(t,e.key)?2:0,this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t)))},$s.prototype.rt=function(t,e,n){var r;this.at(t)&&(r=this.ct(t),this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n)))},$s.prototype.removeTarget=function(t){this.Z.delete(t)},$s.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},$s.prototype.H=function(t){this.ct(t).H()},$s.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new Xs,this.Z.set(t,e)),e},$s.prototype._t=function(t){var e=this.et.get(t);return e||(e=new Ps(Nr),this.et=this.et.insert(t,e)),e},$s.prototype.at=function(t){var e=null!==this.lt(t);return e||wr("WatchChangeAggregator","Detected inactive target",t),e},$s.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},$s.prototype.ut=function(e){var n=this;this.Z.set(e,new Xs),this.X.getRemoteKeysForTarget(e).forEach(function(t){n.rt(e,t,null)})},$s.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},$s);function $s(t){this.X=t,this.Z=new Map,this.tt=Fs,this.et=na(),this.nt=new Ps(Nr)}function Zs(){this.F=0,this.O=ra(),this.k=Qr.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}function ta(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function ea(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function na(){return new Ns(zr.comparator)}function ra(){return new Ns(zr.comparator)}var ia={asc:"ASCENDING",desc:"DESCENDING"},oa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sa=function(t,e){this.databaseId=t,this.V=e};function aa(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ua(t,e){return t.V?e.toBase64():e.toUint8Array()}function ca(t){return Sr(!!t),Do.fromTimestamp((t=ti(t),new ri(t.seconds,t.nanos)))}function ha(t,e){return new jr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function la(t){return Sr(Ca(t=jr.fromString(t))),t}function fa(t,e){return ha(t.databaseId,e.path)}function pa(t,e){if((e=la(e)).get(1)!==t.databaseId.projectId)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new zr(ma(e))}function da(t,e){return ha(t.databaseId,e)}function ya(t){return 4===(t=la(t)).length?jr.emptyPath():ma(t)}function ga(t){return new jr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ma(t){return Sr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function va(t,e,n){return{name:fa(t,e),fields:n.proto.mapValue.fields}}function ba(t,e,n){var r=pa(t,e.name),t=ca(e.updateTime),e=new No({mapValue:{fields:e.fields}});return new Ti(r,t,e,{hasCommittedMutations:!!n})}function wa(t,e){var n,r,i;if(e instanceof hs)n={update:va(t,e.key,e.value)};else if(e instanceof Ts)n={delete:fa(t,e.key)};else if(e instanceof ls)n={update:va(t,e.key,e.data),updateMask:(i=e.fieldMask,r=[],i.fields.forEach(function(t){return r.push(t.canonicalString())}),{fieldPaths:r})};else{if(!(e instanceof Is))return _r();n={verify:fa(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Uo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Bo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Qo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof Xo)return{fieldPath:t.field.canonicalString(),increment:e.S};throw _r()})),e.precondition.isNone||(n.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:aa(e=t,(t=i.updateTime).toTimestamp())}:void 0!==i.exists?{exists:i.exists}:_r()),n}function Ea(i,t){var e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?ns.updateTime(ca(s.updateTime)):void 0!==s.exists?ns.exists(s.exists):ns.none():ns.none(),n=t.updateTransforms?t.updateTransforms.map(function(t){return e=i,r=null,"setToServerValue"in(t=t)?(Sr("REQUEST_TIME"===t.setToServerValue),r=new Uo):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],r=new Bo(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Qo(n)):"increment"in t?r=new Xo(e,t.increment):_r(),t=Kr.fromServerFormat(t.fieldPath),new es(t,r);var e,n,r}):[];if(t.update){t.update.name;var r=pa(i,t.update.name),o=new No({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new Ao(s.map(function(t){return Kr.fromServerFormat(t)})));return new ls(r,o,s,e,n)}return new hs(r,o,e,n)}return t.delete?(n=pa(i,t.delete),new Ts(n,e)):t.verify?(t=pa(i,t.verify),new Is(t,e)):_r()}function Ta(t,e){return{documents:[da(t,e.path)]}}function Ia(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=da(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=da(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map(function(t){if("=="===t.op){if(mi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NAN"}};if(gi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(mi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NAN"}};if(gi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Aa(t.field),op:(e=t.op,oa[e]),value:t.value}};var e})).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map(function(t){return{field:Aa(t.field),direction:(t=t.dir,ia[t])}})}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.V||Or(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Sa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Sa(e.endAt)),n}function _a(t){var e=ya(t.parent),n=t.structuredQuery,r=null;0<(s=n.from?n.from.length:0)&&(Sr(1===s),(a=n.from[0]).allDescendants?r=a.collectionId:e=e.child(a.collectionId));var i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Na(t.unaryFilter.field);return Oi.create(e,"==",{doubleValue:NaN});case"IS_NULL":return e=Na(t.unaryFilter.field),Oi.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Na(t.unaryFilter.field);return Oi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=Na(t.unaryFilter.field),Oi.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _r()}}(e)]:void 0!==e.fieldFilter?[(n=e,Oi.create(Na(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _r()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):_r():[];var n}(n.where));var o=[],t=null,s=null,a=null;return ho(e,r,o=n.orderBy?n.orderBy.map(function(t){return new so(Na((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}):o,i,t=n.limit?Or(i="object"==typeof(i=n.limit)?i.value:i)?null:i:t,"F",s=n.startAt?Da(n.startAt):s,a=n.endAt?Da(n.endAt):a)}function Sa(t){return{before:t.before,values:t.position}}function Da(t){var e=!!t.before,t=t.values||[];return new to(t,e)}function Aa(t){return{fieldPath:t.canonicalString()}}function Na(t){return Kr.fromServerFormat(t.fieldPath)}function Ca(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function ka(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=xa(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return xa(o)}function xa(t){return t+""}function Ra(t){var e=t.length;if(Sr(2<=e),2===e)return Sr(""===t.charAt(0)&&""===t.charAt(1)),jr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&_r(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:_r()}o=s+2}return new jr(r)}function La(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Oa=function(t,e){this.seconds=t,this.nanoseconds=e};function Pa(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function Ma(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}La.store="owner",La.key="owner",Pa.store="mutationQueues",Pa.keyPath="userId",Ma.store="mutations",Ma.keyPath="batchId",Ma.userMutationsIndex="userMutationsIndex",Ma.userMutationsKeyPath=["userId","batchId"];var Fa=(qa.prefixForUser=function(t){return[t]},qa.prefixForPath=function(t,e){return[t,ka(e)]},qa.key=function(t,e,n){return[t,ka(e),n]},qa);function qa(){}function Va(t,e){this.path=t,this.readTime=e}function Ua(t,e){this.path=t,this.version=e}Fa.store="documentMutations",Fa.PLACEHOLDER=new Fa;var Ba=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};function ja(t){this.byteSize=t}function Ga(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}Ba.store="remoteDocuments",Ba.readTimeIndex="readTimeIndex",Ba.readTimeIndexPath="readTime",Ba.collectionReadTimeIndex="collectionReadTimeIndex",Ba.collectionReadTimeIndexPath=["parentPath","readTime"],ja.store="remoteDocumentGlobal",ja.key="remoteDocumentGlobalKey",Ga.store="targets",Ga.keyPath="targetId",Ga.queryTargetsIndexName="queryTargetsIndex",Ga.queryTargetsKeyPath=["canonicalId","targetId"];var Ka=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};function za(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function Qa(t,e){this.collectionId=t,this.parent=e}function Ha(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function Wa(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function Ya(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}Ka.store="targetDocuments",Ka.keyPath=["targetId","path"],Ka.documentTargetsIndex="documentTargetsIndex",Ka.documentTargetsKeyPath=["path","targetId"],za.key="targetGlobalKey",za.store="targetGlobal",Qa.store="collectionParents",Qa.keyPath=["collectionId","parent"],Ha.store="clientMetadata",Ha.keyPath="clientId",Wa.store="bundles",Wa.keyPath="bundleId",Ya.store="namedQueries",Ya.keyPath="name";var Xa,Ja=s(s([],s(s([],s(s([],s(s([],[Pa.store,Ma.store,Fa.store,Ba.store,Ga.store,La.store,za.store,Ka.store]),[Ha.store])),[ja.store])),[Qa.store])),[Wa.store,Ya.store]),$a="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",c=(hu.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},hu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},hu),Za=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},tu=(cu.prototype.catch=function(t){return this.next(void 0,t)},cu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&_r(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new cu(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},cu.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},cu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof cu?e:cu.resolve(e)}catch(t){return cu.reject(t)}},cu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):cu.resolve(e)},cu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):cu.reject(e)},cu.resolve=function(n){return new cu(function(t,e){t(n)})},cu.reject=function(n){return new cu(function(t,e){e(n)})},cu.waitFor=function(t){return new cu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},cu.or=function(t){for(var n=cu.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?cu.resolve(t):e()})}(r[e]);return n},cu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},cu),eu=(uu.open=function(t,e,n,r){try{return new uu(e,t.transaction(r,n))}catch(t){throw new iu(e,t)}},Object.defineProperty(uu.prototype,"Et",{get:function(){return this.gt.promise},enumerable:!1,configurable:!0}),uu.prototype.abort=function(t){t&&this.gt.reject(t),this.aborted||(wr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},uu.prototype.store=function(t){return t=this.transaction.objectStore(t),new fu(t)},uu),nu=(au.delete=function(t){return wr("SimpleDb","Removing database:",t),du(window.indexedDB.deleteDatabase(t)).toPromise()},au.At=function(){if("undefined"==typeof indexedDB)return!1;if(au.Rt())return!0;var t=l(),e=0<(n=au.It(t))&&n<10,n=0<(n=au.bt(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},au.Rt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.vt)},au.Pt=function(t,e){return t.store(e)},au.It=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},au.bt=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},au.prototype.Vt=function(o){return y(this,void 0,void 0,function(){var e,i=this;return g(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(wr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result,e(t)},r.onblocked=function(){n(new iu(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){"VersionError"===(t=t.target.error).name?n(new Br(Ur.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new iu(o,t))},r.onupgradeneeded=function(t){wr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Tt.St(e,r.transaction,t.oldVersion,i.version).next(function(){wr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Dt&&(this.db.onversionchange=function(t){return i.Dt(t)}),this.db)]}})})},au.prototype.Ct=function(e){this.Dt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},au.prototype.runTransaction=function(a,n,u,c){return y(this,void 0,void 0,function(){var i,o,s,e;return g(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Vt(a)];case 2:return s.db=t.sent(),e=eu.open(s.db,a,i?"readonly":"readwrite",u),n=c(e).catch(function(t){return e.abort(t),tu.reject(t)}).toPromise(),r={},n.catch(function(){}),[4,e.Et];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,wr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},au.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},au),ru=(Object.defineProperty(su.prototype,"isDone",{get:function(){return this.Nt},enumerable:!1,configurable:!0}),Object.defineProperty(su.prototype,"Ft",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(su.prototype,"cursor",{set:function(t){this.xt=t},enumerable:!1,configurable:!0}),su.prototype.done=function(){this.Nt=!0},su.prototype.Ot=function(t){this.$t=t},su.prototype.delete=function(){return du(this.xt.delete())},su),iu=(n(ou,Xa=Br),ou);function ou(t,e){var n=this;return(n=Xa.call(this,Ur.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function su(t){this.xt=t,this.Nt=!1,this.$t=null}function au(t,e,n){this.name=t,this.version=e,this.Tt=n,12.2===au.It(l())&&Er("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function uu(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.gt=new Za,this.transaction.oncomplete=function(){n.gt.resolve()},this.transaction.onabort=function(){t.error?n.gt.reject(new iu(e,t.error)):n.gt.resolve()},this.transaction.onerror=function(t){t=gu(t.target.error),n.gt.reject(new iu(e,t))}}function cu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function hu(){this.onCommittedListeners=[]}function lu(t){return"IndexedDbTransactionError"===t.name}var fu=(pu.prototype.put=function(t,e){return du(t=void 0!==e?(wr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(wr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},pu.prototype.add=function(t){return wr("SimpleDb","ADD",this.store.name,t,t),du(this.store.add(t))},pu.prototype.get=function(e){var n=this;return du(this.store.get(e)).next(function(t){return void 0===t&&(t=null),wr("SimpleDb","GET",n.store.name,e,t),t})},pu.prototype.delete=function(t){return wr("SimpleDb","DELETE",this.store.name,t),du(this.store.delete(t))},pu.prototype.count=function(){return wr("SimpleDb","COUNT",this.store.name),du(this.store.count())},pu.prototype.kt=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.Mt(e,function(t,e){n.push(e)}).next(function(){return n})},pu.prototype.Lt=function(t,e){return wr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).Bt=!1,e=this.cursor(e),this.Mt(e,function(t,e,n){return n.delete()})},pu.prototype.qt=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.Mt(n,e)},pu.prototype.Ut=function(r){var t=this.cursor({});return new tu(function(n,e){t.onerror=function(t){t=gu(t.target.error),e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},pu.prototype.Mt=function(t,i){var o=[];return new tu(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new ru(n),(t=i(n.primaryKey,n.value,e))instanceof tu&&(t=t.catch(function(t){return e.done(),tu.reject(t)}),o.push(t)),e.isDone?r():null===e.Ft?n.continue():n.continue(e.Ft)):r()}}).next(function(){return tu.waitFor(o)})},pu.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},pu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Bt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},pu);function pu(t){this.store=t}function du(t){return new tu(function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=gu(t.target.error),n(t)}})}var yu=!1;function gu(t){var e=nu.It(l());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new Br("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return yu||(yu=!0,setTimeout(function(){throw n},0)),n}return t}var mu,vu=(n(bu,mu=c),bu);function bu(t,e){var n=this;return(n=mu.call(this)||this).Qt=t,n.currentSequenceNumber=e,n}function wu(t,e){return nu.Pt(t.Qt,e)}var Eu=(Au.prototype.applyToRemoteDocument=function(t,e,n){for(var r,i,o,s,a,u,c=n.mutationResults,h=0;h<this.mutations.length;h++){var l=this.mutations[h];l.key.isEqual(t)&&(r=l,s=e,i=c[h],l=u=a=void 0,e=r instanceof hs?(a=i,u=(o=r).value,l=ys(o.fieldTransforms,s,a.transformResults),u=ms(o.fieldTransforms,u,l),new Ti(o.key,a.version,u,{hasCommittedMutations:!0})):r instanceof ls?(a=s,u=i,is((s=r).precondition,a)?(a=ds(s,a,ys(s.fieldTransforms,a,u.transformResults)),new Ti(s.key,u.version,a,{hasCommittedMutations:!0})):new _i(s.key,u.version)):new Ii(r.key,i.version,{hasCommittedMutations:!0}))}return e},Au.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=os(i,e,this.localWriteTime));for(var i,o=0,s=this.mutations;o<s.length;o++)(i=s[o]).key.isEqual(t)&&(e=os(i,e,this.localWriteTime));return e},Au.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Au.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Gs())},Au.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,ss)&&Cr(this.baseMutations,t.baseMutations,ss)},Au),Tu=(Du.from=function(t,e,n){Sr(t.mutations.length===n.length);for(var r=Bs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Du(t,e,n,r)},Du),Iu=(Su.prototype.withSequenceNumber=function(t){return new Su(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Su.prototype.withResumeToken=function(t,e){return new Su(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Su.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Su(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Su),_u=function(t){this.Kt=t};function Su(t,e,n,r,i,o,s){void 0===i&&(i=Do.min()),void 0===o&&(o=Do.min()),void 0===s&&(s=Qr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Du(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Au(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Nu(t,e){if(e.document)return ba(t.Kt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=zr.fromSegments(e.noDocument.path),r=Lu(e.noDocument.readTime);return new Ii(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}return e.unknownDocument?(n=zr.fromSegments(e.unknownDocument.path),r=Lu(e.unknownDocument.version),new _i(n,r)):_r()}function Cu(t,e,n){var r=ku(n),n=e.key.path.popLast().toArray();if(e instanceof Ti){var i={name:fa(o=t.Kt,(s=e).key),fields:s.toProto().mapValue.fields,updateTime:aa(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new Ba(null,null,i,o,r,n)}if(e instanceof Ii){var s=e.key.path.toArray(),i=Ru(e.version),o=e.hasCommittedMutations;return new Ba(null,new Va(s,i),null,o,r,n)}return e instanceof _i?(o=e.key.path.toArray(),e=Ru(e.version),new Ba(new Ua(o,e),null,null,!0,r,n)):_r()}function ku(t){return[(t=t.toTimestamp()).seconds,t.nanoseconds]}function xu(t){return t=new ri(t[0],t[1]),Do.fromTimestamp(t)}function Ru(t){return t=t.toTimestamp(),new Oa(t.seconds,t.nanoseconds)}function Lu(t){return t=new ri(t.seconds,t.nanoseconds),Do.fromTimestamp(t)}function Ou(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Ea(e.Kt,t)}),r=0;r<t.mutations.length-1;++r){var i,o=t.mutations[r];r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform&&(i=t.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r+1,1),++r)}var s=t.mutations.map(function(t){return Ea(e.Kt,t)}),a=ri.fromMillis(t.localWriteTimeMs);return new Eu(t.batchId,a,n,s)}function Pu(t){var e=Lu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Lu(t.lastLimboFreeSnapshotVersion):Do.min(),r=void 0!==t.query.documents?(Sr(1===(r=t.query).documents.length),bo(lo(ya(r.documents[0])))):bo(_a(t.query));return new Iu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Qr.fromBase64String(t.resumeToken))}function Mu(t,e){var n=Ru(e.snapshotVersion),r=Ru(e.lastLimboFreeSnapshotVersion),i=(Ri(e.target)?Ta:Ia)(t.Kt,e.target),t=e.resumeToken.toBase64();return new Ga(e.targetId,ki(e.target),n,t,e.sequenceNumber,r,i)}function Fu(t){var e=_a({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?wo(e,e.limit,"L"):e}var qu=(Vu.prototype.getBundleMetadata=function(t,e){return Uu(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:Lu(t.createTime),version:t.version}})},Vu.prototype.saveBundleMetadata=function(t,e){return Uu(t).put({bundleId:e.id,createTime:Ru(ca(e.createTime)),version:e.version})},Vu.prototype.getNamedQuery=function(t,e){return Bu(t).get(e).next(function(t){if(t)return{name:t.name,query:Fu(t.bundledQuery),readTime:Lu(t.readTime)}})},Vu.prototype.saveNamedQuery=function(t,e){return Bu(t).put({name:e.name,readTime:Ru(ca(e.readTime)),bundledQuery:e.bundledQuery})},Vu);function Vu(){}function Uu(t){return wu(t,Wa.store)}function Bu(t){return wu(t,Ya.store)}var ju=(Hu.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),tu.resolve()},Hu.prototype.getCollectionParents=function(t,e){return tu.resolve(this.Wt.getEntries(e))},Hu),Gu=(Qu.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ps(jr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},Qu.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast();return(e=this.index[e])&&e.has(t)},Qu.prototype.getEntries=function(t){return(this.index[t]||new Ps(jr.comparator)).toArray()},Qu),Ku=(zu.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.jt.has(e))return tu.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener(function(){n.jt.add(e)}),i={collectionId:r,parent:ka(i)},Wu(t).put(i)},zu.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[kr(i),""],!1,!0);return Wu(t).kt(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ra(r.parent))}return o})},zu);function zu(){this.jt=new Gu}function Qu(){this.index={}}function Hu(){this.Wt=new Gu}function Wu(t){return wu(t,Qa.store)}var Yu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Xu=(Ju.withCacheSize=function(t){return new Ju(t,Ju.DEFAULT_COLLECTION_PERCENTILE,Ju.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Ju);function Ju(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function $u(t,e,n){var r=t.store(Ma.store),i=t.store(Fa.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.qt({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Sr(1===s)}));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Fa.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return tu.waitFor(o).next(function(){return a})}function Zu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _r();e=t.noDocument}return JSON.stringify(e).length}Xu.DEFAULT_COLLECTION_PERCENTILE=10,Xu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xu.DEFAULT=new Xu(41943040,Xu.DEFAULT_COLLECTION_PERCENTILE,Xu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xu.DISABLED=new Xu(-1,0,0);var tc=(ec.Ht=function(t,e,n,r){return Sr(""!==t.uid),new ec(t.isAuthenticated()?t.uid:"",e,n,r)},ec.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return rc(t).qt({index:Ma.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},ec.prototype.addMutationBatch=function(d,y,g,m){var v=this,b=ic(d),w=rc(d);return w.add({}).next(function(t){Sr("number"==typeof t);for(var e,n,r,i,o,s=new Eu(t,y,g,m),a=(e=v.D,n=v.userId,i=(r=s).baseMutations.map(function(t){return wa(e.Kt,t)}),o=r.mutations.map(function(t){return wa(e.Kt,t)}),new Ma(n,r.batchId,r.localWriteTime.toMillis(),i,o)),u=[],c=new Ps(function(t,e){return Nr(t.canonicalString(),e.canonicalString())}),h=0,l=m;h<l.length;h++){var f=l[h],p=Fa.key(v.userId,f.key.path,t),c=c.add(f.key.path.popLast());u.push(w.put(a)),u.push(b.put(p,Fa.PLACEHOLDER))}return c.forEach(function(t){u.push(v.Gt.addToCollectionParentIndex(d,t))}),d.addOnCommittedListener(function(){v.zt[t]=s.keys()}),tu.waitFor(u).next(function(){return s})})},ec.prototype.lookupMutationBatch=function(t,e){var n=this;return rc(t).get(e).next(function(t){return t?(Sr(t.userId===n.userId),Ou(n.D,t)):null})},ec.prototype.Jt=function(t,e){var n=this;return this.zt[e]?tu.resolve(this.zt[e]):this.lookupMutationBatch(t,e).next(function(t){return t?(t=t.keys(),n.zt[e]=t):null})},ec.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return rc(t).qt({index:Ma.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Sr(e.batchId>=i),o=Ou(r.D,e)),n.done()}).next(function(){return o})},ec.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return rc(t).qt({index:Ma.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},ec.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return rc(t).kt(Ma.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ou(e.D,t)})})},ec.prototype.getAllMutationBatchesAffectingDocumentKey=function(o,s){var a=this,t=Fa.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),u=[];return ic(o).qt({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);if(r===a.userId&&s.path.isEqual(i))return rc(o).get(t).next(function(t){if(!t)throw _r();Sr(t.userId===a.userId),u.push(Ou(a.D,t))});n.done()}).next(function(){return u})},ec.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var s=this,a=new Ps(Nr),n=[];return t.forEach(function(o){var t=Fa.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=ic(e).qt({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);r===s.userId&&o.path.isEqual(i)?a=a.add(t):n.done()});n.push(t)}),tu.waitFor(n).next(function(){return s.Yt(e,a)})},ec.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var o=this,s=e.path,a=s.length+1,e=Fa.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),u=new Ps(Nr);return ic(t).qt({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ra(i);r===o.userId&&s.isPrefixOf(i)?i.length===a&&(u=u.add(t)):n.done()}).next(function(){return o.Yt(t,u)})},ec.prototype.Yt=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(rc(e).get(t).next(function(t){if(null===t)throw _r();Sr(t.userId===n.userId),r.push(Ou(n.D,t))}))}),tu.waitFor(i).next(function(){return r})},ec.prototype.removeMutationBatch=function(e,n){var r=this;return $u(e.Qt,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.Xt(n.batchId)}),tu.forEach(t,function(t){return r.referenceDelegate.markPotentiallyOrphaned(e,t)})})},ec.prototype.Xt=function(t){delete this.zt[t]},ec.prototype.performConsistencyCheck=function(e){var i=this;return this.checkEmpty(e).next(function(t){if(!t)return tu.resolve();var t=IDBKeyRange.lowerBound(Fa.prefixForUser(i.userId)),r=[];return ic(e).qt({range:t},function(t,e,n){t[0]===i.userId?(t=Ra(t[1]),r.push(t)):n.done()}).next(function(){Sr(0===r.length)})})},ec.prototype.containsKey=function(t,e){return nc(t,this.userId,e)},ec.prototype.Zt=function(t){var e=this;return oc(t).get(this.userId).next(function(t){return t||new Pa(e.userId,-1,"")})},ec);function ec(t,e,n,r){this.userId=t,this.D=e,this.Gt=n,this.referenceDelegate=r,this.zt={}}function nc(t,o,e){var s=(e=Fa.prefixForPath(o,e.path))[1],e=IDBKeyRange.lowerBound(e),a=!1;return ic(t).qt({range:e,Bt:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function rc(t){return wu(t,Ma.store)}function ic(t){return wu(t,Fa.store)}function oc(t){return wu(t,Pa.store)}var sc=(cc.prototype.next=function(){return this.te+=2,this.te},cc.ee=function(){return new cc(0)},cc.ne=function(){return new cc(-1)},cc),ac=(uc.prototype.allocateTargetId=function(n){var r=this;return this.se(n).next(function(t){var e=new sc(t.highestTargetId);return t.highestTargetId=e.next(),r.ie(n,t).next(function(){return t.highestTargetId})})},uc.prototype.getLastRemoteSnapshotVersion=function(t){return this.se(t).next(function(t){return Do.fromTimestamp(new ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},uc.prototype.getHighestSequenceNumber=function(t){return this.se(t).next(function(t){return t.highestListenSequenceNumber})},uc.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.se(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.ie(e,t)})},uc.prototype.addTargetData=function(e,n){var r=this;return this.re(e,n).next(function(){return r.se(e).next(function(t){return t.targetCount+=1,r.oe(n,t),r.ie(e,t)})})},uc.prototype.updateTargetData=function(t,e){return this.re(t,e)},uc.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return hc(e).delete(t.targetId)}).next(function(){return n.se(e)}).next(function(t){return Sr(0<t.targetCount),--t.targetCount,n.ie(e,t)})},uc.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return hc(n).qt(function(t,e){(e=Pu(e)).sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,a.push(o.removeTargetData(n,e)))}).next(function(){return tu.waitFor(a)}).next(function(){return s})},uc.prototype.forEachTarget=function(t,n){return hc(t).qt(function(t,e){e=Pu(e),n(e)})},uc.prototype.se=function(t){return lc(t).get(za.key).next(function(t){return Sr(null!==t),t})},uc.prototype.ie=function(t,e){return lc(t).put(za.key,e)},uc.prototype.re=function(t,e){return hc(t).put(Mu(this.D,e))},uc.prototype.oe=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},uc.prototype.getTargetCount=function(t){return this.se(t).next(function(t){return t.targetCount})},uc.prototype.getTargetData=function(t,r){var e=ki(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return hc(t).qt({range:e,index:Ga.queryTargetsIndexName},function(t,e,n){e=Pu(e),xi(r,e.target)&&(i=e,n.done())}).next(function(){return i})},uc.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],s=fc(n);return t.forEach(function(t){var e=ka(t.path);o.push(s.put(new Ka(r,e))),o.push(i.referenceDelegate.addReference(n,r,t))}),tu.waitFor(o)},uc.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=fc(n);return tu.forEach(t,function(t){var e=ka(t.path);return tu.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,r,t)])})},uc.prototype.removeMatchingKeysForTargetId=function(t,e){return t=fc(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},uc.prototype.getMatchingKeysForTargetId=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=fc(t),r=Gs();return t.qt({range:e,Bt:!0},function(t,e,n){t=Ra(t[1]),t=new zr(t),r=r.add(t)}).next(function(){return r})},uc.prototype.containsKey=function(t,e){var e=ka(e.path),e=IDBKeyRange.bound([e],[kr(e)],!1,!0),i=0;return fc(t).qt({index:Ka.documentTargetsIndex,Bt:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},uc.prototype.yt=function(t,e){return hc(t).get(e).next(function(t){return t?Pu(t):null})},uc);function uc(t,e){this.referenceDelegate=t,this.D=e}function cc(t){this.te=t}function hc(t){return wu(t,Ga.store)}function lc(t){return wu(t,za.store)}function fc(t){return wu(t,Ka.store)}function pc(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Ur.FAILED_PRECONDITION||e.message!==$a)throw e;return wr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function dc(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return 0===(t=Nr(n,t))?Nr(r,e):t}var yc=(Tc.prototype.ue=function(){return++this.ae},Tc.prototype.he=function(t){var e=[t,this.ue()];this.buffer.size<this.ce?this.buffer=this.buffer.add(e):dc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Tc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Tc),gc=(Ec.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.de(t)},Ec.prototype.stop=function(){this.fe&&(this.fe.cancel(),this.fe=null)},Object.defineProperty(Ec.prototype,"started",{get:function(){return null!==this.fe},enumerable:!1,configurable:!0}),Ec.prototype.de=function(n){var t=this,e=this.le?3e5:6e4;wr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.fe=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:this.fe=null,this.le=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.collectGarbage(this.garbageCollector)];case 2:return t.sent(),[3,7];case 3:return lu(e=t.sent())?(wr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,pc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.de(n)];case 8:return t.sent(),[2]}})})})},Ec),mc=(wc.prototype.calculateTargetCount=function(t,e){return this.we._e(t).next(function(t){return Math.floor(e/100*t)})},wc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return tu.resolve(gr.o);var r=new yc(e);return this.we.forEachTarget(t,function(t){return r.he(t.sequenceNumber)}).next(function(){return n.we.me(t,function(t){return r.he(t)})}).next(function(){return r.maxValue})},wc.prototype.removeTargets=function(t,e,n){return this.we.removeTargets(t,e,n)},wc.prototype.removeOrphanedDocuments=function(t,e){return this.we.removeOrphanedDocuments(t,e)},wc.prototype.collect=function(e,n){var r=this;return-1===this.params.cacheSizeCollectionThreshold?(wr("LruGarbageCollector","Garbage collection skipped; disabled"),tu.resolve(Yu)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(wr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Yu):r.ye(e,n)})},wc.prototype.getCacheSize=function(t){return this.we.getCacheSize(t)},wc.prototype.ye=function(e,n){var r,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(wr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,s=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,a=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),br()<=f.DEBUG&&wr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),tu.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},wc),vc=(bc.prototype._e=function(t){var n=this.ge(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},bc.prototype.ge=function(t){var e=0;return this.me(t,function(t){e++}).next(function(){return e})},bc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},bc.prototype.me=function(t,n){return this.pe(t,function(t,e){return n(e)})},bc.prototype.addReference=function(t,e,n){return Ic(t,n)},bc.prototype.removeReference=function(t,e,n){return Ic(t,n)},bc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},bc.prototype.markPotentiallyOrphaned=Ic,bc.prototype.Ee=function(t,e){return r=e,i=!1,oc(n=t).Ut(function(t){return nc(n,t,r).next(function(t){return t&&(i=!0),tu.resolve(!t)})}).next(function(){return i});var n,r,i},bc.prototype.removeOrphanedDocuments=function(n,r){var i=this,o=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.pe(n,function(e,t){t<=r&&(t=i.Ee(n,e).next(function(t){if(!t)return a++,o.getEntry(n,e).next(function(){return o.removeEntry(e),fc(n).delete([0,ka(e.path)])})}),s.push(t))}).next(function(){return tu.waitFor(s)}).next(function(){return o.apply(n)}).next(function(){return a})},bc.prototype.removeTarget=function(t,e){return e=e.withSequenceNumber(t.currentSequenceNumber),this.db.getTargetCache().updateTargetData(t,e)},bc.prototype.updateLimboDocument=Ic,bc.prototype.pe=function(t,r){var i,t=fc(t),o=gr.o;return t.qt({index:Ka.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==gr.o&&r(new zr(Ra(i)),o),o=e,i=t):o=gr.o}).next(function(){o!==gr.o&&r(new zr(Ra(i)),o)})},bc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},bc);function bc(t,e){this.db=t,this.garbageCollector=new mc(this,e)}function wc(t,e){this.we=t,this.params=e}function Ec(t,e){this.garbageCollector=t,this.asyncQueue=e,this.le=!1,this.fe=null}function Tc(t){this.ce=t,this.buffer=new Ps(dc),this.ae=0}function Ic(t,e){return fc(t).put((t=t.currentSequenceNumber,new Ka(0,ka(e.path),t)))}var _c,Sc=(xc.prototype.get=function(t){var e=this.mapKeyFn(t);if(void 0!==(e=this.inner[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.equalsFn(i,t))return o}},xc.prototype.has=function(t){return void 0!==this.get(t)},xc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},xc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},xc.prototype.forEach=function(s){Rr(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];s(i,o)}})},xc.prototype.isEmpty=function(){return Lr(this.inner)},xc),me=(kc.prototype.getReadTime=function(t){return(t=this.changes.get(t))?t.readTime:Do.min()},kc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},kc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},kc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?tu.resolve(n.maybeDocument):this.getFromCache(t,e)},kc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},kc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},kc.prototype.assertNotApplied=function(){},kc),Dc=(Cc.prototype.addEntry=function(t,e,n){return Lc(t).put(Oc(e),n)},Cc.prototype.removeEntry=function(t,e){return t=Lc(t),e=Oc(e),t.delete(e)},Cc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Te(e,t)})},Cc.prototype.getEntry=function(t,e){var n=this;return Lc(t).get(Oc(e)).next(function(t){return n.Ie(t)})},Cc.prototype.Ae=function(t,e){var n=this;return Lc(t).get(Oc(e)).next(function(t){var e=n.Ie(t);return e?{maybeDocument:e,size:Zu(t)}:null})},Cc.prototype.getEntries=function(t,e){var n=this,r=Fs;return this.Re(t,e,function(t,e){e=n.Ie(e),r=r.insert(t,e)}).next(function(){return r})},Cc.prototype.be=function(t,e){var r=this,i=Fs,o=new Ns(zr.comparator);return this.Re(t,e,function(t,e){var n=r.Ie(e);o=n?(i=i.insert(t,n),o.insert(t,Zu(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{ve:i,Pe:o}})},Cc.prototype.Re=function(t,e,i){if(e.isEmpty())return tu.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),s=o.getNext();return Lc(t).qt({range:n},function(t,e,n){for(var r=zr.fromSegments(t);s&&zr.comparator(s,r)<0;)i(s,null),s=o.getNext();s&&s.isEqual(r)&&(i(s,e),s=o.hasNext()?o.getNext():null),s?n.Ot(s.path.toArray()):n.done()}).next(function(){for(;s;)i(s,null),s=o.hasNext()?o.getNext():null})},Cc.prototype.getDocumentsMatchingQuery=function(t,r,e){var n,i=this,o=Us,s=r.path.length+1,a={};return e.isEqual(Do.min())?(n=r.path.toArray(),a.range=IDBKeyRange.lowerBound(n)):(n=r.path.toArray(),e=ku(e),a.range=IDBKeyRange.lowerBound([n,e],!0),a.index=Ba.collectionReadTimeIndex),Lc(t).qt(a,function(t,e,n){t.length===s&&(e=Nu(i.D,e),r.path.isPrefixOf(e.key.path)?e instanceof Ti&&_o(r,e)&&(o=o.insert(e.key,e)):n.done())}).next(function(){return o})},Cc.prototype.newChangeBuffer=function(t){return new Ac(this,!!t&&t.trackRemovals)},Cc.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Cc.prototype.getMetadata=function(t){return Rc(t).get(ja.key).next(function(t){return Sr(!!t),t})},Cc.prototype.Te=function(t,e){return Rc(t).put(ja.key,e)},Cc.prototype.Ie=function(t){return!t||(t=Nu(this.D,t))instanceof Ii&&t.version.isEqual(Do.min())?null:t},Cc),Ac=(n(Nc,_c=me),Nc.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new Ps(function(t,e){return Nr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n,r=o.Se.get(t);e.maybeDocument?(n=Cu(o.Ve.D,e.maybeDocument,o.getReadTime(t)),u=u.add(t.path.popLast()),e=Zu(n),a+=e-r,s.push(o.Ve.addEntry(i,t,n))):(a-=r,o.trackRemovals?(r=Cu(o.Ve.D,new Ii(t,Do.min()),o.getReadTime(t)),s.push(o.Ve.addEntry(i,t,r))):s.push(o.Ve.removeEntry(i,t)))}),u.forEach(function(t){s.push(o.Ve.Gt.addToCollectionParentIndex(i,t))}),s.push(this.Ve.updateMetadata(i,a)),tu.waitFor(s)},Nc.prototype.getFromCache=function(t,e){var n=this;return this.Ve.Ae(t,e).next(function(t){return null===t?(n.Se.set(e,0),null):(n.Se.set(e,t.size),t.maybeDocument)})},Nc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ve.be(t,e).next(function(t){var e=t.ve;return t.Pe.forEach(function(t,e){n.Se.set(t,e)}),e})},Nc);function Nc(t,e){var n=this;return(n=_c.call(this)||this).Ve=t,n.trackRemovals=e,n.Se=new Sc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Cc(t,e){this.D=t,this.Gt=e}function kc(){this.changes=new Sc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function xc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function Rc(t){return wu(t,ja.store)}function Lc(t){return wu(t,Ba.store)}function Oc(t){return t.path.toArray()}var Pc=(Mc.prototype.St=function(e,n,t,r){var i=this;Sr(t<r&&0<=t&&r<=11);var o=new eu("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(La.store),(s=e).createObjectStore(Pa.store,{keyPath:Pa.keyPath}),s.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Fa.store),Fc(e),e.createObjectStore(Ba.store));var s,a=tu.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Ka.store),s.deleteObjectStore(Ga.store),s.deleteObjectStore(za.store),Fc(e)),a=a.next(function(){return t=o.store(za.store),e=new za(0,0,Do.min().toTimestamp(),0),t.put(za.key,e);var t,e})),t<4&&4<=r&&(a=(a=0!==t?a.next(function(){return n=e,(r=o).store(Ma.store).kt().next(function(t){n.deleteObjectStore(Ma.store),n.createObjectStore(Ma.store,{keyPath:Ma.keyPath,autoIncrement:!0}).createIndex(Ma.userMutationsIndex,Ma.userMutationsKeyPath,{unique:!0});var e=r.store(Ma.store),t=t.map(function(t){return e.put(t)});return tu.waitFor(t)});var n,r}):a).next(function(){e.createObjectStore(Ha.store,{keyPath:Ha.keyPath})})),t<5&&5<=r&&(a=a.next(function(){return i.De(o)})),t<6&&6<=r&&(a=a.next(function(){return e.createObjectStore(ja.store),i.Ce(o)})),t<7&&7<=r&&(a=a.next(function(){return i.xe(o)})),t<8&&8<=r&&(a=a.next(function(){return i.Ne(e,o)})),t<9&&9<=r&&(a=a.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Ba.store)).createIndex(Ba.readTimeIndex,Ba.readTimeIndexPath,{unique:!1}),t.createIndex(Ba.collectionReadTimeIndex,Ba.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(a=a.next(function(){return i.$e(o)})),t<11&&11<=r?a.next(function(){e.createObjectStore(Wa.store,{keyPath:Wa.keyPath}),e.createObjectStore(Ya.store,{keyPath:Ya.keyPath})}):a},Mc.prototype.Ce=function(e){var n=0;return e.store(Ba.store).qt(function(t,e){n+=Zu(e)}).next(function(){var t=new ja(n);return e.store(ja.store).put(ja.key,t)})},Mc.prototype.De=function(n){var r=this,t=n.store(Pa.store),i=n.store(Ma.store);return t.kt().next(function(t){return tu.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.kt(Ma.userMutationsIndex,t).next(function(t){return tu.forEach(t,function(t){return Sr(t.userId===e.userId),t=Ou(r.D,t),$u(n,e.userId,t).next(function(){})})})})})},Mc.prototype.xe=function(t){var o=t.store(Ka.store),e=t.store(Ba.store);return t.store(za.store).get(za.key).next(function(r){var i=[];return e.qt(function(t,e){var n=new jr(t),t=[0,ka(n)];i.push(o.get(t).next(function(t){return t?tu.resolve():o.put(new Ka(0,ka(n),r.highestListenSequenceNumber))}))}).next(function(){return tu.waitFor(i)})})},Mc.prototype.Ne=function(t,e){function r(t){if(i.add(t)){var e=t.lastSegment(),t=t.popLast();return n.put({collectionId:e,parent:ka(t)})}}t.createObjectStore(Qa.store,{keyPath:Qa.keyPath});var n=e.store(Qa.store),i=new Gu;return e.store(Ba.store).qt({Bt:!0},function(t,e){return r((t=new jr(t)).popLast())}).next(function(){return e.store(Fa.store).qt({Bt:!0},function(t,e){t[0];var n=t[1];return r((n=(t[2],Ra(n))).popLast())})})},Mc.prototype.$e=function(t){var n=this,r=t.store(Ga.store);return r.qt(function(t,e){return e=Pu(e),e=Mu(n.D,e),r.put(e)})},Mc);function Mc(t){this.D=t}function Fc(t){t.createObjectStore(Ka.store,{keyPath:Ka.keyPath}).createIndex(Ka.documentTargetsIndex,Ka.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ga.store,{keyPath:Ga.keyPath}).createIndex(Ga.queryTargetsIndexName,Ga.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(za.store)}var qc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Vc=(Uc.prototype.start=function(){var e=this;return this.Ye().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Br(Ur.FAILED_PRECONDITION,qc);return e.Xe(),e.Ze(),e.tn(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ge.getHighestSequenceNumber(t)})}).then(function(t){e.Me=new gr(t,e.Oe)}).then(function(){e.Le=!0}).catch(function(t){return e.je&&e.je.close(),Promise.reject(t)})},Uc.prototype.en=function(n){var t=this;return this.Ke=function(e){return y(t,void 0,void 0,function(){return g(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Uc.prototype.setDatabaseDeletedListener=function(n){var t=this;this.je.Ct(function(e){return y(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Uc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Fe.enqueueAndForget(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.started?[4,this.Ye()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Uc.prototype.Ye=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return jc(e).put(new Ha(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.nn(e).next(function(t){t||(n.isPrimary=!1,n.Fe.enqueueRetryable(function(){return n.Ke(!1)}))})}).next(function(){return n.sn(e)}).next(function(t){return n.isPrimary&&!t?n.rn(e).next(function(){return!1}):!!t&&n.on(e).next(function(){return!0})})}).catch(function(t){if(lu(t))return wr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return wr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Fe.enqueueRetryable(function(){return n.Ke(t)}),n.isPrimary=t})},Uc.prototype.nn=function(t){var e=this;return Bc(t).get(La.key).next(function(t){return tu.resolve(e.cn(t))})},Uc.prototype.an=function(t){return jc(t).delete(this.clientId)},Uc.prototype.un=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return g(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.hn(this.Qe,18e5)?[3,2]:(this.Qe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=wu(t,Ha.store);return r.kt().next(function(t){var e=o.ln(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return tu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Je)for(n=0,r=e;n<r.length;n++)i=r[n],this.Je.removeItem(this.fn(i.clientId));t.label=2;case 2:return[2]}})})},Uc.prototype.tn=function(){var t=this;this.Ue=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.Ye().then(function(){return t.un()}).then(function(){return t.tn()})})},Uc.prototype.cn=function(t){return!!t&&t.ownerId===this.clientId},Uc.prototype.sn=function(e){var r=this;return this.ke?tu.resolve(!0):Bc(e).get(La.key).next(function(t){if(null!==t&&r.hn(t.leaseTimestampMs,5e3)&&!r.dn(t.ownerId)){if(r.cn(t)&&r.networkEnabled)return!0;if(!r.cn(t)){if(!t.allowTabSynchronization)throw new Br(Ur.FAILED_PRECONDITION,qc);return!1}}return!(!r.networkEnabled||!r.inForeground)||jc(e).kt().next(function(t){return void 0===r.ln(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&wr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Uc.prototype.shutdown=function(){return y(this,void 0,void 0,function(){var n=this;return g(this,function(t){switch(t.label){case 0:return this.Le=!1,this.wn(),this.Ue&&(this.Ue.cancel(),this.Ue=null),this._n(),this.mn(),[4,this.je.runTransaction("shutdown","readwrite",[La.store,Ha.store],function(t){var e=new vu(t,gr.o);return n.rn(e).next(function(){return n.an(e)})})];case 1:return t.sent(),this.je.close(),this.yn(),[2]}})})},Uc.prototype.ln=function(t,e){var n=this;return t.filter(function(t){return n.hn(t.updateTimeMs,e)&&!n.dn(t.clientId)})},Uc.prototype.gn=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return jc(t).kt().next(function(t){return e.ln(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Uc.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Uc.prototype.getMutationQueue=function(t){return tc.Ht(t,this.D,this.Gt,this.referenceDelegate)},Uc.prototype.getTargetCache=function(){return this.Ge},Uc.prototype.getRemoteDocumentCache=function(){return this.ze},Uc.prototype.getIndexManager=function(){return this.Gt},Uc.prototype.getBundleCache=function(){return this.He},Uc.prototype.runTransaction=function(e,n,r){var i=this;wr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.je.runTransaction(e,t,Ja,function(t){return o=new vu(t,i.Me?i.Me.next():gr.o),"readwrite-primary"===n?i.nn(o).next(function(t){return!!t||i.sn(o)}).next(function(t){if(!t)throw Er("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Fe.enqueueRetryable(function(){return i.Ke(!1)}),new Br(Ur.FAILED_PRECONDITION,$a);return r(o)}).next(function(t){return i.on(o).next(function(){return t})}):i.pn(o).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},Uc.prototype.pn=function(t){var e=this;return Bc(t).get(La.key).next(function(t){if(null!==t&&e.hn(t.leaseTimestampMs,5e3)&&!e.dn(t.ownerId)&&!e.cn(t)&&!(e.ke||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Br(Ur.FAILED_PRECONDITION,qc)})},Uc.prototype.on=function(t){var e=new La(this.clientId,this.allowTabSynchronization,Date.now());return Bc(t).put(La.key,e)},Uc.At=function(){return nu.At()},Uc.prototype.rn=function(t){var e=this,n=Bc(t);return n.get(La.key).next(function(t){return e.cn(t)?(wr("IndexedDbPersistence","Releasing primary lease."),n.delete(La.key)):tu.resolve()})},Uc.prototype.hn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Er("Detected an update time that is in the future: "+t+" > "+n),1))},Uc.prototype.Xe=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){t.Fe.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ye()})},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)},Uc.prototype._n=function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)},Uc.prototype.Ze=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Be=function(){e.wn(),e.Fe.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Be))},Uc.prototype.mn=function(){this.Be&&(this.window.removeEventListener("unload",this.Be),this.Be=null)},Uc.prototype.dn=function(t){try{var e=null!==(null===(e=this.Je)||void 0===e?void 0:e.getItem(this.fn(t)));return wr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Er("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Uc.prototype.wn=function(){if(this.Je)try{this.Je.setItem(this.fn(this.clientId),String(Date.now()))}catch(t){Er("Failed to set zombie client id.",t)}},Uc.prototype.yn=function(){if(this.Je)try{this.Je.removeItem(this.fn(this.clientId))}catch(t){}},Uc.prototype.fn=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Uc);function Uc(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fe=i,this.window=o,this.document=s,this.Oe=u,this.ke=c,this.Me=null,this.Le=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Be=null,this.inForeground=!1,this.qe=null,this.Ue=null,this.Qe=Number.NEGATIVE_INFINITY,this.Ke=function(t){return Promise.resolve()},!Uc.At())throw new Br(Ur.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vc(this,r),this.We=e+"main",this.D=new _u(a),this.je=new nu(this.We,11,new Pc(this.D)),this.Ge=new ac(this.referenceDelegate,this.D),this.Gt=new Ku,this.ze=(e=this.D,a=this.Gt,new Dc(e,a)),this.He=new qu,this.window&&this.window.localStorage?this.Je=this.window.localStorage:(this.Je=null,!1===c&&Er("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Bc(t){return wu(t,La.store)}function jc(t){return wu(t,Ha.store)}function Gc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function Kc(t,e){this.progress=t,this.En=e}var zc=($c.prototype.In=function(e,n){var r=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.An(e,n,t)})},$c.prototype.An=function(t,r,i){return this.ze.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},$c.prototype.Rn=function(t,e,i){var o=Fs;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},$c.prototype.bn=function(e,t){var n=this;return this.ze.getEntries(e,t).next(function(t){return n.vn(e,t)})},$c.prototype.vn=function(e,r){var i=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(e,r).next(function(t){var t=i.Rn(e,r,t),n=Fs;return t.forEach(function(t,e){e=e||new Ii(t,Do.min()),n=n.insert(t,e)}),n})},$c.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,zr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Pn(t,e.path):mo(e)?this.Vn(t,e,n):this.Sn(t,e,n);var r},$c.prototype.Pn=function(t,e){return this.In(t,new zr(e)).next(function(t){var e=Us;return t instanceof Ti?e.insert(t.key,t):e})},$c.prototype.Vn=function(n,r,i){var o=this,s=r.collectionGroup,a=Us;return this.Gt.getCollectionParents(n,s).next(function(t){return tu.forEach(t,function(t){var e=(e=r,t=t.child(s),new co(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Sn(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},$c.prototype.Sn=function(e,n,t){var u,c,r=this;return this.ze.getDocumentsMatchingQuery(e,n,t).next(function(t){return u=t,r.Tn.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return c=t,r.Dn(e,c,u).next(function(t){u=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key;u=(s=os(s,u.get(a),r.localWriteTime))instanceof Ti?u.insert(a,s):u.remove(a)}})}).next(function(){return u.forEach(function(t,e){_o(n,e)||(u=u.remove(t))}),u})},$c.prototype.Dn=function(t,e,n){for(var r=Gs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ls&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.ze.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ti&&(c=c.insert(t,e))}),c})},$c),Qc=(Jc.Nn=function(t,e){for(var n=Gs(),r=Gs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Jc(t,e.fromCache,n,r)},Jc),Hc=(Xc.prototype.$n=function(t){this.Fn=t},Xc.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Do.min())?this.On(e,r):this.Fn.bn(e,o).next(function(t){var n=s.kn(r,t);return(fo(r)||po(r))&&s.Mn(r.limitType,n,o,i)?s.On(e,r):(br()<=f.DEBUG&&wr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Io(r)),s.Fn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},Xc.prototype.kn=function(n,t){var r=new Ps(So(n));return t.forEach(function(t,e){e instanceof Ti&&_o(n,e)&&(r=r.add(e))}),r},Xc.prototype.Mn=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.compareTo(r))},Xc.prototype.On=function(t,e){return br()<=f.DEBUG&&wr("QueryEngine","Using full collection scan to execute query:",Io(e)),this.Fn.getDocumentsMatchingQuery(t,e,Do.min())},Xc),Wc=(Yc.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Bn)})},Yc);function Yc(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ns(Nr),this.qn=new Sc(ki,xi),this.Un=Do.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new zc(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}function Xc(){}function Jc(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}function $c(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}function Zc(t,e,n,r){return new Wc(t,e,n,r)}function th(i,o){return y(this,void 0,void 0,function(){var e,n,v,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Tn,v=e.Kn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var m;return e.Tn.getAllMutationBatches(g).next(function(t){return m=t,n=e.persistence.getMutationQueue(o),v=new zc(e.Qn,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Gs(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return v.bn(g,r).next(function(t){return{Wn:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e.Tn=n,e.Kn=v,e.Ln.$n(e.Kn),r)]}})})}function eh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ge.getLastRemoteSnapshotVersion(t)})}function nh(t,s,e,a,u){var n=Gs();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Fs;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e instanceof Ii&&e.version.isEqual(Do.min())?(s.removeEntry(t,r),o=o.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):wr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function rh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ge.getTargetData(e,r).next(function(t){return t?(n=t,tu.resolve(n)):i.Ge.allocateTargetId(e).next(function(t){return n=new Iu(r,t,0,e.currentSequenceNumber),i.Ge.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Bn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Bn=i.Bn.insert(t.targetId,t),i.qn.set(r,t.targetId)),t})}function ih(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Bn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!lu(r=t.sent()))throw r;return wr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Bn=e.Bn.remove(o),e.qn.delete(n.target),[2]}})})}function oh(t,o,s){var a=t,u=Do.min(),c=Gs();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=bo(o),(void 0!==(t=(i=t).qn.get(r))?tu.resolve(i.Bn.get(t)):i.Ge.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.Ge.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.Ln.getDocumentsMatchingQuery(e,o,s?u:Do.min(),s?c:Gs())}).next(function(t){return{documents:t,jn:c}});var t,n,r,i})}function sh(t,e){var n=t,r=n.Ge;return(t=n.Bn.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.yt(t,e).next(function(t){return t?t.target:null})})}function ah(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Qn,n=t,t=s.Un,r=e,i=Fs,o=ku(t),t=Lc(n),n=IDBKeyRange.lowerBound(o,!0),t.qt({index:Ba.readTimeIndex,range:n},function(t,e){var n=Nu(r.D,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{En:i,readTime:xu(o)}});var e,n,r,i,o}).then(function(t){var e=t.En,t=t.readTime;return s.Un=t,e})}var uh,ch,hh=(xh.prototype.getBundleMetadata=function(t,e){return tu.resolve(this.Jn.get(e))},xh.prototype.saveBundleMetadata=function(t,e){return this.Jn.set(e.id,{id:e.id,version:e.version,createTime:ca(e.createTime)}),tu.resolve()},xh.prototype.getNamedQuery=function(t,e){return tu.resolve(this.Yn.get(e))},xh.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,{name:e.name,query:Fu(e.bundledQuery),readTime:ca(e.readTime)}),tu.resolve()},xh),lh=(kh.prototype.isEmpty=function(){return this.Xn.isEmpty()},kh.prototype.addReference=function(t,e){e=new fh(t,e),this.Xn=this.Xn.add(e),this.ts=this.ts.add(e)},kh.prototype.ns=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},kh.prototype.removeReference=function(t,e){this.ss(new fh(t,e))},kh.prototype.rs=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},kh.prototype.os=function(t){var e=this,n=new zr(new jr([])),r=new fh(n,t),t=new fh(n,t+1),i=[];return this.ts.forEachInRange([r,t],function(t){e.ss(t),i.push(t.key)}),i},kh.prototype.cs=function(){var e=this;this.Xn.forEach(function(t){return e.ss(t)})},kh.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},kh.prototype.us=function(t){var e=new zr(new jr([])),n=new fh(e,t),t=new fh(e,t+1),r=Gs();return this.ts.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},kh.prototype.containsKey=function(t){var e=new fh(t,0);return null!==(e=this.Xn.firstAfterOrEqual(e))&&t.isEqual(e.key)},kh),fh=(Ch.Zn=function(t,e){return zr.comparator(t.key,e.key)||Nr(t.hs,e.hs)},Ch.es=function(t,e){return Nr(t.hs,e.hs)||zr.comparator(t.key,e.key)},Ch),ph=(Nh.prototype.checkEmpty=function(t){return tu.resolve(0===this.Tn.length)},Nh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,0<this.Tn.length&&this.Tn[this.Tn.length-1],n=new Eu(i,e,n,r),this.Tn.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.fs=this.fs.add(new fh(a.key,i)),this.Gt.addToCollectionParentIndex(t,a.key.path.popLast())}return tu.resolve(n)},Nh.prototype.lookupMutationBatch=function(t,e){return tu.resolve(this.ds(e))},Nh.prototype.getNextMutationBatchAfterBatchId=function(t,e){return e+=1,e=(e=this.ws(e))<0?0:e,tu.resolve(this.Tn.length>e?this.Tn[e]:null)},Nh.prototype.getHighestUnacknowledgedBatchId=function(){return tu.resolve(0===this.Tn.length?-1:this.ls-1)},Nh.prototype.getAllMutationBatches=function(t){return tu.resolve(this.Tn.slice())},Nh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new fh(e,0),e=new fh(e,Number.POSITIVE_INFINITY),i=[];return this.fs.forEachInRange([r,e],function(t){t=n.ds(t.hs),i.push(t)}),tu.resolve(i)},Nh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ps(Nr);return e.forEach(function(t){var e=new fh(t,0),t=new fh(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,t],function(t){r=r.add(t.hs)})}),tu.resolve(this._s(r))},Nh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;zr.isDocumentKey(e)||(e=e.child(""));var e=new fh(new zr(e),0),i=new Ps(Nr);return this.fs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.hs)),!0)},e),tu.resolve(this._s(i))},Nh.prototype._s=function(t){var e=this,n=[];return t.forEach(function(t){null!==(t=e.ds(t))&&n.push(t)}),n},Nh.prototype.removeMutationBatch=function(n,r){var i=this;Sr(0===this.ys(r.batchId,"removed")),this.Tn.shift();var o=this.fs;return tu.forEach(r.mutations,function(t){var e=new fh(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.fs=o})},Nh.prototype.Xt=function(t){},Nh.prototype.containsKey=function(t,e){var n=new fh(e,0),n=this.fs.firstAfterOrEqual(n);return tu.resolve(e.isEqual(n&&n.key))},Nh.prototype.performConsistencyCheck=function(t){return this.Tn.length,tu.resolve()},Nh.prototype.ys=function(t,e){return this.ws(t)},Nh.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},Nh.prototype.ds=function(t){return(t=this.ws(t))<0||t>=this.Tn.length?null:this.Tn[t]},Nh),dh=(Ah.prototype.addEntry=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:o,readTime:n}),this.size+=o-i,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},Ah.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Ah.prototype.getEntry=function(t,e){return e=this.docs.get(e),tu.resolve(e?e.maybeDocument:null)},Ah.prototype.getEntries=function(t,e){var n=this,r=Fs;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),tu.resolve(r)},Ah.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Us,i=new zr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=(a=o.getNext()).key,a=(u=a.value).maybeDocument,u=u.readTime;if(!e.path.isPrefixOf(s.path))break;u.compareTo(n)<=0||a instanceof Ti&&_o(e,a)&&(r=r.insert(a.key,a))}return tu.resolve(r)},Ah.prototype.ps=function(t,e){return tu.forEach(this.docs,function(t){return e(t)})},Ah.prototype.newChangeBuffer=function(t){return new yh(this)},Ah.prototype.getSize=function(t){return tu.resolve(this.size)},Ah),yh=(n(Dh,ch=me),Dh.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e&&e.maybeDocument?i.push(r.Ve.addEntry(n,e.maybeDocument,r.getReadTime(t))):r.Ve.removeEntry(t)}),tu.waitFor(i)},Dh.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},Dh.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},Dh),gh=(Sh.prototype.forEachTarget=function(t,n){return this.Es.forEach(function(t,e){return n(e)}),tu.resolve()},Sh.prototype.getLastRemoteSnapshotVersion=function(t){return tu.resolve(this.lastRemoteSnapshotVersion)},Sh.prototype.getHighestSequenceNumber=function(t){return tu.resolve(this.Ts)},Sh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),tu.resolve(this.highestTargetId)},Sh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),tu.resolve()},Sh.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new sc(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},Sh.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,tu.resolve()},Sh.prototype.updateTargetData=function(t,e){return this.re(e),tu.resolve()},Sh.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),--this.targetCount,tu.resolve()},Sh.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.Es.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Es.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),tu.waitFor(a).next(function(){return s})},Sh.prototype.getTargetCount=function(t){return tu.resolve(this.targetCount)},Sh.prototype.getTargetData=function(t,e){return e=this.Es.get(e)||null,tu.resolve(e)},Sh.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),tu.resolve()},Sh.prototype.removeMatchingKeys=function(e,t,n){this.Is.rs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),tu.waitFor(i)},Sh.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),tu.resolve()},Sh.prototype.getMatchingKeysForTargetId=function(t,e){return e=this.Is.us(e),tu.resolve(e)},Sh.prototype.containsKey=function(t,e){return tu.resolve(this.Is.containsKey(e))},Sh),mh=(_h.prototype.start=function(){return Promise.resolve()},_h.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(_h.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),_h.prototype.setDatabaseDeletedListener=function(){},_h.prototype.setNetworkEnabled=function(){},_h.prototype.getIndexManager=function(){return this.Gt},_h.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new ph(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},_h.prototype.getTargetCache=function(){return this.Ge},_h.prototype.getRemoteDocumentCache=function(){return this.ze},_h.prototype.getBundleCache=function(){return this.He},_h.prototype.runTransaction=function(t,e,n){var r=this;wr("MemoryPersistence","Starting transaction:",t);var i=new vh(this.Me.next());return this.referenceDelegate.vs(),n(i).next(function(t){return r.referenceDelegate.Ps(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},_h.prototype.Vs=function(e,n){return tu.or(Object.values(this.Rs).map(function(t){return function(){return t.containsKey(e,n)}}))},_h),vh=(n(Ih,uh=c),Ih),bh=(Th.Cs=function(t){return new Th(t)},Object.defineProperty(Th.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw _r()},enumerable:!1,configurable:!0}),Th.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),tu.resolve()},Th.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),tu.resolve()},Th.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),tu.resolve()},Th.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach(function(t){return n.xs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.xs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Th.prototype.vs=function(){this.Ds=new Set},Th.prototype.Ps=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tu.forEach(this.xs,function(t){var e=zr.fromPath(t);return r.Ns(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Ds=null,i.apply(n)})},Th.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next(function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())})},Th.prototype.bs=function(t){return 0},Th.prototype.Ns=function(t,e){var n=this;return tu.or([function(){return tu.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},Th),wh=(Eh.prototype.isAuthenticated=function(){return null!=this.uid},Eh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Eh.prototype.isEqual=function(t){return t.uid===this.uid},Eh);function Eh(t){this.uid=t}function Th(t){this.persistence=t,this.Ss=new lh,this.Ds=null}function Ih(t){var e=this;return(e=uh.call(this)||this).currentSequenceNumber=t,e}function _h(t,e){var n=this;this.Rs={},this.Me=new gr(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new gh(this),this.Gt=new ju,this.ze=(t=this.Gt,new dh(t,function(t){return n.referenceDelegate.bs(t)})),this.D=new _u(e),this.He=new hh(this.D)}function Sh(t){this.persistence=t,this.Es=new Sc(ki,xi),this.lastRemoteSnapshotVersion=Do.min(),this.highestTargetId=0,this.Ts=0,this.Is=new lh,this.targetCount=0,this.As=sc.ee()}function Dh(t){var e=this;return(e=ch.call(this)||this).Ve=t,e}function Ah(t,e){this.Gt=t,this.gs=e,this.docs=new Ns(zr.comparator),this.size=0}function Nh(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new Ps(fh.Zn)}function Ch(t,e){this.key=t,this.hs=e}function kh(){this.Xn=new Ps(fh.Zn),this.ts=new Ps(fh.es)}function xh(t){this.D=t,this.Jn=new Map,this.Yn=new Map}function Rh(t,e){return"firestore_clients_"+t+"_"+e}function Lh(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.isAuthenticated()&&(n+="_"+e.uid),n}function Oh(t,e){return"firestore_targets_"+t+"_"+e}wh.UNAUTHENTICATED=new wh(null),wh.GOOGLE_CREDENTIALS=new wh("google-credentials-uid"),wh.FIRST_PARTY=new wh("first-party-uid");var Ph,Mh=(ol.$s=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Br(i.error.code,i.error.message)),o?new ol(t,e,i.state,r):(Er("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},ol.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},ol),Fh=(il.$s=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Br(r.error.code,r.error.message)),i?new il(t,r.state,n):(Er("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},il.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},il),qh=(rl.$s=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Ks,o=0;r&&o<n.activeTargetIds.length;++o)r=Mr(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new rl(t,i):(Er("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},rl),Vh=(nl.$s=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new nl(e.clientId,e.onlineState):(Er("SharedClientState","Failed to parse online state: "+t),null)},nl),Uh=(el.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},el.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},el.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},el),Bh=(tl.At=function(t){return!(!t||!t.localStorage)},tl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l=this;return g(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.gn()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Ms&&(i=this.getItem(Rh(this.persistenceKey,r)))&&(o=qh.$s(r,i))&&(this.qs=this.qs.insert(o.clientId,o));for(this.Js(),(s=this.storage.getItem(this.zs))&&(a=this.Ys(s))&&this.Xs(a),u=0,c=this.Us;u<c.length;u++)h=c[u],this.Bs(h);return this.Us=[],this.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},tl.prototype.writeSequenceNumber=function(t){this.setItem(this.Ks,JSON.stringify(t))},tl.prototype.getAllActiveQueryTargets=function(){return this.Zs(this.qs)},tl.prototype.isActiveQueryTarget=function(n){var r=!1;return this.qs.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},tl.prototype.addPendingMutation=function(t){this.ti(t,"pending")},tl.prototype.updateMutationState=function(t,e,n){this.ti(t,e,n),this.ei(t)},tl.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Oh(this.persistenceKey,t)))||(e=Fh.$s(t,e))&&(n=e.state)),this.ni.Os(t),this.Js(),n},tl.prototype.removeLocalQueryTarget=function(t){this.ni.ks(t),this.Js()},tl.prototype.isLocalQueryTarget=function(t){return this.ni.activeTargetIds.has(t)},tl.prototype.clearQueryState=function(t){this.removeItem(Oh(this.persistenceKey,t))},tl.prototype.updateQueryState=function(t,e,n){this.si(t,e,n)},tl.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.ei(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},tl.prototype.setOnlineState=function(t){this.ii(t)},tl.prototype.notifyBundleLoaded=function(){this.ri()},tl.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.Ls),this.removeItem(this.Qs),this.started=!1)},tl.prototype.getItem=function(t){var e=this.storage.getItem(t);return wr("SharedClientState","READ",t,e),e},tl.prototype.setItem=function(t,e){wr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},tl.prototype.removeItem=function(t){wr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},tl.prototype.Bs=function(t){var e=this,o=t;o.storageArea===this.storage&&(wr("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.Qs?this.Fe.enqueueRetryable(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){if(this.started){if(null!==o.key)if(this.Ws.test(o.key)){if(null==o.newValue)return e=this.oi(o.key),[2,this.ci(e,null)];if(e=this.ai(o.key,o.newValue))return[2,this.ci(e.clientId,e)]}else if(this.js.test(o.key)){if(null!==o.newValue&&(n=this.ui(o.key,o.newValue)))return[2,this.hi(n)]}else if(this.Gs.test(o.key)){if(null!==o.newValue&&(r=this.li(o.key,o.newValue)))return[2,this.fi(r)]}else if(o.key===this.zs){if(null!==o.newValue&&(i=this.Ys(o.newValue)))return[2,this.Xs(i)]}else if(o.key===this.Ks)(i=function(t){var e=gr.o;if(null!=t)try{var n=JSON.parse(t);Sr("number"==typeof n),e=n}catch(t){Er("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==gr.o&&this.sequenceNumberHandler(i);else if(o.key===this.Hs)return[2,this.syncEngine.di()]}else this.Us.push(o);return[2]})})}):Er("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(tl.prototype,"ni",{get:function(){return this.qs.get(this.Ms)},enumerable:!1,configurable:!0}),tl.prototype.Js=function(){this.setItem(this.Qs,this.ni.Fs())},tl.prototype.ti=function(t,e,n){n=new Mh(this.currentUser,t,e,n),t=Lh(this.persistenceKey,this.currentUser,t),this.setItem(t,n.Fs())},tl.prototype.ei=function(t){t=Lh(this.persistenceKey,this.currentUser,t),this.removeItem(t)},tl.prototype.ii=function(t){t={clientId:this.Ms,onlineState:t},this.storage.setItem(this.zs,JSON.stringify(t))},tl.prototype.si=function(t,e,n){var r=Oh(this.persistenceKey,t),n=new Fh(t,e,n);this.setItem(r,n.Fs())},tl.prototype.ri=function(){this.setItem(this.Hs,"value-not-used")},tl.prototype.oi=function(t){return(t=this.Ws.exec(t))?t[1]:null},tl.prototype.ai=function(t,e){return t=this.oi(t),qh.$s(t,e)},tl.prototype.ui=function(t,e){var n=this.js.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Mh.$s(new wh(n),t,e)},tl.prototype.li=function(t,e){return t=this.Gs.exec(t),t=Number(t[1]),Fh.$s(t,e)},tl.prototype.Ys=function(t){return Vh.$s(t)},tl.prototype.hi=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.syncEngine.wi(e.batchId,e.state,e.error)]:(wr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},tl.prototype.fi=function(t){return this.syncEngine._i(t.targetId,t.state,t.error)},tl.prototype.ci=function(t,e){var n=this,r=e?this.qs.insert(t,e):this.qs.remove(t),i=this.Zs(this.qs),o=this.Zs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.mi(s,a).then(function(){n.qs=r})},tl.prototype.Xs=function(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},tl.prototype.Zs=function(t){var n=Ks;return t.forEach(function(t,e){n=n.unionWith(e.activeTargetIds)}),n},tl),jh=(Zh.prototype.addPendingMutation=function(t){},Zh.prototype.updateMutationState=function(t,e,n){},Zh.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},Zh.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},Zh.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},Zh.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},Zh.prototype.clearQueryState=function(t){delete this.gi[t]},Zh.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},Zh.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},Zh.prototype.start=function(){return this.yi=new Uh,Promise.resolve()},Zh.prototype.handleUserChange=function(t,e,n){},Zh.prototype.setOnlineState=function(t){},Zh.prototype.shutdown=function(){},Zh.prototype.writeSequenceNumber=function(t){},Zh.prototype.notifyBundleLoaded=function(){},Zh),Gh=($h.prototype.pi=function(t){},$h.prototype.shutdown=function(){},$h),Kh=(Jh.prototype.pi=function(t){this.Ri.push(t)},Jh.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},Jh.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},Jh.prototype.Ti=function(){wr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},Jh.prototype.Ai=function(){wr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},Jh.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Jh),zh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Qh=(Xh.prototype.Vi=function(t){this.Si=t},Xh.prototype.Di=function(t){this.Ci=t},Xh.prototype.onMessage=function(t){this.xi=t},Xh.prototype.close=function(){this.Pi()},Xh.prototype.send=function(t){this.vi(t)},Xh.prototype.Ni=function(){this.Si()},Xh.prototype.$i=function(t){this.Ci(t)},Xh.prototype.Fi=function(t){this.xi(t)},Xh),Hh=(Yh.prototype.Mi=function(e,t,n,r){var i=this.Li(e,t);return wr("RestConnection","Sending: ",i,n),t={},this.Bi(t,r),this.qi(e,i,t,n).then(function(t){return wr("RestConnection","Received: ",t),t},function(t){throw Tr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Yh.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},Yh.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},Yh.prototype.Li=function(t,e){return t=zh[t],this.Oi+"/v1/"+e+":"+t},n(Wh,Ph=Yh),Wh.prototype.qi=function(o,e,s,a){return new Promise(function(n,r){var i=new yr;i.listenOnce(fr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case lr.NO_ERROR:var t=i.getResponseJson();wr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case lr.TIMEOUT:wr("Connection",'RPC "'+o+'" timed out'),r(new Br(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case lr.HTTP_ERROR:var e=i.getStatus();wr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Ur).indexOf(e)?e:Ur.UNKNOWN,r(new Br(e,t.message))):r(new Br(Ur.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Br(Ur.UNAVAILABLE,"Connection failed."));break;default:_r()}}finally{wr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);i.send(e,"POST",t,s,15)})},Wh.prototype.Qi=function(t,e){var n,r=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new or,o=hr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||0<=(n=l()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=l().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),wr("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new Qh({vi:function(t){u?wr("Connection","Not sending because WebChannel is closed:",t):(a||(wr("Connection","Opening WebChannel transport."),s.open(),a=!0),wr("Connection","WebChannel sending:",t),s.send(t))},Pi:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})})(s,dr.EventType.OPEN,function(){u||wr("Connection","WebChannel transport opened.")}),t(s,dr.EventType.CLOSE,function(){u||(u=!0,wr("Connection","WebChannel transport closed"),c.$i())}),t(s,dr.EventType.ERROR,function(t){u||(u=!0,Tr("Connection","WebChannel transport errored:",t),c.$i(new Br(Ur.UNAVAILABLE,"The operation could not be completed")))}),t(s,dr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Sr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(wr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=bs[r];if(void 0!==t)return As(t)}(),i=n.message,void 0===t&&(t=Ur.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.$i(new Br(t,i)),s.close()):(wr("Connection","WebChannel received:",e),c.Fi(e)))}),t(o,pr.STAT_EVENT,function(t){10===t.stat?wr("Connection","Detected buffering proxy"):11===t.stat&&wr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Ni()},0),c},Wh);function Wh(t){var e=this;return(e=Ph.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e}function Yh(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function Xh(t){this.vi=t.vi,this.Pi=t.Pi}function Jh(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}function $h(){}function Zh(){this.yi=new Uh,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function tl(t,e,n,r,i){this.window=t,this.Fe=e,this.persistenceKey=n,this.Ms=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ls=this.Bs.bind(this),this.qs=new Ns(Nr),this.started=!1,this.Us=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Rh(this.persistenceKey,this.Ms),this.Ks="firestore_sequence_number_"+this.persistenceKey,this.qs=this.qs.insert(this.Ms,new Uh),this.Ws=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.js=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.Gs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.zs="firestore_online_state_"+this.persistenceKey,this.Hs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.Ls)}function el(){this.activeTargetIds=Ks}function nl(t,e){this.clientId=t,this.onlineState=e}function rl(t,e){this.clientId=t,this.activeTargetIds=e}function il(t,e,n){this.targetId=t,this.state=e,this.error=n}function ol(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function sl(){return"undefined"!=typeof window?window:null}function al(){return"undefined"!=typeof document?document:null}function ul(t){return new sa(t,!0)}function cl(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=i,this.Wr.pi(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Rl(this)?(wr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(4),[4,Sl(e)];case 1:return t.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,_l(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.jr=new ml(n,r)}var hl,ll,fl,pl=(Il.prototype.reset=function(){this.Gi=0},Il.prototype.Ji=function(){this.Gi=this.ji},Il.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);0<i&&wr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,function(){return e.Hi=Date.now(),t()}),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},Il.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},Il.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},Il.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},Il),me=(Tl.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},Tl.prototype.ar=function(){return 2===this.state},Tl.prototype.start=function(){3!==this.state?this.auth():this.ur()},Tl.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Tl.prototype.hr=function(){this.state=0,this.rr.reset()},Tl.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,function(){return t.dr()}))},Tl.prototype.wr=function(t){this._r(),this.stream.send(t)},Tl.prototype.dr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.ar()?[2,this.close(0)]:[2]})})},Tl.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},Tl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():n&&n.code===Ur.RESOURCE_EXHAUSTED?(Er(n.toString()),Er("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):n&&n.code===Ur.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Di(n)];case 1:return t.sent(),[2]}})})},Tl.prototype.mr=function(){},Tl.prototype.auth=function(){var n=this;this.state=1;var t=this.yr(this.sr),e=this.sr;this.nr.getToken().then(function(t){n.sr===e&&n.gr(t)},function(e){t(function(){var t=new Br(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return n.pr(t)})})},Tl.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi(function(){n(function(){return e.state=2,e.listener.Vi()})}),this.stream.Di(function(t){n(function(){return e.pr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Tl.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},Tl.prototype.pr=function(t){return wr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Tl.prototype.yr=function(e){var n=this;return function(t){n.Fe.enqueueAndForget(function(){return n.sr===e?t():(wr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Tl),dl=(n(El,fl=me),El.prototype.Er=function(t){return this.er.Qi("Listen",t)},El.prototype.onMessage=function(t){this.rr.reset();var e,n=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:_r(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.V?(Sr(void 0===s||"string"==typeof s),Qr.fromBase64String(s||"")):(Sr(void 0===s||s instanceof Uint8Array),Qr.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Ur.UNKNOWN:As(c.code),new Br(u,c.message||"")),s=new Ys(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=pa(t,n.document.name),i=ca(n.document.updateTime),a=new No({mapValue:{fields:n.document.fields}}),u=(o=new Ti(r,i,a,{}),n.targetIds||[]),c=n.removedTargetIds||[],s=new Hs(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=pa(t,n.document),i=n.readTime?ca(n.readTime):Do.min(),a=new Ii(r,i),o=n.removedTargetIds||[],s=new Hs([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=pa(t,n.document),i=n.removedTargetIds||[],s=new Hs([],i,r,null);else{if(!("filter"in e))return _r();e.filter,(e=e.filter).targetId,r=new vs(n=e.count||0),i=e.targetId,s=new Ws(i,r)}return s}(this.D,t),t=!("targetChange"in(e=t))||(e=e.targetChange).targetIds&&e.targetIds.length||!e.readTime?Do.min():ca(e.readTime);return this.listener.Tr(n,t)},El.prototype.Ir=function(t){var e,n,r,i,o={};o.database=ga(this.D),o.addTarget=(e=this.D,(r=Ri(r=(n=t).target)?{documents:Ta(e,r)}:{query:Ia(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ua(e,n.resumeToken):0<n.snapshotVersion.compareTo(Do.min())&&(r.readTime=aa(e,n.snapshotVersion.toTimestamp())),r),(t=(this.D,i=t,null==(t=function(){switch(i.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _r()}}())?null:{"goog-listen-tags":t}))&&(o.labels=t),this.wr(o)},El.prototype.Ar=function(t){var e={};e.database=ga(this.D),e.removeTarget=t,this.wr(e)},El),yl=(n(wl,ll=me),Object.defineProperty(wl.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),wl.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,ll.prototype.start.call(this)},wl.prototype.mr=function(){this.Rr&&this.vr([])},wl.prototype.Er=function(t){return this.er.Qi("Write",t)},wl.prototype.onMessage=function(t){if(Sr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Sr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?ca(e.updateTime):ca(n)).isEqual(Do.min())&&(t=ca(n)),new ts(t,e.transformResults||[]);var e,n})):[]),n=ca(t.commitTime);return this.listener.Pr(n,e)}var r;return Sr(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},wl.prototype.Sr=function(){var t={};t.database=ga(this.D),this.wr(t)},wl.prototype.vr=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return wa(e.D,t)})};this.wr(t)},wl),gl=(n(bl,hl=function(){}),bl.prototype.Cr=function(){if(this.Dr)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")},bl.prototype.Mi=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Mi(e,n,r,t)}).catch(function(t){throw t.code===Ur.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},bl.prototype.Ui=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Ui(e,n,r,t)}).catch(function(t){throw t.code===Ur.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},bl.prototype.terminate=function(){this.Dr=!1},bl),ml=(vl.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()}))},vl.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},vl.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},vl.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},vl.prototype.Mr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Fr?(Er(t),this.Fr=!1):wr("OnlineStateTracker",t)},vl.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},vl);function vl(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}function bl(t,e,n){var r=this;return(r=hl.call(this)||this).credentials=t,r.er=e,r.D=n,r.Dr=!1,r}function wl(t,e,n,r,i){var o=this;return(o=ll.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).D=r,o.Rr=!1,o}function El(t,e,n,r,i){var o=this;return(o=fl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).D=r,o}function Tl(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new pl(t,e)}function Il(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}function _l(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Rl(r))return[3,4];e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Sl(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Dl(t,e){t.Ur.has(e.targetId)||(t.Ur.set(e.targetId,e),xl(t)?kl(t):Ul(t).ar()&&Nl(t,e))}function Al(t,e){var n=t,t=Ul(n);n.Ur.delete(e),t.ar()&&Cl(n,e),0===n.Ur.size&&(t.ar()?t.lr():Rl(n)&&n.jr.set("Unknown"))}function Nl(t,e){t.Gr.H(e.targetId),Ul(t).Ir(e)}function Cl(t,e){t.Gr.H(e),Ul(t).Ar(e)}function kl(e){e.Gr=new Js({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},yt:function(t){return e.Ur.get(t)||null}}),Ul(e).start(),e.jr.Or()}function xl(t){return Rl(t)&&!Ul(t).cr()&&0<t.Ur.size}function Rl(t){return 0===t.Qr.size}function Ll(t){t.Gr=void 0}function Ol(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!lu(r))throw r;return n.Qr.add(1),[4,Sl(n)];case 1:return t.sent(),n.jr.set("Offline"),i=i||function(){return eh(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return wr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Qr.delete(1),[4,_l(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Pl(e,n){return n().catch(function(t){return Ol(e,t,n)})}function Ml(c){return y(this,void 0,void 0,function(){var o,s,a,u;return g(this,function(t){switch(t.label){case 0:s=Bl(o=c),a=0<o.qr.length?o.qr[o.qr.length-1].batchId:-1,t.label=1;case 1:if(!(Rl(o)&&o.qr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(n=o.localStore,r=a,(i=n).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===r&&(r=-1),i.Tn.getNextMutationBatchAfterBatchId(t,r)}))];case 3:return null===(u=t.sent())?(0===o.qr.length&&s.lr(),[3,7]):(a=u.batchId,e=u,(n=o).qr.push(e),(n=Bl(n)).ar()&&n.br&&n.vr(e.mutations),[3,6]);case 4:return u=t.sent(),[4,Ol(o,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Fl(o)&&ql(o),[2]}var e,n,r,i})})}function Fl(t){return Rl(t)&&!Bl(t).cr()&&0<t.qr.length}function ql(t){Bl(t).start()}function Vl(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Qr.delete(2),[4,_l(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Qr.add(2),[4,Sl(e)]);case 3:t.sent(),e.jr.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Ul(n){var t,e,r,i=this;return n.zr||(n.zr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.Ur.forEach(function(t,e){Nl(n,t)}),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return Ll(e),xl(e)?(e.jr.Lr(n),kl(e)):e.jr.set("Unknown"),[2]})})}.bind(null,n),Tr:function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.jr.set("Online"),!(a instanceof Ys&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Ur.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Ur.delete(i),o.Gr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),wr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Ol(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Hs?s.Gr.st(a):a instanceof Ws?s.Gr.ht(a):s.Gr.ot(a),u.isEqual(Do.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,eh(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).Gr.dt(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&(n=r.Ur.get(e))&&r.Ur.set(e,n.withResumeToken(t.resumeToken,i))}),e.targetMismatches.forEach(function(t){var e=r.Ur.get(t);e&&(r.Ur.set(t,e.withResumeToken(Qr.EMPTY_BYTE_STRING,e.snapshotVersion)),Cl(r,t),e=new Iu(e.target,t,1,e.sequenceNumber),Nl(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return wr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Ol(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}.bind(null,n)},t.Cr(),new dl(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.zr.hr(),xl(n)?kl(n):n.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.zr.stop()];case 2:t.sent(),Ll(n),t.label=3;case 3:return[2]}})})})),n.zr}function Bl(n){var t,e,r,i=this;return n.Hr||(n.Hr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return Bl(e).Sr(),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&Bl(e).br?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Ds(n=i.code)&&n!==Ur.ABORTED?(e=r.qr.shift(),Bl(r).hr(),[4,Pl(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Ml(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Fl(e)&&ql(e),[2]}})})}.bind(null,n),Vr:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=Bl(o),n=0,r=o.qr;n<r.length;n++)i=r[n],e.vr(i.mutations);return[2]})})}.bind(null,n),Pr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.qr.shift(),n=Tu.from(e,i,o),[4,Pl(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Ml(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Cr(),new yl(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Hr.hr(),[4,Ml(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Hr.stop()];case 3:t.sent(),0<n.qr.length&&(wr("RemoteStore","Stopping write stream with "+n.qr.length+" pending writes"),n.qr=[]),t.label=4;case 4:return[2]}})})})),n.Hr}var jl=(Gl.createAndSchedule=function(t,e,n,r,i){return(i=new Gl(t,e,Date.now()+n,r,i)).start(n),i},Gl.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Gl.prototype.skipDelay=function(){return this.handleDelayElapsed()},Gl.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Br(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Gl.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Gl.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Gl);function Gl(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Za,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function Kl(t,e){if(Er("AsyncQueue",e+": "+t),lu(t))return new Br(Ur.UNAVAILABLE,e+": "+t);throw t}function zl(){this.queries=new Sc(To,Eo),this.onlineState="Unknown",this.Zr=new Set}var Ql=($l.emptySet=function(t){return new $l(t.comparator)},$l.prototype.has=function(t){return null!=this.keyedMap.get(t)},$l.prototype.get=function(t){return this.keyedMap.get(t)},$l.prototype.first=function(){return this.sortedSet.minKey()},$l.prototype.last=function(){return this.sortedSet.maxKey()},$l.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},$l.prototype.indexOf=function(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1},Object.defineProperty($l.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),$l.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},$l.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},$l.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},$l.prototype.isEqual=function(t){if(!(t instanceof $l))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},$l.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},$l.prototype.copy=function(t,e){var n=new $l;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},$l),Hl=(Jl.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);!n||0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):_r()},Jl.prototype.Yr=function(){var n=[];return this.Jr.inorderTraversal(function(t,e){n.push(e)}),n},Jl),Wl=(Xl.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Xl(t,e,Ql.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(Xl.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Xl.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Eo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Xl),Yl=function(){this.Xr=void 0,this.listeners=[]};function Xl(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Jl(){this.Jr=new Ns(zr.comparator)}function $l(n){this.comparator=n?function(t,e){return n(t,e)||zr.comparator(t.key,e.key)}:function(t,e){return zr.comparator(t.key,e.key)},this.keyedMap=Us,this.sortedSet=new Ns(this.comparator)}function Zl(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Yl),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Xr=t.sent(),[3,4];case 3:return o=Kl(o=t.sent(),"Initialization of query '"+Io(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.eo(e.onlineState),i.Xr&&a.no(i.Xr)&&ef(e),[2]}})})}function tf(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function ef(t){t.Zr.forEach(function(t){t.next()})}var nf=(hf.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Wl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},hf.prototype.onError=function(t){this.so.error(t)},hf.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},hf.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},hf.prototype.oo=function(t){if(0<t.docChanges.length)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},hf.prototype.ao=function(t){t=Wl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},hf),rf=(cf.prototype.ho=function(){return"metadata"in this.payload},cf),of=(uf.prototype.Gn=function(t){return pa(this.D,t)},uf.prototype.zn=function(t){return t.metadata.exists?ba(this.D,t.document,!1):new Ii(this.Gn(t.metadata.name),this.Hn(t.metadata.readTime))},uf.prototype.Hn=ca,uf),sf=(af.prototype.fo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},af.prototype.wo=function(t){for(var e=new Map,n=new of(this.D),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Gn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Gs()).add(s);e.set(c,h)}}return e},af.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Gs(),i=Fs,o=Bs,e=0,s=p;e<s.length;e++)a=s[e],u=f.Gn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.zn(a)),o=o.insert(u,f.Hn(a.metadata.readTime));return c=n.Qn.newChangeBuffer({trackRemovals:!0}),[4,rh(n,bo(lo(jr.fromString("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return nh(e,c,i,Do.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.Ge.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.Ge.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Kn.vn(e,t)})})})]}})})}(this.localStore,new of(this.D),this.documents,this.lo.id)];case 1:e=t.sent(),n=this.wo(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Gs()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,rh(e,bo(Fu(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ca(i.readTime);return 0<=n.snapshotVersion.compareTo(e)?r.He.saveNamedQuery(t,i):(e=n.withResumeToken(Qr.EMPTY_BYTE_STRING,e),r.Bn=r.Bn.insert(e.targetId,e),r.Ge.updateTargetData(t,e).next(function(){return r.Ge.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.Ge.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.He.saveNamedQuery(t,i)}))})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Kc(Object.assign({},this.progress),e))]}})})},af);function af(t,e,n){this.lo=t,this.localStore=e,this.D=n,this.queries=[],this.documents=[],this.progress=lf(t)}function uf(t){this.D=t}function cf(t,e){this.payload=t,this.byteLength=e}function hf(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}function lf(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ff=function(t){this.key=t},pf=function(t){this.key=t},df=(Object.defineProperty(bf.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),bf.prototype.Io=function(t,e){var s=this,a=e?e.Ao:new Hl,u=(e||this).Eo,c=(e||this).mutatedKeys,h=u,l=!1,f=fo(this.query)&&u.size===this.query.limit?u.last():null,p=po(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=(r=e instanceof Ti?e:null)&&(_o(s.query,r)?r:null),i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),e=!0):s.Ro(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.po(r,f)||p&&s.po(r,p)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),fo(this.query)||po(this.query))for(;h.size>this.query.limit;){var n=fo(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{Eo:h,Ao:a,Mn:l,mutatedKeys:c}},bf.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},bf.prototype.applyChanges=function(t,e,n){var o=this,r=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var i=t.Ao.Yr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.po(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _r()}}var r,i}),this.bo(n);var s=e?this.vo():[],e=(n=0===this.yo.size&&this.current?1:0)!==this.mo;return this.mo=n,0!==i.length||e?{snapshot:new Wl(this.query,t.Eo,r,i,t.mutatedKeys,0==n,e,!1),Po:s}:{Po:s}},bf.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new Hl,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},bf.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},bf.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._o=e._o.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e._o=e._o.delete(t)}),this.current=t.current)},bf.prototype.vo=function(){var e=this;if(!this.current)return[];var n=this.yo;this.yo=Gs(),this.Eo.forEach(function(t){e.Vo(t.key)&&(e.yo=e.yo.add(t.key))});var r=[];return n.forEach(function(t){e.yo.has(t)||r.push(new pf(t))}),this.yo.forEach(function(t){n.has(t)||r.push(new ff(t))}),r},bf.prototype.So=function(t){return this._o=t.jn,this.yo=Gs(),t=this.Io(t.documents),this.applyChanges(t,!0)},bf.prototype.Do=function(){return Wl.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},bf),yf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},gf=function(t){this.key=t,this.Co=!1},mf=(Object.defineProperty(vf.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),vf);function vf(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new Sc(To,Eo),this.$o=new Map,this.Fo=new Set,this.Oo=new Ns(zr.comparator),this.ko=new Map,this.Mo=new lh,this.Lo={},this.Bo=new Map,this.qo=sc.ne(),this.onlineState="Unknown",this.Uo=void 0}function bf(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=Gs(),this.mutatedKeys=Gs(),this.po=So(t),this.Eo=new Ql(this.po)}function wf(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Qo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view.Io(o)).Mn?[4,oh(r.localStore,i.query,!1).then(function(t){return t=t.documents,i.view.Io(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Cf(r,i.targetId,n.Po),n.snapshot)]}})})}(i,t,e,n)},[4,oh(i.localStore,o,!0)];case 1:return n=t.sent(),r=new df(o,n.jn),e=r.Io(n.documents),n=Qs.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Cf(i,s,n.Po),r=new yf(o,s,r),[2,(i.No.set(o,r),i.$o.has(s)?i.$o.get(s).push(o):i.$o.set(s,[o]),n.snapshot)]}})})}function Ef(f,p,d){return y(this,void 0,void 0,function(){var s,a;return g(this,function(t){switch(t.label){case 0:a=Pf(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=a.localStore,u=p,h=i,l=ri.now(),o=u.reduce(function(t,e){return t.add(e.key)},Gs()),h.persistence.runTransaction("Locally write mutations","readwrite",function(a){return h.Kn.bn(a,o).next(function(t){c=t;for(var e,n=[],r=0,i=u;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Ti?e.field(o.field):void 0;null!=(s=Fo(o.transform,s||null))&&(n=(null==n?new Co:n).set(o.field,s))}return n?n.v():null}(e.fieldTransforms,s));null!=s&&n.push(new ls(o.key,s,function s(t){var a=[];return Rr(t.fields||{},function(t,e){var n=new Kr([t]);if(vi(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new Ao(a)}(s.proto.mapValue),ns.exists(!0)))}return h.Tn.addMutationBatch(a,l,n,u)})}).then(function(t){var e=t.applyToLocalDocumentSet(c);return{batchId:t.batchId,changes:e}}))];case 2:return s=t.sent(),a.sharedClientState.addPendingMutation(s.batchId),e=a,n=s.batchId,r=d,i=(i=(i=e.Lo[e.currentUser.toKey()])||new Ns(Nr)).insert(n,r),e.Lo[e.currentUser.toKey()]=i,[4,xf(a,s.changes)];case 3:return t.sent(),[4,Ml(a.remoteStore)];case 4:return t.sent(),[3,6];case 5:return a=Kl(a=t.sent(),"Failed to persist write"),d.reject(a),[3,6];case 6:return[2]}var e,n,r,i,u,c,h,l,o})})}function Tf(o,s){return y(this,void 0,void 0,function(){var n,i;return g(this,function(t){switch(t.label){case 0:n=o,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,u=e,c=(r=s).snapshotVersion,h=u.Bn,u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.Qn.newChangeBuffer({trackRemovals:!0});h=u.Bn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.Ge.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.Ge.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Sr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.Ge.updateTargetData(s,n))))});var e,n=Fs;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(nh(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Do.min())||(e=u.Ge.getLastRemoteSnapshotVersion(s).next(function(t){return u.Ge.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),tu.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Kn.vn(s,n)})}).then(function(t){return u.Bn=h,t}))];case 2:return i=t.sent(),s.targetChanges.forEach(function(t,e){(e=n.ko.get(e))&&(Sr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.Co=!0:0<t.modifiedDocuments.size?Sr(e.Co):0<t.removedDocuments.size&&(Sr(e.Co),e.Co=!1))}),[4,xf(n,i,s)];case 3:return t.sent(),[3,6];case 4:return[4,pc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,u,c,h})})}function If(t,n,e){var r;((t=t).isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.No.forEach(function(t,e){(e=e.view.eo(n)).snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].eo(i)&&(o=!0)}),o&&ef(t)}(t.eventManager,n),r.length&&t.xo.Tr(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function _f(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Rl((n=o).remoteStore)||wr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Tn.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Bo.get(r)||[]).push(s),n.Bo.set(r,i),[3,4]);case 3:return i=Kl(i=t.sent(),"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Sf(t,e){(t.Bo.get(e)||[]).forEach(function(t){t.resolve()}),t.Bo.delete(e)}function Df(t,e,n){var r=t,i=r.Lo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i)}function Af(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.$o.get(t);r<i.length;r++){var o=i[r];e.No.delete(o),n&&e.xo.Ko(o,n)}e.$o.delete(t),e.isPrimaryClient&&e.Mo.os(t).forEach(function(t){e.Mo.containsKey(t)||Nf(e,t)})}function Nf(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(Al(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),kf(t))}function Cf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof ff?(t.Mo.addReference(u.key,e),r=t,o=void 0,i=(o=u.key).path.canonicalString(),r.Oo.get(o)||r.Fo.has(i)||(wr("SyncEngine","New document in limbo: "+o),r.Fo.add(i),kf(r))):u instanceof pf?(wr("SyncEngine","Document no longer in limbo: "+u.key),t.Mo.removeReference(u.key,e),t.Mo.containsKey(u.key)||Nf(t,u.key)):_r()}}function kf(t){for(;0<t.Fo.size&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new zr(jr.fromString(e)),e=t.qo.next();t.ko.set(e,new gf(n)),t.Oo=t.Oo.insert(n,e),Dl(t.remoteStore,new Iu(bo(lo(n.path)),e,2,gr.o))}}function xf(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).No.isEmpty()?[3,3]:(n.No.forEach(function(t,e){o.push(n.Qo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Qc.Nn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.xo.Tr(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return tu.forEach(c,function(e){return tu.forEach(e.Cn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return tu.forEach(e.xn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!lu(e=t.sent()))throw e;return wr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Bn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Bn=r.Bn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Rf(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l,f;return g(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],a=void 0,(u=e.$o.get(s))&&0!==u.length?[4,rh(e.localStore,bo(u[0]))]:[3,7]):[3,13];case 2:a=t.sent(),c=0,h=u,t.label=3;case 3:return c<h.length?(l=h[c],l=e.No.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,oh((e=r).localStore,i.query,!0)];case 1:return n=t.sent(),n=i.view.So(n),[2,(e.isPrimaryClient&&Cf(e,i.targetId,n.Po),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,sh(e.localStore,s)];case 8:return f=t.sent(),[4,rh(e.localStore,f)];case 9:return a=t.sent(),[4,wf(e,Lf(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(a),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.xo.Tr(r),n)]}})})}function Lf(t){return ho(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Of(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Tf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.ko.get(e))&&t.Co)return Gs().add(t.key);var r=Gs();if(!(e=n.$o.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.No.get(s),r=r.unionWith(s.view.To);return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.ko.get(s),(n=i&&i.key)?(r=(r=new Ns(zr.comparator)).insert(n,new Ii(n,Do.min())),i=Gs().add(n),i=new zs(Do.min(),new Map,new Ps(Nr),r,i),[4,Tf(e,i)]):[3,2];case 1:return t.sent(),e.Oo=e.Oo.remove(n),e.ko.delete(s),kf(e),[3,4];case 2:return[4,ih(e.localStore,s,!1).then(function(){return Af(e,s,a)}).catch(pc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.xo.Tr=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query;if(a=n.queries.get(a)){for(var u=0,c=a.listeners;u<c.length;u++)c[u].no(s)&&(r=!0);a.Xr=s}}r&&ef(n)}.bind(null,t.eventManager),t.xo.Ko=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function Pf(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:n=o,r=s.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,h=s,(l=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r,e=h.batch.keys(),n=l.Qn.newChangeBuffer({trackRemovals:!0}),i=l,o=t,s=n,a=(r=h).batch,u=a.keys(),c=tu.resolve();return u.forEach(function(n){c=c.next(function(){return s.getEntry(o,n)}).next(function(t){var e=t;Sr(null!==(t=r.docVersions.get(n))),(!e||e.version.compareTo(t)<0)&&(e=a.applyToRemoteDocument(n,e,r))&&s.addEntry(e,r.commitVersion)})}),c.next(function(){return i.Tn.removeMutationBatch(o,a)}).next(function(){return n.apply(t)}).next(function(){return l.Tn.performConsistencyCheck(t)}).next(function(){return l.Kn.bn(t,e)})}))];case 2:return i=t.sent(),Df(n,r,null),Sf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,xf(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,pc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,h,l})})}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Tn.lookupMutationBatch(e,r).next(function(t){return Sr(null!==t),n=t.keys(),i.Tn.removeMutationBatch(e,t)}).next(function(){return i.Tn.performConsistencyCheck(e)}).next(function(){return i.Kn.bn(e,n)})}))];case 2:return o=t.sent(),Df(n,a,u),Sf(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,xf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,pc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,t),t}function Mf(t,e,n){var r=t;(function(f,p,d){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=ca((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.He.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return d._updateProgress(lf(a)),u=new sf(a,f.localStore,p.D),[4,p.Wo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.fo(c)]:[3,10];case 7:return(h=t.sent())&&d._updateProgress(h),[4,p.Wo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,xf(f,l.En,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.He.saveBundleMetadata(t,e)}))];case 13:return t.sent(),d._completeWith(l.progress),[3,15];case 14:return Tr("SyncEngine","Loading bundle failed with "+(l=t.sent())),d._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})})(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Ff,qf,Vf=(Qf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.D=ul(e.databaseInfo.databaseId),this.sharedClientState=this.jo(e),this.persistence=this.Go(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e),[2]}})})},Qf.prototype.zo=function(t){return null},Qf.prototype.Ho=function(t){return Zc(this.persistence,new Hc,t.initialUser,this.D)},Qf.prototype.Go=function(t){return new mh(bh.Cs,this.D)},Qf.prototype.jo=function(t){return new jh},Qf.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Qf),Uf=(n(zf,qf=Vf),zf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,qf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=Lc(t),r=Do.min(),t.qt({index:Ba.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=xu(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Un=t})]})})}(this.localStore)];case 2:return t.sent(),[4,this.Jo.initialize(this,e)];case 3:return t.sent(),[4,Pf(this.Jo.syncEngine)];case 4:return t.sent(),[4,Ml(this.Jo.remoteStore)];case 5:return t.sent(),[2]}})})},zf.prototype.Ho=function(t){return Zc(this.persistence,new Hc,t.initialUser,this.D)},zf.prototype.zo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new gc(e,t.asyncQueue)},zf.prototype.Go=function(t){var e=Gc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Xu.withCacheSize(this.cacheSizeBytes):Xu.DEFAULT;return new Vc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,sl(),al(),this.D,this.sharedClientState,!!this.forceOwnership)},zf.prototype.jo=function(t){return new jh},zf),Bf=(n(Kf,Ff=Uf),Kf.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:return[4,Ff.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Jo.syncEngine,this.sharedClientState instanceof Bh?(this.sharedClientState.syncEngine={wi:function(a,u,c,h){return y(this,void 0,void 0,function(){var o,s;return g(this,function(t){switch(t.label){case 0:return[4,(e=(o=a).localStore,n=u,i=(r=e).Tn,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Jt(e,n).next(function(t){return t?r.Kn.bn(e,t):tu.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Ml(o.remoteStore)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Df(o,u,h||null),Sf(o,u),o.localStore.Tn.Xt(u)):_r(),t.label=4;case 4:return[4,xf(o,s)];case 5:return t.sent(),[3,7];case 6:wr("SyncEngine","Cannot apply mutation batch with id: "+u),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),_i:function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return(e=i).Uo?(wr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.$o.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,ah(e.localStore)];case 3:return n=t.sent(),r=zs.createSynthesizedRemoteEventForCurrentChange(o,"current"===s),[4,xf(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,ih(e.localStore,o,!0)];case 6:return t.sent(),Af(e,o,a),[3,8];case 7:_r(),t.label=8;case 8:return[2]}})})}.bind(null,e),mi:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,a,u;return g(this,function(t){switch(t.label){case 0:if(!(n=Of(c)).Uo)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.$o.has(r)?(wr("SyncEngine","Adding an already active target "+r),[3,5]):[4,sh(n.localStore,r)]):[3,6];case 2:return i=t.sent(),[4,rh(n.localStore,i)];case 3:return o=t.sent(),[4,wf(n,Lf(i),o.targetId,!1)];case 4:t.sent(),Dl(n.remoteStore,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return g(this,function(t){switch(t.label){case 0:return n.$o.has(e)?[4,ih(n.localStore,e,!1).then(function(){Al(n.remoteStore,e),Af(n,e)}).catch(pc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,u=l,t.label=7;case 7:return a<u.length?(u=u[a],[5,s(u)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),gn:function(t){return t.localStore.persistence.gn()}.bind(null,e),di:function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,ah((e=n).localStore).then(function(t){return xf(e,t)})]})})}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.en(function(e){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,function(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,a,u,c;return g(this,function(t){switch(t.label){case 0:return Of(r=h),Pf(r),!0!==l||!0===r.Uo?[3,3]:(e=r.sharedClientState.getAllActiveQueryTargets(),[4,Rf(r,e.toArray())]);case 1:return i=t.sent(),r.Uo=!0,[4,Vl(r.remoteStore,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)a=s[o],Dl(r.remoteStore,a);return[3,7];case 3:return!1!==l||!1===r.Uo?[3,7]:(u=[],c=Promise.resolve(),r.$o.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then(function(){return Af(r,e),ih(r.localStore,e,!0)}),Al(r.remoteStore,e)}),[4,c]);case 4:return t.sent(),[4,Rf(r,u)];case 5:return t.sent(),(n=r).ko.forEach(function(t,e){Al(n.remoteStore,e)}),n.Mo.cs(),n.ko=new Map,n.Oo=new Ns(zr.comparator),r.Uo=!1,[4,Vl(r.remoteStore,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.Jo.syncEngine,e)];case 1:return t.sent(),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Kf.prototype.jo=function(t){var e=sl();if(!Bh.At(e))throw new Br(Ur.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Gc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Bh(e,t.asyncQueue,n,t.clientId,t.initialUser)},Kf),jf=(Gf.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return If(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=function(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(wr("SyncEngine","User change. New user:",o.toKey()),[4,th(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Bo.forEach(function(t){t.forEach(function(t){t.reject(new Br(Ur.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,xf(n,r.Wn)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}.bind(null,this.syncEngine),[4,Vl(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gf.prototype.createEventManager=function(t){return new zl},Gf.prototype.createDatastore=function(t){var e=ul(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new Hh(n));return t=t.credentials,new gl(t,n,e)},Gf.prototype.createRemoteStore=function(t){var e=this;return new cl(this.localStore,this.datastore,t.asyncQueue,function(t){return If(e.syncEngine,t,0)},t=new(Kh.At()?Kh:Gh))},Gf.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,t=t.maxConcurrentLimboResolutions,e=e,t=new mf(n,r,i,o,s,t),e&&(t.Uo=!0),t;var n,r,i,o,s},Gf.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,wr("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,Sl(e)];case 1:return t.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}})})}(this.remoteStore)},Gf);function Gf(){}function Kf(t,e){var n=this;return(n=Ff.call(this,t,e,!1)||this).Jo=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function zf(t,e,n){var r=this;return(r=qf.call(this)||this).Jo=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function Qf(){this.synchronizeTabs=!1}function Hf(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Wf=(rp.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},rp.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},rp.prototype.Xo=function(){this.muted=!0},rp.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},rp),Yf=(np.prototype.close=function(){return this.Zo.cancel()},np.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},np.prototype.Wo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.ec())]}})})},np.prototype.ec=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.nc()];case 1:return null===(e=t.sent())?[2,null]:(r=this.tc.decode(e),n=Number(r),isNaN(n)&&this.sc("length string ("+r+") is not valid number"),[4,this.ic(n)]);case 2:return r=t.sent(),[2,new rf(JSON.parse(r),e.length+n)]}})})},np.prototype.rc=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},np.prototype.nc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.rc()<0?[4,this.oc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.rc())<0&&this.sc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},np.prototype.ic=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.oc()]:[3,3];case 1:t.sent()&&this.sc("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.tc.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},np.prototype.sc=function(t){throw this.Zo.cancel(),new Error("Invalid bundle format: "+t)},np.prototype.oc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Zo.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},np),Xf=(ep.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Br(Ur.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var r,e,n,i,o;return g(this,function(t){switch(t.label){case 0:return e=ga((r=s).D)+"/documents",n={documents:a.map(function(t){return fa(r.D,t)})},[4,r.Ui("BatchGetDocuments",e,n)];case 1:return n=t.sent(),i=new Map,n.forEach(function(t){var e,n,t=(n=r.D,"found"in t?function(t,e){Sr(!!e.found),e.found.name,e.found.updateTime;var n=pa(t,e.found.name),t=ca(e.found.updateTime),e=new No({mapValue:{fields:e.found.fields}});return new Ti(n,t,e,{})}(n,t):"missing"in t?(e=n,Sr(!!(n=t).missing),Sr(!!n.readTime),e=pa(e,n.missing),n=ca(n.readTime),new Ii(e,n)):_r());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){Sr(!!(t=i.get(t.toString()))),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Ii||t instanceof Ti?n.recordVersion(t):_r()}),e)]}})})},ep.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},ep.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},ep.prototype.delete=function(t){this.write(new Ts(t,this.precondition(t))),this.writtenDocs.add(t.toString())},ep.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=zr.fromPath(e),n.mutations.push(new Is(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=ga((e=i).D)+"/documents",r={writes:o.map(function(t){return wa(e.D,t)})},[4,e.Mi("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},ep.prototype.recordVersion=function(t){var e;if(t instanceof Ti)e=t.version;else{if(!(t instanceof Ii))throw _r();e=Do.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Br(Ur.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},ep.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ns.updateTime(e):ns.none()},ep.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return ns.exists(!0);if(e.isEqual(Do.min()))throw new Br(Ur.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ns.updateTime(e)},ep.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},ep.prototype.ensureCommitNotCalled=function(){},ep),Jf=(tp.prototype.run=function(){this.ac()},tp.prototype.ac=function(){var t=this;this.rr.Yi(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new Xf(this.datastore),(n=this.uc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.hc(t)})})}).catch(function(t){r.hc(t)}),[2]})})})},tp.prototype.uc=function(t){try{var e=this.updateFunction(t);return!Or(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},tp.prototype.hc=function(t){var e=this;0<this.cc&&this.lc(t)?(--this.cc,this.asyncQueue.enqueueAndForget(function(){return e.ac(),Promise.resolve()})):this.deferred.reject(t)},tp.prototype.lc=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Ds(t))},tp),$f=(Zf.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},Zf.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},Zf.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")},Zf.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Za;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=Kl(t.sent(),"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Zf);function Zf(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=wh.UNAUTHENTICATED,this.clientId=Dr.u(),this.credentialListener=function(){},this.receivedInitialUser=new Za,this.credentials.setChangeListener(function(t){wr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}function tp(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new pl(this.asyncQueue,"transaction_retry")}function ep(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function np(t,e){var n=this;this.Zo=t,this.D=e,this.metadata=new Za,this.buffer=new Uint8Array,this.tc=new TextDecoder("utf-8"),this.ec().then(function(t){t&&t.ho()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function rp(t){this.observer=t,this.muted=!1}function ip(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),wr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){n.isEqual(e)||(n=e,i.asyncQueue.enqueueRetryable(function(){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,th(o.localStore,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}function op(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,sp(r)];case 1:return e=t.sent(),wr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),wr("RemoteStore","RemoteStore received new credentials"),n=Rl(e),e.Qr.add(3),[4,Sl(e)];case 1:return t.sent(),n&&e.jr.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Qr.delete(3),[4,_l(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)})}),r.onlineComponents=i,[2]}})})}function sp(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(wr("FirestoreClient","Using default OfflineComponentProvider"),[4,ip(e,new Vf)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function ap(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(wr("FirestoreClient","Using default OnlineComponentProvider"),[4,op(e,new jf)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function up(t){return sp(t).then(function(t){return t.persistence})}function cp(t){return sp(t).then(function(t){return t.localStore})}function hp(t){return ap(t).then(function(t){return t.remoteStore})}function lp(t){return ap(t).then(function(t){return t.syncEngine})}function fp(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,ap(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=function(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Of(s),(o=e.No.get(a))?(n=o.targetId,e.sharedClientState.addLocalQueryTarget(n),r=o.view.Do(),[3,4]):[3,1];case 1:return[4,rh(e.localStore,bo(a))];case 2:return i=t.sent(),o=e.sharedClientState.addLocalQueryTarget(i.targetId),n=i.targetId,[4,wf(e,a,n,"current"===o)];case 3:r=t.sent(),e.isPrimaryClient&&Dl(e.remoteStore,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).No.get(o),1<(r=e.$o.get(n.targetId)).length?[2,(e.$o.set(n.targetId,r.filter(function(t){return!Eo(t,o)})),void e.No.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,ih(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Al(e.remoteStore,n.targetId),Af(e,n.targetId)}).catch(pc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Af(e,n.targetId),[4,ih(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function pp(n,r,i){var t=this;void 0===i&&(i={});var o=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Wf({next:function(t){r.enqueueAndForget(function(){return tf(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Br(Ur.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Br(Ur.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new nf(lo(i.path),t,{includeMetadataChanges:!0,uo:!0});return Zl(n,a)},[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function dp(n,r,i){var t=this;void 0===i&&(i={});var o=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Wf({next:function(t){n.enqueueAndForget(function(){return tf(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Br(Ur.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new nf(t,o,{includeMetadataChanges:!0,uo:!0});return Zl(e,s)},[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function yp(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var gp=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},mp=(Object.defineProperty(Ap.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Ap.prototype.isEqual=function(t){return t instanceof Ap&&t.projectId===this.projectId&&t.database===this.database},Ap),vp=new Map,bp=(Dp.prototype.getToken=function(){return Promise.resolve(null)},Dp.prototype.invalidateToken=function(){},Dp.prototype.setChangeListener=function(t){(this.changeListener=t)(wh.UNAUTHENTICATED)},Dp.prototype.removeChangeListener=function(){this.changeListener=null},Dp),wp=(Sp.prototype.getToken=function(){var e=this,n=this.dc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.dc!==n?(wr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Sr("string"==typeof t.accessToken),new yp(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Sp.prototype.invalidateToken=function(){this.forceRefresh=!0},Sp.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},Sp.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},Sp.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return Sr(null===t||"string"==typeof t),new wh(t)},Sp),Ep=(Object.defineProperty(_p.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),_p),Tp=(Ip.prototype.getToken=function(){return Promise.resolve(new Ep(this._c,this.mc))},Ip.prototype.setChangeListener=function(t){t(wh.FIRST_PARTY)},Ip.prototype.removeChangeListener=function(){},Ip.prototype.invalidateToken=function(){},Ip);function Ip(t,e){this._c=t,this.mc=e}function _p(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=wh.FIRST_PARTY}function Sp(t){var e=this;this.fc=null,this.currentUser=wh.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then(function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)},function(){}))}function Dp(){this.changeListener=null}function Ap(t,e){this.projectId=t,this.database=e||"(default)"}function Np(t,e,n){if(!n)throw new Br(Ur.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Cp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Br(Ur.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function kp(t,e,n,r){if(!0===e&&!0===r)throw new Br(Ur.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function xp(t){if(!zr.isDocumentKey(t))throw new Br(Ur.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Rp(t){if(zr.isDocumentKey(t))throw new Br(Ur.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Lp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":_r();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Op(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Br(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=Lp(t),new Br(Ur.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Pp(t,e){if(e<=0)throw new Br(Ur.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Mp,Fp=(Hp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Hp),qp=(Object.defineProperty(Qp.prototype,"app",{get:function(){if(!this._app)throw new Br(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(Qp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(Qp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),Qp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Br(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fp(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new bp;switch(t.type){case"gapi":var e=t.client;return Sr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Tp(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Br(Ur.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Qp.prototype._getSettings=function(){return this._settings},Qp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},Qp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},Qp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},Qp.prototype._terminate=function(){return(t=vp.get(this))&&(wr("ComponentProvider","Removing Datastore"),vp.delete(this),t.terminate()),Promise.resolve();var t},Qp),Vp=function(t){this._delegate=t},Up=(Object.defineProperty(zp.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(zp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(zp.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(zp.prototype,"parent",{get:function(){return new jp(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),zp.prototype.withConverter=function(t){return new zp(this.firestore,t,this._key)},zp),Bp=(Kp.prototype.withConverter=function(t){return new Kp(this.firestore,t,this._query)},Kp),jp=(n(Gp,Mp=Bp),Object.defineProperty(Gp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Gp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Gp.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Up(this.firestore,null,new zr(t))},enumerable:!1,configurable:!0}),Gp.prototype.withConverter=function(t){return new Gp(this.firestore,t,this._path)},Gp);function Gp(t,e,n){var r=this;return(r=Mp.call(this,t,e,lo(n))||this).firestore=t,r._path=n,r.type="collection",r}function Kp(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}function zp(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}function Qp(t,e){this._persistenceKey="(lite)",this._settings=new Fp({}),this._settingsFrozen=!1,t instanceof mp?(this._databaseId=t,this._credentials=new bp):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Br(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mp(t.options.projectId)}(t),this._credentials=new wp(e))}function Hp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Br(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Br(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,kp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Wp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Vp&&(t=t._delegate),Np("collection","path",e),t instanceof qp)return Rp(n=jr.fromString.apply(jr,s([e],r))),new jp(t,null,n);if(!(t instanceof Up||t instanceof jp))throw new Br(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Rp(n=jr.fromString.apply(jr,s([t.path],r)).child(jr.fromString(e))),new jp(t.firestore,null,n)}function Yp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Vp&&(t=t._delegate),Np("doc","path",e=1===arguments.length?Dr.u():e),t instanceof qp)return xp(n=jr.fromString.apply(jr,s([e],r))),new Up(t,null,new zr(n));if(!(t instanceof Up||t instanceof jp))throw new Br(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xp(n=t._path.child(jr.fromString.apply(jr,s([e],r)))),new Up(t.firestore,t instanceof jp?t._converter:null,new zr(n))}function Xp(t,e){return t instanceof Vp&&(t=t._delegate),e instanceof Vp&&(e=e._delegate),(t instanceof Up||t instanceof jp)&&(e instanceof Up||e instanceof jp)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Jp(t,e){return t instanceof Vp&&(t=t._delegate),e instanceof Vp&&(e=e._delegate),t instanceof Bp&&e instanceof Bp&&t.firestore===e.firestore&&Eo(t._query,e._query)&&t._converter===e._converter}var $p=(Object.defineProperty(Zp.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),Zp.prototype.enqueueAndForget=function(t){this.enqueue(t)},Zp.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},Zp.prototype.enterRestrictedMode=function(){var t;this.Ec||(this.Ec=!0,(t=al())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc))},Zp.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise(function(t){}):this.Pc(t)},Zp.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.gc.push(t),e.Vc()})},Zp.prototype.Vc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.gc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return t.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!lu(e=t.sent()))throw e;return wr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.gc.length&&this.rr.Yi(function(){return n.Vc()}),t.label=5;case 5:return[2]}})})},Zp.prototype.Pc=function(t){var r=this,e=this.yc.then(function(){return r.Ac=!0,t().catch(function(t){throw r.Ic=t,r.Ac=!1,Er("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.Ac=!1,t})});return this.yc=e},Zp.prototype.enqueueAfterDelay=function(t,e,n){var r=this;return this.vc(),-1<this.Rc.indexOf(t)&&(e=0),n=jl.createAndSchedule(this,t,e,n,function(t){return r.Sc(t)}),this.Tc.push(n),n},Zp.prototype.vc=function(){this.Ic&&_r()},Zp.prototype.verifyOperationInProgress=function(){},Zp.prototype.Dc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.yc];case 1:t.sent(),t.label=2;case 2:if(e!==this.yc)return[3,0];t.label=3;case 3:return[2]}})})},Zp.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Zp.prototype.xc=function(r){var i=this;return this.Dc().then(function(){i.Tc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.Tc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Dc()})},Zp.prototype.Nc=function(t){this.Rc.push(t)},Zp.prototype.Sc=function(t){t=this.Tc.indexOf(t),this.Tc.splice(t,1)},Zp);function Zp(){var e=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new pl(this,"async_queue_retry"),this.bc=function(){var t=al();t&&wr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.rr.Zi()};var t=al();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bc)}function td(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var ed,nd=(od.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},od.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},od.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},od.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},od.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},od.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},od),rd=(n(id,ed=qp),id.prototype._terminate=function(){return this._firestoreClient||ad(this),this._firestoreClient.terminate()},id);function id(t,e){var n=this;return(n=ed.call(this,t,e)||this)._queue=new $p,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function od(){this._progressObserver={},this._taskCompletionResolver=new Za,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function sd(t){return t._firestoreClient||ad(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ad(t){var e,n,r=t._freezeSettings(),r=(e=t._databaseId,n=t._persistenceKey,new gp(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new $f(t._credentials,t._queue,r)}function ud(n,r,i){var t=this,o=new Za;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,ip(n,i)];case 1:return t.sent(),[4,op(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function cd(t){if(t._initialized||t._terminated)throw new Br(Ur.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var hd=(Ed.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Ed),ld=(wd.fromBase64String=function(t){try{return new wd(Qr.fromBase64String(t))}catch(t){throw new Br(Ur.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},wd.fromUint8Array=function(t){return new wd(Qr.fromUint8Array(t))},wd.prototype.toBase64=function(){return this._byteString.toBase64()},wd.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},wd.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},wd.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},wd),fd=function(t){this._methodName=t},pd=(Object.defineProperty(bd.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(bd.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),bd.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},bd.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},bd.prototype._compareTo=function(t){return Nr(this._lat,t._lat)||Nr(this._long,t._long)},bd),dd=/^__.*__$/,yd=(vd.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ls(t,this.data,this.fieldMask,e,this.fieldTransforms):new hs(t,this.data,e,this.fieldTransforms)},vd),gd=(md.prototype.toMutation=function(t,e){return new ls(t,this.data,this.fieldMask,e,this.fieldTransforms)},md);function md(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function vd(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function bd(t,e){if(!isFinite(t)||t<-90||90<t)throw new Br(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Br(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function wd(t){this._byteString=t}function Ed(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kr(t)}function Td(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw _r()}}var Id=(Object.defineProperty(Dd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),Dd.prototype.Oc=function(t){return new Dd(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Dd.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.Oc({path:e,Mc:!1})).Lc(t),e},Dd.prototype.Bc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t);return(t=this.Oc({path:t,Mc:!1})).$c(),t},Dd.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},Dd.prototype.Uc=function(t){return ey(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},Dd.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},Dd.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},Dd.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(Td(this.Fc)&&dd.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},Dd),_d=(Sd.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new Id({Fc:t,methodName:e,Kc:n,path:Kr.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},Sd);function Sd(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||ul(t)}function Dd(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function Ad(t){var e=t._freezeSettings(),n=ul(t._databaseId);return new _d(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Nd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);Jd("Data must be an object, but it was:",s,r);var a,u,r=Yd(r,s);if(o.merge)a=new Ao(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=$d(e,l[h],n);if(!s.contains(f))throw new Br(Ur.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");ny(c,f)||c.push(f)}a=new Ao(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new yd(new No(r),a,u)}var Cd,kd=(n(xd,Cd=fd),xd.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},xd.prototype.isEqual=function(t){return t instanceof xd},xd);function xd(){return null!==Cd&&Cd.apply(this,arguments)||this}function Rd(t,e,n){return new Id({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var Ld,Od,Pd,Md,Fd=(n(Kd,Md=fd),Kd.prototype._toFieldTransform=function(t){return new es(t.path,new Uo)},Kd.prototype.isEqual=function(t){return t instanceof Kd},Kd),qd=(n(Gd,Pd=fd),Gd.prototype._toFieldTransform=function(t){var e=Rd(this,t,!0),n=this.jc.map(function(t){return Wd(t,e)}),n=new Bo(n);return new es(t.path,n)},Gd.prototype.isEqual=function(t){return this===t},Gd),Vd=(n(jd,Od=fd),jd.prototype._toFieldTransform=function(t){var e=Rd(this,t,!0),n=this.jc.map(function(t){return Wd(t,e)}),n=new Qo(n);return new es(t.path,n)},jd.prototype.isEqual=function(t){return this===t},jd),Ud=(n(Bd,Ld=fd),Bd.prototype._toFieldTransform=function(t){var e=new Xo(t.D,Mo(t.D,this.Gc));return new es(t.path,e)},Bd.prototype.isEqual=function(t){return this===t},Bd);function Bd(t,e){var n=this;return(n=Ld.call(this,t)||this).Gc=e,n}function jd(t,e){var n=this;return(n=Od.call(this,t)||this).jc=e,n}function Gd(t,e){var n=this;return(n=Pd.call(this,t)||this).jc=e,n}function Kd(){return null!==Md&&Md.apply(this,arguments)||this}function zd(t,r,i,e){var o=t.Wc(1,r,i);Jd("Data must be an object, but it was:",o,e);var s=[],a=new Co;return Rr(e,function(t,e){var n=ty(r,t,i);e instanceof Vp&&(e=e._delegate),t=o.Bc(n),e instanceof kd?s.push(n):null!=(t=Wd(e,t))&&(s.push(n),a.set(n,t))}),e=new Ao(s),new gd(a.v(),e,o.fieldTransforms)}function Qd(t,e,n,r,i,o){var s=t.Wc(1,e,n),a=[$d(e,r,n)],u=[i];if(o.length%2!=0)throw new Br(Ur.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push($d(e,o[c])),u.push(o[c+1]);for(var h,l,f,p=[],d=new Co,y=a.length-1;0<=y;--y)ny(p,a[y])||(h=a[y],(l=u[y])instanceof Vp&&(l=l._delegate),f=s.Bc(h),l instanceof kd?p.push(h):null!=(f=Wd(l,f))&&(p.push(h),d.set(h,f)));return i=new Ao(p),new gd(d.v(),i,s.fieldTransforms)}function Hd(t,e,n,r){return void 0===r&&(r=!1),Wd(n,t.Wc(r?4:3,e))}function Wd(s,t){if(Xd(s=s instanceof Vp?s._delegate:s))return Jd("Unsupported field value:",t,s),Yd(s,t);if(s instanceof fd)return function(t,e){if(!Td(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Mc&&4!==t.Fc)throw t.Uc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Wd(i[r],t.qc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=t instanceof Vp?t._delegate:t))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Mo(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ri.fromDate(t);return{timestampValue:aa(e.D,n)}}if(t instanceof ri)return n=new ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:aa(e.D,n)};if(t instanceof pd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ld)return{bytesValue:ua(e.D,t._byteString)};if(t instanceof Up){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ha(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+Lp(t))}(s,t)}function Yd(t,n){var r={};return Lr(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Rr(t,function(t,e){null!=(e=Wd(e,n.kc(t)))&&(r[t]=e)}),{mapValue:{fields:r}}}function Xd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ri||t instanceof pd||t instanceof ld||t instanceof Up||t instanceof fd)}function Jd(t,e,n){if(!Xd(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=Lp(n))?e.Uc(t+" a custom object"):e.Uc(t+" "+n);var r}function $d(t,e,n){if((e=e instanceof Vp?e._delegate:e)instanceof hd)return e._internalPath;if("string"==typeof e)return ty(t,e);throw ey("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Zd=new RegExp("[~\\*/\\[\\]]");function ty(e,n,r){if(0<=n.search(Zd))throw ey("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(hd.bind.apply(hd,s([void 0],n.split(".")))))._internalPath}catch(t){throw ey("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function ey(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";return n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Br(Ur.INVALID_ARGUMENT,(e+=". ")+t+n)}function ny(t,e){return t.some(function(t){return t.isEqual(e)})}var ry,iy=(Object.defineProperty(ay.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(ay.prototype,"ref",{get:function(){return new Up(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),ay.prototype.exists=function(){return null!==this._document},ay.prototype.data=function(){if(this._document){if(this._converter){var t=new oy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},ay.prototype.get=function(t){if(this._document&&null!==(t=this._document.data().field(uy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t)},ay),oy=(n(sy,ry=iy),sy.prototype.data=function(){return ry.prototype.data.call(this)},sy);function sy(){return null!==ry&&ry.apply(this,arguments)||this}function ay(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function uy(t,e){return"string"==typeof e?ty(t,e):(e instanceof Vp?e._delegate:e)._internalPath}var cy,hy,ly=(vy.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},vy),fy=(n(my,hy=iy),my.prototype.exists=function(){return hy.prototype.exists.call(this)},my.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new py(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},my.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document&&null!==(t=this._document.data().field(uy("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t,e.serverTimestamps)},my),py=(n(gy,cy=fy),gy.prototype.data=function(t){return void 0===t&&(t={}),cy.prototype.data.call(this,t)},gy),dy=(Object.defineProperty(yy.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),yy.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new py(r._firestore,r._userDataWriter,t.key,t,new ly(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query._converter))})},yy.prototype.docChanges=function(t){if((t=!!(t=void 0===t?{}:t).includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Br(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new py(i._firestore,i._userDataWriter,t.doc.key,t.doc,new ly(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new py(i._firestore,i._userDataWriter,t.doc.key,t.doc,new ly(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _r()}}(),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},yy);function yy(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new ly(r.hasPendingWrites,r.fromCache),this.query=n}function gy(){return null!==cy&&cy.apply(this,arguments)||this}function my(t,e,n,r,i,o){var s=this;return(s=hy.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function vy(t,e){this.hasPendingWrites=t,this.fromCache=e}function by(t,e){return t instanceof fy&&e instanceof fy?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof dy&&e instanceof dy&&t._firestore===e._firestore&&Jp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function wy(t){if(po(t)&&0===t.explicitOrderBy.length)throw new Br(Ur.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Ey(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Ty,Iy,_y,Sy,Dy,Ay=(n(My,Dy=c=function(){}),My.prototype._apply=function(t){var e=Ad(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Br(Ur.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Vy(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(qy(n,t,c))}h={arrayValue:{values:s}}}else h=qy(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Vy(o,i),h=Hd(e,"where",o,"in"===i||"not-in"===i);var h=Oi.create(r,i,h);return function(t,e){if(e.g()){var n=go(t);if(null!==n&&!n.isEqual(e.field))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=yo(t))&&Uy(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new Br(Ur.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Br(Ur.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Bp(t.firestore,t._converter,(e=(t=t._query).filters.concat([e]),new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},My),Ny=(n(Py,Sy=c),Py.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new so(e,n);return e=r,null!==yo(n=t)||null!==(t=go(n))&&Uy(0,t,e.field),r}(t._query,this.zc,this.Yc);return new Bp(t.firestore,t._converter,(e=(t=t._query).explicitOrderBy.concat([e]),new co(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},Py),Cy=(n(Oy,_y=c),Oy.prototype._apply=function(t){return new Bp(t.firestore,t._converter,wo(t._query,this.Xc,this.Zc))},Oy),ky=(n(Ly,Iy=c),Ly.prototype._apply=function(t){var e=Fy(t,this.type,this.ta,this.ea);return new Bp(t.firestore,t._converter,(t=t._query,new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Ly),xy=(n(Ry,Ty=c),Ry.prototype._apply=function(t){var e=Fy(t,this.type,this.ta,this.ea);return new Bp(t.firestore,t._converter,(t=t._query,new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Ry);function Ry(t,e,n){var r=this;return(r=Ty.call(this)||this).type=t,r.ta=e,r.ea=n,r}function Ly(t,e,n){var r=this;return(r=Iy.call(this)||this).type=t,r.ta=e,r.ea=n,r}function Oy(t,e,n){var r=this;return(r=_y.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function Py(t,e){var n=this;return(n=Sy.call(this)||this).zc=t,n.Yc=e,n.type="orderBy",n}function My(t,e,n){var r=this;return(r=Dy.call(this)||this).zc=t,r.Hc=e,r.Jc=n,r.type="where",r}function Fy(t,c,e,n){if(e[0]instanceof Vp&&(e[0]=e[0]._delegate),e[0]instanceof iy)return function(t,e,n,r){if(!n)throw new Br(Ur.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=vo(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(pi(e,n.key));else{var u=n.field(a.field);if(oi(u))throw new Br(Ur.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u)throw a=a.field.canonicalString(),new Br(Ur.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.");i.push(u)}}return new to(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=Ad(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Br(Ur.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!mo(t)&&-1!==c.indexOf("/"))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(jr.fromString(c));if(!zr.isDocumentKey(h))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new zr(h),a.push(pi(e,h))}else c=Hd(n,r,c),a.push(c)}return new to(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function qy(t,e,n){if("string"==typeof(n=n instanceof Vp?n._delegate:n)){if(""===n)throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!mo(e)&&-1!==n.indexOf("/"))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(jr.fromString(n)),!zr.isDocumentKey(e))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return pi(t,new zr(e))}if(n instanceof Up)return pi(t,n._key);throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Lp(n)+".")}function Vy(t,e){if(!Array.isArray(t)||0===t.length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Uy(t,e,n){if(!n.isEqual(e))throw new Br(Ur.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function By(){}function jy(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}By.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ai(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ei(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ni(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _r()}},By.prototype.convertObject=function(t,n){var r=this,i={};return Rr(t.fields||{},function(t,e){i[t]=r.convertValue(e,n)}),i},By.prototype.convertGeoPoint=function(t){return new pd(ei(t.latitude),ei(t.longitude))},By.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},By.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){return oi(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(si(t));default:return null}},By.prototype.convertTimestamp=function(t){return t=ti(t),new ri(t.seconds,t.nanos)},By.prototype.convertDocumentKey=function(t,e){var n=jr.fromString(t);return Sr(Ca(n)),t=new mp(n.get(1),n.get(3)),n=new zr(n.popFirst(5)),t.isEqual(e)||Er("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n};var Gy,Ky=(n(Hy,Gy=me=By),Hy.prototype.convertBytes=function(t){return new ld(t)},Hy.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new Up(this.firestore,null,t)},Hy),zy=(Qy.prototype.set=function(t,e,n){return this._verifyNotCommitted(),e=jy((t=Wy(t,this._firestore))._converter,e,n),n=Nd(this._dataReader,"WriteBatch.set",t._key,e,null!==t._converter,n),this._mutations.push(n.toMutation(t._key,ns.none())),this},Qy.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),t=Wy(t,this._firestore),e="string"==typeof(e=e instanceof Vp?e._delegate:e)||e instanceof hd?Qd(this._dataReader,"WriteBatch.update",t._key,e,n,r):zd(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(e.toMutation(t._key,ns.exists(!0))),this},Qy.prototype.delete=function(t){return this._verifyNotCommitted(),t=Wy(t,this._firestore),this._mutations=this._mutations.concat(new Ts(t._key,ns.none())),this},Qy.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Qy.prototype._verifyNotCommitted=function(){if(this._committed)throw new Br(Ur.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Qy);function Qy(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ad(t)}function Hy(t){var e=this;return(e=Gy.call(this)||this).firestore=t,e}function Wy(t,e){if((t=t instanceof Vp?t._delegate:t).firestore!==e)throw new Br(Ur.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yy,Xy=(n(Jy,Yy=me),Jy.prototype.convertBytes=function(t){return new ld(t)},Jy.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new Up(this.firestore,null,t)},Jy);function Jy(t){var e=this;return(e=Yy.call(this)||this).firestore=t,e}function $y(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Op(t,Up);var o=Op(t.firestore,rd),s=Ad(o);return tg(o,[("string"==typeof(e=e instanceof Vp?e._delegate:e)||e instanceof hd?Qd(s,"updateDoc",t._key,e,n,r):zd(s,"updateDoc",t._key,e)).toMutation(t._key,ns.exists(!0))])}function Zy(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof Vp&&(e=e._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||td(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return td(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Up?(a=Op(e.firestore,rd),u=lo(e._key.path),h={next:function(t){n[i]&&n[i](eg(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=Op(e,Bp),a=Op(s.firestore,rd),u=s._query,c=new Xy(a),h={next:function(t){n[i]&&n[i](new dy(a,c,s,t))},error:n[i+1],complete:n[i+2]},wy(e._query)),function(n,t,e){var r=this,i=new Wf(h),o=new nf(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Zl,[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=tf,[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(sd(a),u,l)}function tg(t,e){return function(n,r){var t=this,i=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Ef,[4,lp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(sd(t),e)}function eg(t,e,n){var r=n.docs.get(e._key),i=new Xy(t);return new fy(t,i,e._key,r,new ly(n.hasPendingWrites,n.fromCache),e._converter)}var ng,rg=(og.prototype.get=function(t){var e=this,n=Wy(t,this._firestore),r=new Ky(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return _r();if((t=t[0])instanceof Ii)return new iy(e._firestore,r,n._key,null,n._converter);if(t instanceof Ti)return new iy(e._firestore,r,t.key,t,n._converter);throw _r()})},og.prototype.set=function(t,e,n){return e=jy((t=Wy(t,this._firestore))._converter,e,n),n=Nd(this._dataReader,"Transaction.set",t._key,e,null!==t._converter,n),this._transaction.set(t._key,n),this},og.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=Wy(t,this._firestore),e="string"==typeof(e=e instanceof Vp?e._delegate:e)||e instanceof hd?Qd(this._dataReader,"Transaction.update",t._key,e,n,r):zd(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,e),this},og.prototype.delete=function(t){return t=Wy(t,this._firestore),this._transaction.delete(t._key),this},n(ig,ng=og),ig.prototype.get=function(t){var e=this,n=Wy(t,this._firestore),r=new Xy(this._firestore);return ng.prototype.get.call(this,t).then(function(t){return new fy(e._firestore,r,n._key,t._document,new ly(!1,!1),n._converter)})},ig);function ig(t,e){var n=this;return(n=ng.call(this,t,e)||this)._firestore=t,n}function og(t,e){this._firestore=t,this._transaction=e,this._dataReader=Ad(t)}function sg(){if("undefined"==typeof Uint8Array)throw new Br(Ur.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ag(){if("undefined"==typeof atob)throw new Br(Ur.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ug,cg,hg,lg=(n(vg,hg=Vp),vg.fromBase64String=function(t){return ag(),new vg(ld.fromBase64String(t))},vg.fromUint8Array=function(t){return sg(),new vg(ld.fromUint8Array(t))},vg.prototype.toBase64=function(){return ag(),this._delegate.toBase64()},vg.prototype.toUint8Array=function(){return sg(),this._delegate.toUint8Array()},vg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},vg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},vg),fg=(mg.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){cd(t=Op(t,rd));var n=sd(t),r=t._freezeSettings();return ud(n,t=new jf,new Uf(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},mg.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){cd(t=Op(t,rd));var e=sd(t),n=t._freezeSettings();return ud(e,t=new jf,new Bf(t,n.cacheSizeBytes))}(t._delegate)},mg.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n._initialized&&!n._terminated)throw new Br(Ur.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Za;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return nu.At()?(e=n+"main",[4,nu.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Gc(n._databaseId,n._persistenceKey))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},mg),pg=(n(gg,cg=Vp),Object.defineProperty(gg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),gg.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},gg.prototype.useEmulator=function(t,e){var n=this._delegate,r=t;t=e,"firestore.googleapis.com"!==(e=(n=Op(n,qp))._getSettings()).host&&e.host!==r&&Tr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},gg.prototype.enableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,up(r)];case 1:return e=t.sent(),[4,hp(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!0),(t=n).Qr.delete(0),_l(t))]}})})})}(sd(Op(this._delegate,rd)))},gg.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,up(r)];case 1:return e=t.sent(),[4,hp(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(0),[4,Sl(e)];case 1:return t.sent(),e.jr.set("Offline"),[2]}})})}(n))]}})})})}(sd(Op(this._delegate,rd)))},gg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&kp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},gg.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},gg.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},gg.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=_f,[4,lp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(sd(Op(this._delegate,rd)))},gg.prototype.onSnapshotsInSync=function(t){return function(n,t){var e=this,r=new Wf(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.add(e),e.next()},[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.delete(e)},[4,fp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(sd(Op(this._delegate,rd)),td(t)?t:{next:t})},Object.defineProperty(gg.prototype,"app",{get:function(){if(!this.sa)throw new Br(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),gg.prototype.collection=function(t){try{return new zg(this,Wp(this._delegate,t))}catch(t){throw xg(t,"collection()","Firestore.collection()")}},gg.prototype.doc=function(t){try{return new Cg(this,Yp(this._delegate,t))}catch(t){throw xg(t,"doc()","Firestore.doc()")}},gg.prototype.collectionGroup=function(t){try{return new jg(this,function(t,e){if(t=Op(t,qp),Np("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Br(Ur.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Bp(t,null,new co(jr.emptyPath(),e))}(this._delegate,t))}catch(t){throw xg(t,"collectionGroup()","Firestore.collectionGroup()")}},gg.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,ap(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new Jf(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(sd(n=this._delegate),function(t){return t=new rg(n,t),e(new Tg(r,t))})},gg.prototype.batch=function(){var e=this;return sd(this._delegate),new Ig(new zy(this._delegate,function(t){return tg(e._delegate,t)}))},gg.prototype.loadBundle=function(t){throw new Br(Ur.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},gg.prototype.namedQuery=function(t){throw new Br(Ur.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},gg),dg=(n(yg,ug=me),yg.prototype.convertBytes=function(t){return new lg(new ld(t))},yg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),Cg.ia(t,this.firestore,null)},yg);function yg(t){var e=this;return(e=ug.call(this)||this).firestore=t,e}function gg(t,e,n){var r=this;return(r=cg.call(this,e)||this).na=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof mp||(r.sa=t),r}function mg(){}function vg(){return null!==hg&&hg.apply(this,arguments)||this}var bg,wg,Eg,Tg=(n(Ag,Eg=Vp),Ag.prototype.get=function(t){var e=this,n=$g(t);return this._delegate.get(n).then(function(t){return new Ug(e._firestore,new fy(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},Ag.prototype.set=function(t,e,n){return t=$g(t),n?(Cp("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Ag.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=$g(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Ag.prototype.delete=function(t){return t=$g(t),this._delegate.delete(t),this},Ag),Ig=(n(Dg,wg=Vp),Dg.prototype.set=function(t,e,n){return t=$g(t),n?(Cp("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Dg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=$g(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Dg.prototype.delete=function(t){return t=$g(t),this._delegate.delete(t),this},Dg.prototype.commit=function(){return this._delegate.commit()},Dg),_g=(n(Sg,bg=Vp),Sg.prototype.fromFirestore=function(t,e){return t=new py(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null),this._delegate.fromFirestore(new Bg(this._firestore,t),null!=e?e:{})},Sg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},Sg.ra=function(t,e){var n=Sg.oa,r=n.get(t);return r||(r=new WeakMap,n.set(t,r)),(n=r.get(e))||(n=new Sg(t,new dg(t),e),r.set(e,n)),n},Sg);function Sg(t,e,n){var r=this;return(r=bg.call(this,n)||this)._firestore=t,r._userDataWriter=e,r}function Dg(){return null!==wg&&wg.apply(this,arguments)||this}function Ag(t,e){var n=this;return(n=Eg.call(this,e)||this)._firestore=t,n._userDataWriter=new dg(t),n}_g.oa=new WeakMap;var Ng,Cg=(n(kg,Ng=Vp),kg.ca=function(t,e,n){if(t.length%2!=0)throw new Br(Ur.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new kg(e,new Up(e._delegate,n,new zr(t)))},kg.ia=function(t,e,n){return new kg(e,new Up(e._delegate,n,t))},Object.defineProperty(kg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(kg.prototype,"parent",{get:function(){return new zg(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(kg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),kg.prototype.collection=function(t){try{return new zg(this.firestore,Wp(this._delegate,t))}catch(t){throw xg(t,"collection()","DocumentReference.collection()")}},kg.prototype.isEqual=function(t){return(t=t instanceof Vp?t._delegate:t)instanceof Up&&Xp(this._delegate,t)},kg.prototype.set=function(t,e){e=Cp("DocumentReference.set",e);try{return function(t,e,n){t=Op(t,Up);var r=Op(t.firestore,rd),e=jy(t._converter,e,n);return tg(r,[Nd(Ad(r),"setDoc",t._key,e,null!==t._converter,n).toMutation(t._key,ns.none())])}(this._delegate,t,e)}catch(t){throw xg(t,"setDoc()","DocumentReference.set()")}},kg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?$y(this._delegate,t):$y.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw xg(t,"updateDoc()","DocumentReference.update()")}},kg.prototype.delete=function(){return tg(Op((t=this._delegate).firestore,rd),[new Ts(t._key,ns.none())]);var t},kg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Rg(t),i=Lg(t,function(t){return new Ug(e.firestore,new fy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))});return Zy(this._delegate,r,i)},kg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Op(e,Up);var n=Op(e.firestore,rd),t=sd(n),r=new Xy(n);return function(n,r){var t=this,i=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Kn.In(t,e)}))];case 1:return(i=t.sent())instanceof Ti?a.resolve(i):i instanceof Ii?a.resolve(null):a.reject(new Br(Ur.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=Kl(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,cp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new fy(n,r,e._key,t,new ly(t instanceof Ti&&t.hasLocalMutations,!0),e._converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=Op(e,Up);var n=Op(e.firestore,rd);return pp(sd(n),e._key,{source:"server"}).then(function(t){return eg(n,e,t)})}:function(e){e=Op(e,Up);var n=Op(e.firestore,rd);return pp(sd(n),e._key).then(function(t){return eg(n,e,t)})})(this._delegate).then(function(t){return new Ug(e.firestore,new fy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},kg.prototype.withConverter=function(t){return new kg(this.firestore,t?this._delegate.withConverter(_g.ra(this.firestore,t)):this._delegate.withConverter(null))},kg);function kg(t,e){var n=this;return(n=Ng.call(this,e)||this).firestore=t,n._userDataWriter=new dg(t),n}function xg(t,e,n){return t.message=t.message.replace(e,n),t}function Rg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!td(r))return r}return{}}function Lg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=td(t[0])?t[0]:td(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Og,Pg,Mg,Fg,qg,Vg,Ug=(n(Jg,Vg=Vp),Object.defineProperty(Jg.prototype,"ref",{get:function(){return new Cg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Jg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Jg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Jg.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),Jg.prototype.data=function(t){return this._delegate.data(t)},Jg.prototype.get=function(t,e){return this._delegate.get(t,e)},Jg.prototype.isEqual=function(t){return by(this._delegate,t._delegate)},Jg),Bg=(n(Xg,qg=Ug),Xg.prototype.data=function(t){return this._delegate.data(t)},Xg),jg=(n(Yg,Fg=Vp),Yg.prototype.where=function(t,e,n){try{return new Yg(this.firestore,Ey(this._delegate,(r=n,i=e,o=uy("where",t),new Ay(o,i,r))))}catch(t){throw xg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Yg.prototype.orderBy=function(t,e){try{return new Yg(this.firestore,Ey(this._delegate,(n=void 0===e?"asc":e,r=uy("orderBy",t),new Ny(r,n))))}catch(t){throw xg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},Yg.prototype.limit=function(t){try{return new Yg(this.firestore,Ey(this._delegate,(Pp("limit",e=t),new Cy("limit",e,"F"))))}catch(t){throw xg(t,"limit()","Query.limit()")}var e},Yg.prototype.limitToLast=function(t){try{return new Yg(this.firestore,Ey(this._delegate,(Pp("limitToLast",e=t),new Cy("limitToLast",e,"L"))))}catch(t){throw xg(t,"limitToLast()","Query.limitToLast()")}var e},Yg.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Yg(this.firestore,Ey(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ky("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw xg(t,"startAt()","Query.startAt()")}},Yg.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Yg(this.firestore,Ey(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ky("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw xg(t,"startAfter()","Query.startAfter()")}},Yg.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Yg(this.firestore,Ey(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xy("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw xg(t,"endBefore()","Query.endBefore()")}},Yg.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Yg(this.firestore,Ey(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new xy("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw xg(t,"endAt()","Query.endAt()")}},Yg.prototype.isEqual=function(t){return Jp(this._delegate,t._delegate)},Yg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Op(e,Bp);var n=Op(e.firestore,rd),t=sd(n),r=new Xy(n);return function(n,r){var t=this,i=new Za;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,oh(i,o,!0)];case 1:return r=t.sent(),e=new df(o,r.jn),n=e.Io(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=Kl(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,cp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new dy(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=Op(e,Bp);var n=Op(e.firestore,rd),t=sd(n),r=new Xy(n);return dp(t,e._query,{source:"server"}).then(function(t){return new dy(n,r,e,t)})}:function(e){e=Op(e,Bp);var n=Op(e.firestore,rd),t=sd(n),r=new Xy(n);return wy(e._query),dp(t,e._query).then(function(t){return new dy(n,r,e,t)})})(this._delegate).then(function(t){return new Kg(e.firestore,new dy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},Yg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Rg(t),i=Lg(t,function(t){return new Kg(e.firestore,new dy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return Zy(this._delegate,r,i)},Yg.prototype.withConverter=function(t){return new Yg(this.firestore,t?this._delegate.withConverter(_g.ra(this.firestore,t)):this._delegate.withConverter(null))},Yg),Gg=(n(Wg,Mg=Vp),Object.defineProperty(Wg.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"doc",{get:function(){return new Bg(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Wg),Kg=(n(Hg,Pg=Vp),Object.defineProperty(Hg.prototype,"query",{get:function(){return new jg(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new Bg(e._firestore,t)})},enumerable:!1,configurable:!0}),Hg.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Gg(e._firestore,t)})},Hg.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new Bg(r._firestore,t))})},Hg.prototype.isEqual=function(t){return by(this._delegate,t._delegate)},Hg),zg=(n(Qg,Og=jg),Object.defineProperty(Qg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Qg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(Qg.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Cg(this.firestore,t):null},enumerable:!1,configurable:!0}),Qg.prototype.doc=function(t){try{return new Cg(this.firestore,void 0===t?Yp(this._delegate):Yp(this._delegate,t))}catch(t){throw xg(t,"doc()","CollectionReference.doc()")}},Qg.prototype.add=function(t){var e,n=this,r=this._delegate,i=t;return t=Op(r.firestore,rd),e=Yp(r),i=jy(r._converter,i),tg(t,[Nd(Ad(r.firestore),"addDoc",e._key,i,null!==r._converter,{}).toMutation(e._key,ns.exists(!1))]).then(function(){return e}).then(function(t){return new Cg(n.firestore,t)})},Qg.prototype.isEqual=function(t){return Xp(this._delegate,t._delegate)},Qg.prototype.withConverter=function(t){return new Qg(this.firestore,t?this._delegate.withConverter(_g.ra(this.firestore,t)):this._delegate.withConverter(null))},Qg);function Qg(t,e){var n=this;return(n=Og.call(this,t,e)||this).firestore=t,n._delegate=e,n}function Hg(t,e){var n=this;return(n=Pg.call(this,e)||this)._firestore=t,n}function Wg(t,e){var n=this;return(n=Mg.call(this,e)||this)._firestore=t,n}function Yg(t,e){var n=this;return(n=Fg.call(this,e)||this).firestore=t,n._userDataWriter=new dg(t),n}function Xg(){return null!==qg&&qg.apply(this,arguments)||this}function Jg(t,e){var n=this;return(n=Vg.call(this,e)||this)._firestore=t,n}function $g(t){return Op(t=t instanceof Vp?t._delegate:t,Up)}var Zg,tm,c=(n(nm,tm=Vp),nm.documentId=function(){return new nm(Kr.keyField().canonicalString())},nm.prototype.isEqual=function(t){return(t=t instanceof Vp?t._delegate:t)instanceof hd&&this._delegate._internalPath.isEqual(t._internalPath)},nm),me=(n(em,Zg=Vp),em.serverTimestamp=function(){var t=new Fd("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new em(t)},em.delete=function(){var t=new kd("deleteField");return t._methodName="FieldValue.delete",new em(t)},em.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qd("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new em(n)},em.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vd("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new em(n)},em.increment=function(t){return(t=new Ud("increment",t))._methodName="FieldValue.increment",new em(t)},em.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},em);function em(){return null!==Zg&&Zg.apply(this,arguments)||this}function nm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return tm.call(this,new(hd.bind.apply(hd,s([void 0],t))))||this}rm.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},rm.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},rm.prototype.setServiceProps=function(t){return this.serviceProps=t,this},ge=rm;function rm(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}me={Firestore:pg,GeoPoint:pd,Timestamp:ri,Blob:lg,Transaction:Tg,WriteBatch:Ig,DocumentReference:Cg,DocumentSnapshot:Ug,Query:jg,QueryDocumentSnapshot:Bg,QuerySnapshot:Kg,CollectionReference:zg,FieldPath:c,FieldValue:me,setLogLevel:function(t){vr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(e=e.default).INTERNAL.registerComponent(new ge("firestore",function(t){var e=t.getProvider("app").getImmediate();return t=t.getProvider("auth-internal"),new pg(e,new rd(e,t),new fg)},"PUBLIC").setServiceProps(Object.assign({},me))),e.registerVersion("@firebase/firestore","2.2.1"),pg.prototype.loadBundle=function(t){return e=this._delegate,s=t,n=sd(e=Op(e,rd)),t=new nd,function(n,t,r){var e,i=this,o=(e=s,t=ul(t),e=function(t){if(t instanceof Uint8Array)return Hf(t,void 0);if(t instanceof ArrayBuffer)return Hf(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Yf(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Mf,[4,lp(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n},pg.prototype.namedQuery=function(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.He.getNamedQuery(t,e)})},[4,cp(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(sd(n=Op(n,rd)),t).then(function(t){return t?new Bp(n,null,t.query):null}).then(function(t){return t?new jg(e,t):null})}}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});