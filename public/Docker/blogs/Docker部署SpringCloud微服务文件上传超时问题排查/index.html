<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":200,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/config.min.js"></script><meta name="description" content="Docker部署SpringCloud微服务文件上传超时问题排查 问题背景 问题现象 错误日志 1：Tomcat 连接超时 错误日志 2：Nginx 上游连接重置   问题分析 1. 错误类型分析 2. 请求链路分析 3. 根本原因   解决方案 1. Nginx 超时配置调整 2. Spring Boot 服务超时配置 2.1 Gateway 服务配置 2.2 业务服务配置   3. Mu"><meta property="og:type" content="article"><meta property="og:title" content="Docker部署SpringCloud微服务文件上传超时问题排查"><meta property="og:url" content="https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/index.html"><meta property="og:site_name" content="vanishke随笔"><meta property="og:description" content="Docker部署SpringCloud微服务文件上传超时问题排查 问题背景 问题现象 错误日志 1：Tomcat 连接超时 错误日志 2：Nginx 上游连接重置   问题分析 1. 错误类型分析 2. 请求链路分析 3. 根本原因   解决方案 1. Nginx 超时配置调整 2. Spring Boot 服务超时配置 2.1 Gateway 服务配置 2.2 业务服务配置   3. Mu"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2026-01-19T03:46:37.000Z"><meta property="article:modified_time" content="2026-01-19T03:46:37.000Z"><meta property="article:author" content="vanishke"><meta property="article:tag" content="Docker"><meta property="article:tag" content="SpringCloud"><meta property="article:tag" content="Tomcat"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/","path":"Docker/blogs/Docker部署SpringCloud微服务文件上传超时问题排查/","title":"Docker部署SpringCloud微服务文件上传超时问题排查"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Docker部署SpringCloud微服务文件上传超时问题排查 | vanishke随笔</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">vanishke随笔</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">善始者实繁，克终者盖寡</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">108</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">59</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">243</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">Docker部署SpringCloud微服务文件上传超时问题排查</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.1.</span> <span class="nav-text">问题背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.2.</span> <span class="nav-text">问题现象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.1.</span> <span class="nav-text">错误日志 1：Tomcat 连接超时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.2.</span> <span class="nav-text">错误日志 2：Nginx 上游连接重置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.3.</span> <span class="nav-text">问题分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. 错误类型分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 请求链路分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 根本原因</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.4.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. Nginx 超时配置调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. Spring Boot 服务超时配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">2.1 Gateway 服务配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">2.2 业务服务配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. Multipart 配置（已有，确保正确）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.5.</span> <span class="nav-text">配置对比表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.6.</span> <span class="nav-text">验证步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.7.</span> <span class="nav-text">注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.1.</span> <span class="nav-text">1. 超时时间选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.2.</span> <span class="nav-text">2. 超时时间一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.3.</span> <span class="nav-text">3. 临时文件管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.4.</span> <span class="nav-text">4. 性能考虑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.8.</span> <span class="nav-text">最佳实践建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.1.</span> <span class="nav-text">1. 分片上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.2.</span> <span class="nav-text">2. 异步处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.3.</span> <span class="nav-text">3. 监控告警</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.4.</span> <span class="nav-text">4. 配置统一管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.9.</span> <span class="nav-text">问题排查清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.10.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="vanishke" src="/images/avatar.png"><p class="site-author-name" itemprop="name">vanishke</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">243</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">59</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">108</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/vanishke" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vanishke"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:18685129726@163.com" title="E-Mail → mailto:18685129726@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div><div class="links-of-recent-posts motion-element"><div class="links-of-recent-posts-title"><i class="fa fa-history fa-fw"></i> 最近文章</div><ul class="links-of-recent-posts-list"><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" title="Docker&#x2F;blogs&#x2F;Docker日志管理最佳实践&#x2F;">Docker日志管理最佳实践</a></li><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" title="Docker&#x2F;blogs&#x2F;Docker部署SpringCloud微服务文件上传超时问题排查&#x2F;">Docker部署SpringCloud微服务文件上传超时问题排查</a></li><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker%E9%83%A8%E7%BD%B2Redis%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Docker&#x2F;blogs&#x2F;Docker部署Redis超时问题排查与解决方案&#x2F;">Docker部署Redis超时问题排查与解决方案</a></li><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker%E5%AE%B9%E5%99%A8%E4%B8%AD%20Java%20%E9%AA%8C%E8%AF%81%E7%A0%81%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E8%A7%A3%E5%86%B3/" title="Docker&#x2F;blogs&#x2F;Docker容器中 Java 验证码服务部署问题排查与解决&#x2F;">Docker容器中 Java 验证码服务部署问题排查与解决</a></li><li class="links-of-recent-posts-item"><a href="/Docker/blogs/Docker-Swarm%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%AE%9E%E7%8E%B0MySQL%E5%A4%87%E4%BB%BD/" title="Docker&#x2F;blogs&#x2F;Docker-Swarm模式下实现MySQL备份&#x2F;">Docker-Swarm模式下实现MySQL备份</a></li></ul></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/vanishke" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="vanishke"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="vanishke随笔"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Docker部署SpringCloud微服务文件上传超时问题排查 | vanishke随笔"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Docker部署SpringCloud微服务文件上传超时问题排查</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2026-01-19 11:46:37" itemprop="dateCreated datePublished" datetime="2026-01-19T11:46:37+08:00">2026-01-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><a href="#span-idinline-bluedocker%E9%83%A8%E7%BD%B2springcloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5span"><span id="inline-blue">Docker部署SpringCloud微服务文件上传超时问题排查</span></a><ul><li><a href="#span-idinline-blue%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AFspan"><span id="inline-blue">问题背景</span></a></li><li><a href="#span-idinline-blue%E9%97%AE%E9%A2%98%E7%8E%B0%E8%B1%A1span"><span id="inline-blue">问题现象</span></a><ul><li><a href="#span-idinline-blue%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97-1tomcat-%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6span"><span id="inline-blue">错误日志 1：Tomcat 连接超时</span></a></li><li><a href="#span-idinline-blue%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97-2nginx-%E4%B8%8A%E6%B8%B8%E8%BF%9E%E6%8E%A5%E9%87%8D%E7%BD%AEspan"><span id="inline-blue">错误日志 2：Nginx 上游连接重置</span></a></li></ul></li><li><a href="#span-idinline-blue%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90span"><span id="inline-blue">问题分析</span></a><ul><li><a href="#span-idinline-blue1-%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E5%88%86%E6%9E%90span"><span id="inline-blue">1. 错误类型分析</span></a></li><li><a href="#span-idinline-blue2-%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90span"><span id="inline-blue">2. 请求链路分析</span></a></li><li><a href="#span-idinline-blue3-%E6%A0%B9%E6%9C%AC%E5%8E%9F%E5%9B%A0span"><span id="inline-blue">3. 根本原因</span></a></li></ul></li><li><a href="#span-idinline-blue%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88span"><span id="inline-blue">解决方案</span></a><ul><li><a href="#span-idinline-blue1-nginx-%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE%E8%B0%83%E6%95%B4span"><span id="inline-blue">1. Nginx 超时配置调整</span></a></li><li><a href="#span-idinline-blue2-spring-boot-%E6%9C%8D%E5%8A%A1%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AEspan"><span id="inline-blue">2. Spring Boot 服务超时配置</span></a><ul><li><a href="#span-idinline-blue21-gateway-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AEspan"><span id="inline-blue">2.1 Gateway 服务配置</span></a></li><li><a href="#span-idinline-blue22-%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AEspan"><span id="inline-blue">2.2 业务服务配置</span></a></li></ul></li><li><a href="#span-idinline-blue3-multipart-%E9%85%8D%E7%BD%AE%E5%B7%B2%E6%9C%89%E7%A1%AE%E4%BF%9D%E6%AD%A3%E7%A1%AEspan"><span id="inline-blue">3. Multipart 配置（已有，确保正确）</span></a></li></ul></li><li><a href="#span-idinline-blue%E9%85%8D%E7%BD%AE%E5%AF%B9%E6%AF%94%E8%A1%A8span"><span id="inline-blue">配置对比表</span></a></li><li><a href="#span-idinline-blue%E9%AA%8C%E8%AF%81%E6%AD%A5%E9%AA%A4span"><span id="inline-blue">验证步骤</span></a></li><li><a href="#span-idinline-blue%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9span"><span id="inline-blue">注意事项</span></a><ul><li><a href="#span-idinline-blue1-%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E9%80%89%E6%8B%A9span"><span id="inline-blue">1. 超时时间选择</span></a></li><li><a href="#span-idinline-blue2-%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E4%B8%80%E8%87%B4%E6%80%A7span"><span id="inline-blue">2. 超时时间一致性</span></a></li><li><a href="#span-idinline-blue3-%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86span"><span id="inline-blue">3. 临时文件管理</span></a></li><li><a href="#span-idinline-blue4-%E6%80%A7%E8%83%BD%E8%80%83%E8%99%91span"><span id="inline-blue">4. 性能考虑</span></a></li></ul></li><li><a href="#span-idinline-blue%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AEspan"><span id="inline-blue">最佳实践建议</span></a><ul><li><a href="#span-idinline-blue1-%E5%88%86%E7%89%87%E4%B8%8A%E4%BC%A0span"><span id="inline-blue">1. 分片上传</span></a></li><li><a href="#span-idinline-blue2-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86span"><span id="inline-blue">2. 异步处理</span></a></li><li><a href="#span-idinline-blue3-%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6span"><span id="inline-blue">3. 监控告警</span></a></li><li><a href="#span-idinline-blue4-%E9%85%8D%E7%BD%AE%E7%BB%9F%E4%B8%80%E7%AE%A1%E7%90%86span"><span id="inline-blue">4. 配置统一管理</span></a></li></ul></li><li><a href="#span-idinline-blue%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%B8%85%E5%8D%95span"><span id="inline-blue">问题排查清单</span></a></li><li><a href="#span-idinline-blue%E6%80%BB%E7%BB%93span"><span id="inline-blue">总结</span></a></li></ul></li></ul><h1><span id="docker部署springcloud微服务文件上传超时问题排查"><span id="inline-blue">Docker部署SpringCloud微服务文件上传超时问题排查</span></span></h1><h2><span id="问题背景"><span id="inline-blue">问题背景</span></span></h2><p>在生产环境中，系统处理大文件上传时频繁出现超时错误，导致文件上传失败。本文记录了完整的问题排查过程和解决方案。</p><h2><span id="问题现象"><span id="inline-blue">问题现象</span></span></h2><h3><span id="错误日志-1tomcat-连接超时"><span id="inline-blue">错误日志 1：Tomcat 连接超时</span></span></h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org<span class="selector-class">.apache</span><span class="selector-class">.tomcat</span><span class="selector-class">.util</span><span class="selector-class">.http</span><span class="selector-class">.fileupload</span><span class="selector-class">.impl</span><span class="selector-class">.IOFileUploadException</span>: </span><br><span class="line">Processing of multipart/form-data request failed. java<span class="selector-class">.net</span>.SocketTimeoutException</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.tomcat</span><span class="selector-class">.util</span><span class="selector-class">.http</span><span class="selector-class">.fileupload</span><span class="selector-class">.FileUploadBase</span><span class="selector-class">.parseRequest</span>(FileUploadBase<span class="selector-class">.java</span>:<span class="number">292</span>)</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.connector</span><span class="selector-class">.Request</span><span class="selector-class">.parseParts</span>(Request<span class="selector-class">.java</span>:<span class="number">2932</span>)</span><br><span class="line">Caused by: org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.connector</span><span class="selector-class">.ClientAbortException</span>: java<span class="selector-class">.net</span>.SocketTimeoutException</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.connector</span><span class="selector-class">.InputBuffer</span><span class="selector-class">.realReadBytes</span>(InputBuffer<span class="selector-class">.java</span>:<span class="number">321</span>)</span><br><span class="line">Caused by: java<span class="selector-class">.net</span><span class="selector-class">.SocketTimeoutException</span>: null</span><br><span class="line">    at org<span class="selector-class">.apache</span><span class="selector-class">.tomcat</span><span class="selector-class">.util</span><span class="selector-class">.net</span>.NioEndpoint<span class="variable">$NioSocketWrapper</span><span class="selector-class">.fillReadBuffer</span>(NioEndpoint<span class="selector-class">.java</span>:<span class="number">1309</span>)</span><br></pre></td></tr></table></figure><h3><span id="错误日志-2nginx-上游连接重置"><span id="inline-blue">错误日志 2：Nginx 上游连接重置</span></span></h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2026</span>/<span class="number">01</span>/<span class="number">16</span> <span class="number">16</span>:<span class="number">39</span>:<span class="number">11</span> [<span class="keyword">error</span>] <span class="number">8</span>#<span class="number">8</span>: *<span class="number">81</span> recv() failed (<span class="number">104</span>: Connection reset <span class="keyword">by</span> peer) </span><br><span class="line"><span class="keyword">while</span> reading upstream, client: <span class="number">203.0</span>.<span class="number">113.10</span>, server: api.example.com, </span><br><span class="line"><span class="symbol">request:</span> <span class="string">&quot;POST /prod-api/admin/appVersion/upload/74 HTTP/1.1&quot;</span>, </span><br><span class="line"><span class="symbol">upstream:</span> <span class="string">&quot;http://10.0.0.83:9001/prod/admin/appVersion/upload/74&quot;</span>, </span><br><span class="line"><span class="symbol">host:</span> <span class="string">&quot;api.example.com:8080&quot;</span></span><br></pre></td></tr></table></figure><h2><span id="问题分析"><span id="inline-blue">问题分析</span></span></h2><h3><span id="1-错误类型分析"><span id="inline-blue">1. 错误类型分析</span></span></h3><p>从错误日志可以看出两个关键问题：</p><ul><li><strong>Tomcat SocketTimeoutException</strong>：Spring Boot 应用在处理 multipart/form-data 请求时，读取客户端数据超时</li><li><strong>Nginx Connection reset by peer</strong>：Nginx 在读取上游服务响应时，连接被上游服务器关闭</li></ul><h3><span id="2-请求链路分析"><span id="inline-blue">2. 请求链路分析</span></span></h3><p>文件上传的完整请求链路：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端 → <span class="selector-tag">Nginx</span> (<span class="number">8080</span>) → <span class="selector-tag">Gateway</span> (<span class="number">9001</span>) → 业务服务 (<span class="number">9020</span>/<span class="number">9004</span>)</span><br></pre></td></tr></table></figure><p>每个环节都可能存在超时限制：</p><ul><li>Nginx 代理超时配置</li><li>Gateway 服务超时配置</li><li>业务服务（Tomcat）超时配置</li></ul><h3><span id="3-根本原因"><span id="inline-blue">3. 根本原因</span></span></h3><p>通过排查发现，主要问题在于：</p><ol><li><p><strong>Nginx 超时配置过短</strong></p><ul><li><code>proxy_read_timeout: 10s</code> - 只有 10 秒，无法处理大文件上传</li><li><code>proxy_send_timeout: 10s</code> - 发送请求超时时间过短</li></ul></li><li><p><strong>Spring Boot 服务超时配置缺失</strong></p><ul><li>Tomcat 默认连接超时时间过短</li><li>没有针对文件上传场景的特殊配置</li></ul></li><li><p><strong>前端超时配置</strong></p><ul><li>前端已配置 <code>timeout: 600000</code>（10 分钟）</li><li>但后端和中间件超时时间不匹配</li></ul></li></ol><h2><span id="解决方案"><span id="inline-blue">解决方案</span></span></h2><h3><span id="1-nginx-超时配置调整"><span id="inline-blue">1. Nginx 超时配置调整</span></span></h3><p>修改 <code>docker/nginx/conf/nginx.conf</code>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /prod &#123;</span><br><span class="line">    <span class="attribute">if</span> ($request_uri  <span class="regexp">~* &quot;/actuator&quot;)</span>&#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 增加代理超时时间到 10 分钟</span></span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">60s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">600s</span>;      <span class="comment"># 发送到上游的超时时间</span></span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">600s</span>;      <span class="comment"># 从上游读取响应的超时时间</span></span><br><span class="line">    <span class="attribute">send_timeout</span> <span class="number">600s</span>;            <span class="comment"># 发送响应到客户端的超时时间</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Real-IP        $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-host           $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://10.0.0.152:9001/test;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">60s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">600s</span>;</span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">600s</span>;</span><br><span class="line">    <span class="attribute">send_timeout</span> <span class="number">600s</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Real-IP        $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-host           $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://10.0.0.150:9000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>关键配置说明</strong>：</p><ul><li><code>proxy_read_timeout 600s</code>：允许等待上游服务器响应 10 分钟，适用于大文件上传</li><li><code>proxy_send_timeout 600s</code>：允许向上游服务器发送请求 10 分钟</li><li><code>send_timeout 600s</code>：允许向客户端发送响应 10 分钟</li></ul><h3><span id="2-spring-boot-服务超时配置"><span id="inline-blue">2. Spring Boot 服务超时配置</span></span></h3><h4><span id="21-gateway-服务配置"><span id="inline-blue">2.1 Gateway 服务配置</span></span></h4><p>修改 <code>ffcs-gateway/src/main/resources/application-prod.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="number">600000</span>  <span class="comment"># 连接超时：10 分钟（毫秒）</span></span><br><span class="line">    <span class="attr">tomcat:</span></span><br><span class="line">        <span class="attr">connection-timeout:</span> <span class="number">600000</span>  <span class="comment"># Tomcat 连接超时</span></span><br><span class="line">        <span class="attr">keep-alive-timeout:</span> <span class="number">600000</span> <span class="comment"># Keep-Alive 超时</span></span><br></pre></td></tr></table></figure><h4><span id="22-业务服务配置"><span id="inline-blue">2.2 业务服务配置</span></span></h4><p><strong>ffcs-admin-biz 服务</strong>（<code>ffcs-admin/ffcs-admin-biz/src/main/resources/application-prod.yml</code>）：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9020</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">    <span class="attr">tomcat:</span></span><br><span class="line">        <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">        <span class="attr">keep-alive-timeout:</span> <span class="number">600000</span></span><br></pre></td></tr></table></figure><p><strong>ffcs-app 服务</strong>（<code>ffcs-app/src/main/resources/application-prod.yml</code>）：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9004</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">    <span class="attr">tomcat:</span></span><br><span class="line">        <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">        <span class="attr">keep-alive-timeout:</span> <span class="number">600000</span></span><br></pre></td></tr></table></figure><p><strong>ffcs-album-api 服务</strong>（<code>ffcs-album/ffcs-album-api/src/main/resources/application-prod.yml</code>）：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">10050</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">    <span class="attr">tomcat:</span></span><br><span class="line">        <span class="attr">connection-timeout:</span> <span class="number">600000</span></span><br><span class="line">        <span class="attr">keep-alive-timeout:</span> <span class="number">600000</span></span><br></pre></td></tr></table></figure><h3><span id="3-multipart-配置已有确保正确"><span id="inline-blue">3. Multipart 配置（已有，确保正确）</span></span></h3><p>确保 Spring Boot 的 multipart 配置合理：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">servlet:</span></span><br><span class="line">        <span class="attr">multipart:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">max-file-size:</span> <span class="string">200MB</span>      <span class="comment"># 单个文件最大大小</span></span><br><span class="line">            <span class="attr">max-request-size:</span> <span class="string">200MB</span>   <span class="comment"># 请求最大大小</span></span><br><span class="line">            <span class="attr">file-size-threshold:</span> <span class="number">0</span>    <span class="comment"># 文件大小阈值，超过后写入磁盘</span></span><br><span class="line">            <span class="attr">location:</span> <span class="string">/home/lmode/temp</span> <span class="comment"># 临时文件目录</span></span><br></pre></td></tr></table></figure><h2><span id="配置对比表"><span id="inline-blue">配置对比表</span></span></h2><table><thead><tr><th>配置项</th><th>修改前</th><th>修改后</th><th>说明</th></tr></thead><tbody><tr><td>Nginx proxy_read_timeout</td><td>10s</td><td>600s</td><td>读取上游响应超时</td></tr><tr><td>Nginx proxy_send_timeout</td><td>10s</td><td>600s</td><td>发送到上游超时</td></tr><tr><td>Nginx send_timeout</td><td>60s</td><td>600s</td><td>发送到客户端超时</td></tr><tr><td>Spring Boot connection-timeout</td><td>默认（20s）</td><td>600000ms</td><td>Tomcat 连接超时</td></tr><tr><td>Tomcat connection-timeout</td><td>默认</td><td>600000ms</td><td>Tomcat 连接超时</td></tr><tr><td>Tomcat keep-alive-timeout</td><td>默认</td><td>600000ms</td><td>Keep-Alive 超时</td></tr></tbody></table><h2><span id="验证步骤"><span id="inline-blue">验证步骤</span></span></h2><ol><li><p><strong>重启 Nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载配置（推荐）</span></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或重启容器</span></span><br><span class="line">docker restart nginx-container</span><br></pre></td></tr></table></figure></li><li><p><strong>重启 Spring Boot 服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gateway 服务</span></span><br><span class="line"><span class="comment"># 业务服务（ffcs-admin-biz、ffcs-app 等）</span></span><br></pre></td></tr></table></figure></li><li><p><strong>测试文件上传</strong></p><ul><li>上传小文件（&lt; 10MB）：验证基本功能正常</li><li>上传大文件（&gt; 50MB）：验证超时问题已解决</li><li>监控日志：确认无超时错误</li></ul></li></ol><h2><span id="注意事项"><span id="inline-blue">注意事项</span></span></h2><h3><span id="1-超时时间选择"><span id="inline-blue">1. 超时时间选择</span></span></h3><ul><li><strong>建议值</strong>：600 秒（10 分钟）</li><li><strong>考虑因素</strong>：<ul><li>网络带宽</li><li>文件大小限制（如 200MB）</li><li>用户体验</li><li>服务器资源</li></ul></li></ul><h3><span id="2-超时时间一致性"><span id="inline-blue">2. 超时时间一致性</span></span></h3><p>确保整个请求链路中的超时时间保持一致或递增：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端超时 ≥ Nginx 超时 ≥ Gateway 超时 ≥ 业务服务超时</span><br></pre></td></tr></table></figure><h3><span id="3-临时文件管理"><span id="inline-blue">3. 临时文件管理</span></span></h3><p>大文件上传时，确保：</p><ul><li>临时文件目录有足够空间</li><li>定期清理临时文件</li><li>监控磁盘使用情况</li></ul><h3><span id="4-性能考虑"><span id="inline-blue">4. 性能考虑</span></span></h3><p>增加超时时间虽然解决了问题，但要注意：</p><ul><li>长时间连接占用服务器资源</li><li>考虑实现分片上传机制</li><li>监控连接数和资源使用</li></ul><h2><span id="最佳实践建议"><span id="inline-blue">最佳实践建议</span></span></h2><h3><span id="1-分片上传"><span id="inline-blue">1. 分片上传</span></span></h3><p>对于大文件（&gt; 100MB），建议实现分片上传：</p><ul><li>减少单次请求超时风险</li><li>支持断点续传</li><li>提升上传成功率</li></ul><h3><span id="2-异步处理"><span id="inline-blue">2. 异步处理</span></span></h3><p>对于文件处理任务：</p><ul><li>上传后立即返回</li><li>后台异步处理文件</li><li>通过消息队列通知处理结果</li></ul><h3><span id="3-监控告警"><span id="inline-blue">3. 监控告警</span></span></h3><p>配置监控指标：</p><ul><li>上传请求超时率</li><li>上传成功率</li><li>平均上传时长</li><li>服务器连接数</li></ul><h3><span id="4-配置统一管理"><span id="inline-blue">4. 配置统一管理</span></span></h3><ul><li>将超时配置纳入配置中心管理</li><li>支持动态调整</li><li>记录配置变更历史</li></ul><h2><span id="问题排查清单"><span id="inline-blue">问题排查清单</span></span></h2><p>当遇到文件上传超时问题时，按以下清单排查：</p><ul><li><input disabled type="checkbox"> 检查 Nginx 代理超时配置</li><li><input disabled type="checkbox"> 检查 Gateway 服务超时配置</li><li><input disabled type="checkbox"> 检查业务服务 Tomcat 超时配置</li><li><input disabled type="checkbox"> 检查 Spring Multipart 配置</li><li><input disabled type="checkbox"> 检查网络带宽和延迟</li><li><input disabled type="checkbox"> 检查服务器资源（CPU、内存、磁盘）</li><li><input disabled type="checkbox"> 检查临时文件目录权限和空间</li><li><input disabled type="checkbox"> 查看完整错误日志（客户端 → Nginx → Gateway → 业务服务）</li><li><input disabled type="checkbox"> 检查防火墙和安全组配置</li><li><input disabled type="checkbox"> 验证超时时间在整条链路中的一致性</li></ul><h2><span id="总结"><span id="inline-blue">总结</span></span></h2><p>通过以上配置调整，我们成功解决了文件上传超时问题。关键点：</p><ol><li><strong>问题定位</strong>：通过错误日志准确定位到 Nginx 和 Spring Boot 服务的超时配置问题</li><li><strong>全面排查</strong>：检查了整个请求链路中的所有环节</li><li><strong>统一配置</strong>：确保超时时间在整个链路中保持一致</li><li><strong>验证测试</strong>：上传功能恢复正常</li></ol><p><strong>经验教训</strong>：</p><ul><li>大文件上传场景需要特殊考虑超时配置</li><li>微服务架构中，每个环节的超时配置都很重要</li><li>错误日志是问题排查的关键依据</li><li>配置变更后要进行充分测试</li></ul></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>vanishke</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" title="Docker部署SpringCloud微服务文件上传超时问题排查">https://github.com/vanishke/hexo/Docker/blogs/Docker部署SpringCloud微服务文件上传超时问题排查/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/Docker/" rel="tag"><i class="fa fa-tag"></i> Docker</a> <a href="/tags/SpringCloud/" rel="tag"><i class="fa fa-tag"></i> SpringCloud</a> <a href="/tags/Tomcat/" rel="tag"><i class="fa fa-tag"></i> Tomcat</a></div><div class="post-nav"><div class="post-nav-item"><a href="/Docker/blogs/Docker%E9%83%A8%E7%BD%B2Redis%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" rel="prev" title="Docker部署Redis超时问题排查与解决方案"><i class="fa fa-chevron-left"></i> Docker部署Redis超时问题排查与解决方案</a></div><div class="post-nav-item"><a href="/Docker/blogs/Docker%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="next" title="Docker日志管理最佳实践">Docker日志管理最佳实践 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">vanishke</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.7m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">25:07</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/bookmark.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/search/local-search.min.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/tags/pdf.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/pace.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.2.0/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://github.com/vanishke/hexo/Docker/blogs/Docker%E9%83%A8%E7%BD%B2SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/quicklink.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"vanishke","repo":"blog-comments","client_id":"95db1f51f05191be80c5","client_secret":"eccc0bbe52b90a08e97140cece84ee32577172b2","admin_user":"['vanishke']","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"3720d4bee5a5c337c46bd7cf0df28bc8"}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.1/third-party/comments/gitalk.min.js"></script></body></html>